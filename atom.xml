<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>&lt;hello-world/&gt;</title>
  
  <subtitle>ä»£ç æ”¹å˜ä¸–ç•Œ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.justwe.site/"/>
  <updated>2019-06-17T06:02:59.860Z</updated>
  <id>http://blog.justwe.site/</id>
  
  <author>
    <name>GPF</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Centos7 K8s éƒ¨ç½² K8s</title>
    <link href="http://blog.justwe.site/2019/06/17/k8s-install-centos7/"/>
    <id>http://blog.justwe.site/2019/06/17/k8s-install-centos7/</id>
    <published>2019-06-17T03:59:54.000Z</published>
    <updated>2019-06-17T06:02:59.860Z</updated>
    
    <content type="html"><![CDATA[<p>éƒ½æ˜¯èµ°çš„å›½å†…é•œåƒæº</p><a id="more"></a><h3 id="å…³é—­-selinux"><a href="#å…³é—­-selinux" class="headerlink" title="å…³é—­ selinux"></a>å…³é—­ selinux</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 #å®æ—¶åŠ¨æ€å…³é—­ selinux</span><br><span class="line">sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config #ç¦æ­¢é‡å¯åè‡ªåŠ¨å¼€å¯</span><br></pre></td></tr></table></figure><h3 id="å…³é—­äº¤æ¢åˆ†åŒº"><a href="#å…³é—­äº¤æ¢åˆ†åŒº" class="headerlink" title="å…³é—­äº¤æ¢åˆ†åŒº"></a>å…³é—­äº¤æ¢åˆ†åŒº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a #å®æ—¶åŠ¨æ€å…³é—­äº¤æ¢åˆ†åŒº</span><br><span class="line">sed -i &apos;/ swap / s/^/#/&apos; /etc/fstab #ç¦æ­¢é‡å¯åè‡ªåŠ¨å¼€å¯</span><br></pre></td></tr></table></figure><h3 id="ç½‘ç»œé…ç½®æ–‡ä»¶"><a href="#ç½‘ç»œé…ç½®æ–‡ä»¶" class="headerlink" title="ç½‘ç»œé…ç½®æ–‡ä»¶"></a>ç½‘ç»œé…ç½®æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line">vm.swappiness=0</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">modprobe br_netfilter  #æ‰§è¡Œè¯¥å‘½ä»¤ å¦‚æœä¸æ‰§è¡Œå°±ä¼šåœ¨åº”ç”¨k8s.confæ—¶å‡ºç°åŠ è½½é”™è¯¯</span><br><span class="line">sysctl -p /etc/sysctl.d/k8s.conf #åº”ç”¨é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure><h3 id="yumæ¢å›½å†…æº"><a href="#yumæ¢å›½å†…æº" class="headerlink" title="yumæ¢å›½å†…æº"></a>yumæ¢å›½å†…æº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d  &amp;&amp; \</span><br><span class="line">sudo mv CentOS-Base.repo CentOS-Base.repo.bak &amp;&amp; \</span><br><span class="line">sudo wget -O CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo &amp;&amp; \</span><br><span class="line">yum clean all &amp;&amp; \</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><h3 id="é…ç½®k8sèµ„æºçš„ä¸‹è½½åœ°å€"><a href="#é…ç½®k8sèµ„æºçš„ä¸‹è½½åœ°å€" class="headerlink" title="é…ç½®k8sèµ„æºçš„ä¸‹è½½åœ°å€"></a>é…ç½®k8sèµ„æºçš„ä¸‹è½½åœ°å€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line"></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y docker kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure><h3 id="dockeræ¢æº"><a href="#dockeræ¢æº" class="headerlink" title="dockeræ¢æº"></a>dockeræ¢æº</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;</span><br><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure><h3 id="å¼€æœºå¯åŠ¨"><a href="#å¼€æœºå¯åŠ¨" class="headerlink" title="å¼€æœºå¯åŠ¨"></a>å¼€æœºå¯åŠ¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl disable firewalld.service  &amp;&amp; systemctl stop firewalld.service </span><br><span class="line">systemctl enable docker &amp;&amp; systemctl start docker</span><br><span class="line">systemctl enable kubelet &amp;&amp; systemctl start kubelet</span><br></pre></td></tr></table></figure><h3 id="ä¸‹è½½k8sä¾èµ–é•œåƒ"><a href="#ä¸‹è½½k8sä¾èµ–é•œåƒ" class="headerlink" title="ä¸‹è½½k8sä¾èµ–é•œåƒ"></a>ä¸‹è½½k8sä¾èµ–é•œåƒ</h3><p>è·å–ä¾èµ–çš„é•œåƒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list</span><br></pre></td></tr></table></figure></p><p>å›½å†…ç”¨æˆ·é€šè¿‡é˜¿é‡Œäº‘é•œåƒä¸‹è½½k8sä¾èµ–ç»„ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubeadm config images list |sed -e &apos;s/^/docker pull /g&apos; -e &apos;s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g&apos; |sh -x</span><br><span class="line"></span><br><span class="line">docker images |grep registry.cn-hangzhou.aliyuncs.com/google_containers |awk &apos;&#123;print &quot;docker tag &quot;,$1&quot;:&quot;$2,$1&quot;:&quot;$2&#125;&apos; |sed -e &apos;s#registry.cn-hangzhou.aliyuncs.com/google_containers#k8s.gcr.io#2&apos; |sh -x</span><br><span class="line"></span><br><span class="line">docker images |grep registry.cn-hangzhou.aliyuncs.com/google_containers |awk &apos;&#123;print &quot;docker rmi &quot;, $1&quot;:&quot;$2&#125;&apos; |sh -x</span><br></pre></td></tr></table></figure></p><h3 id="ä¸»èŠ‚ç‚¹åˆå§‹åŒ–"><a href="#ä¸»èŠ‚ç‚¹åˆå§‹åŒ–" class="headerlink" title="ä¸»èŠ‚ç‚¹åˆå§‹åŒ–"></a>ä¸»èŠ‚ç‚¹åˆå§‹åŒ–</h3><p>Kubernetes v1.14.3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.14.3</span><br></pre></td></tr></table></figure></p><p>æ‰§è¡ŒæˆåŠŸåå‡ºç°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 192.168.31.120:6443 --token 6nelb5.lrc5qbs0k3v64eln \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:c55a113114d664133685430a86f2e39f40e9df6b12ad3f4d65462fd372079e97</span><br></pre></td></tr></table></figure></p><h3 id="nodeèŠ‚ç‚¹å¯åŠ¨"><a href="#nodeèŠ‚ç‚¹å¯åŠ¨" class="headerlink" title="nodeèŠ‚ç‚¹å¯åŠ¨"></a>nodeèŠ‚ç‚¹å¯åŠ¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 192.168.31.120:6443 --token 6nelb5.lrc5qbs0k3v64eln \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:c55a113114d664133685430a86f2e39f40e9df6b12ad3f4d65462fd372079e97</span><br></pre></td></tr></table></figure><p>å°±æ˜¯åˆå§‹åŒ–åçš„æœ€åä¸€æ¡å‘½ä»¤</p><p>ä¸»èŠ‚ç‚¹æ‰§è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# kubectl get nodes</span><br><span class="line">NAME                    STATUS     ROLES    AGE     VERSION</span><br><span class="line">localhost.localdomain   NotReady   master   40m     v1.14.3</span><br><span class="line">miwifi-r3-srv           NotReady   &lt;none&gt;   3m48s   v1.14.3</span><br></pre></td></tr></table></figure></p><p>çŠ¶æ€è¿˜æ˜¯notReady</p><p>æŸ¥çœ‹æ–‡æ¡£ <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a> </p><p>è¿™é‡Œé€‰äº† weave æ’ä»¶æ–‡æ¡£ï¼š <a href="https://www.weave.works/docs/net/latest/kubernetes/kube-addon/" target="_blank" rel="noopener">https://www.weave.works/docs/net/latest/kubernetes/kube-addon/</a><br>æ‰§è¡Œå‘½ä»¤<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f &quot;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d &apos;\n&apos;)&quot;</span><br></pre></td></tr></table></figure></p><p>ç¨å¾®ç­‰å‡ åˆ†é’Ÿå°±å¯ä»¥çœ‹åˆ°æ­£å¸¸äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# kubectl get nodes</span><br><span class="line">NAME                    STATUS     ROLES    AGE   VERSION</span><br><span class="line">localhost.localdomain   Ready      master   49m   v1.14.3</span><br><span class="line">miwifi-r3-srv           Ready      &lt;none&gt;   12m   v1.14.3</span><br></pre></td></tr></table></figure></p><p><a href="https://www.cnblogs.com/pekkle/p/10545145.html" target="_blank" rel="noopener">æ­å»ºæ•™ç¨‹</a><br><a href="https://jimmysong.io/kubernetes-handbook/practice/node-installation.html" target="_blank" rel="noopener">éƒ¨ç½²nodeèŠ‚ç‚¹</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;éƒ½æ˜¯èµ°çš„å›½å†…é•œåƒæº&lt;/p&gt;
    
    </summary>
    
      <category term="k8s" scheme="http://blog.justwe.site/categories/k8s/"/>
    
    
      <category term="k8s" scheme="http://blog.justwe.site/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>K8s å®‰è£… Minikube</title>
    <link href="http://blog.justwe.site/2019/05/14/k8s-minikube/"/>
    <id>http://blog.justwe.site/2019/05/14/k8s-minikube/</id>
    <published>2019-05-14T03:04:46.000Z</published>
    <updated>2019-05-14T03:07:30.227Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬åœ°å¿«é€Ÿè£…ä¸€ä¸ªå¾®å‹çš„kubernetesç¯å¢ƒ, ç¿»å¢™çš„è‹¦è°èƒ½æ‡‚?</p><a id="more"></a><h4 id="mac-æœ¬åœ°å®‰è£…minikubeç¯å¢ƒ"><a href="#mac-æœ¬åœ°å®‰è£…minikubeç¯å¢ƒ" class="headerlink" title="mac æœ¬åœ°å®‰è£…minikubeç¯å¢ƒ"></a>mac æœ¬åœ°å®‰è£…minikubeç¯å¢ƒ</h4><p>ç¯å¢ƒéœ€æ±‚:</p><ul><li>kubectl       æœ¬åœ°åšå‘½ä»¤è¡Œæ§åˆ¶ç”¨, æ‰€æœ‰çš„å‘½ä»¤æ“ä½œéƒ½æ˜¯é€šè¿‡å®ƒ</li><li>vittualBox    v5.1 +  æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬å°±å¯¹äº†</li><li>minikube      åœ¨æœ¬åœ°æ­å»ºæµ‹è¯•ç¯å¢ƒ</li></ul><p>ç¿»å¢™æœ‰å›°éš¾çš„å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä¸ª <a href="https://yq.aliyun.com/articles/221687" target="_blank" rel="noopener">https://yq.aliyun.com/articles/221687</a></p><p>å®‰è£… <code>kubectl</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ   brew install kubectl</span><br></pre></td></tr></table></figure></p><p>ä¸‹è½½æœ€æ–° <code>minikube</code> ä¸å»ºè®®ä½¿ç”¨brewå®‰è£…,  é¦–å…ˆç‰ˆæœ¬ä¸ä¼šæ˜¯æœ€æ–°, å†è€…ä¼šå‡ºç°è«åå…¶å¦™çš„é—®é¢˜<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ   curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 &amp;&amp; \</span><br><span class="line">  chmod +x minikube &amp;&amp; \</span><br><span class="line">  sudo mv minikube /usr/local/bin/</span><br></pre></td></tr></table></figure></p><p>é»˜è®¤ start æ—¶è¿è¡Œçš„virtualBox å»å®˜ç½‘ä¸‹ä¸ªæœ€æ–°çš„å°±è¡Œ</p><p>å¯åŠ¨, æœ€å¥½æŠŠdockeré•œåƒæŒ‡å®šåˆ°å›½å†…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ minikube start --registry-mirror=https://registry.docker-cn.com</span><br><span class="line">ğŸ˜„  minikube v1.0.1 on darwin (amd64)</span><br><span class="line">ğŸ’¿  Downloading Minikube ISO ...</span><br><span class="line"> 142.88 MB / 142.88 MB [============================================] 100.00% 0s</span><br><span class="line">ğŸ¤¹  Downloading Kubernetes v1.14.1 images in the background ...</span><br><span class="line">ğŸ”¥  Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...</span><br><span class="line">ğŸ“¶  &quot;minikube&quot; IP address is 192.168.99.103</span><br><span class="line">ğŸ³  Configuring Docker as the container runtime ...</span><br><span class="line">ğŸ³  Version of container runtime is 18.06.3-ce</span><br><span class="line">âŒ›  Waiting for image downloads to complete ...</span><br><span class="line">âœ¨  Preparing Kubernetes environment ...</span><br><span class="line">ğŸ’¾  Downloading kubeadm v1.14.1</span><br><span class="line">ğŸ’¾  Downloading kubelet v1.14.1</span><br><span class="line">ğŸšœ  Pulling images required by Kubernetes v1.14.1 ...</span><br><span class="line">ğŸš€  Launching Kubernetes v1.14.1 using kubeadm ...</span><br><span class="line">âŒ›  Waiting for pods: apiserver proxy etcd scheduler controller dns</span><br><span class="line">ğŸ”‘  Configuring cluster permissions ...</span><br><span class="line">ğŸ¤”  Verifying component health .....</span><br><span class="line">ğŸ’—  kubectl is now configured to use &quot;minikube&quot;</span><br><span class="line">ğŸ„  Done! Thank you for using minikube!</span><br><span class="line">âœ  ~ kubectl cluster-info</span><br><span class="line">Kubernetes master is running at https://192.168.99.103:8443</span><br><span class="line">KubeDNS is running at https://192.168.99.103:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><br><span class="line"></span><br><span class="line">To further debug and diagnose cluster problems, use &apos;kubectl cluster-info dump&apos;.</span><br></pre></td></tr></table></figure></p><p>å¦‚æœ<code>Minikube ISO</code>å­˜åœ¨å¢™çš„é—®é¢˜, å°±æŠŠisoä¸‹è½½åæ”¾åˆ° <code>~/.minikube/cache/iso/</code>ä¸‹</p><p>è¿™æ—¶Macä¸Šçš„dockerä¸èƒ½ç”¨docker for Macæä¾›çš„äº†, è€Œæ˜¯å®¿ä¸»æœºé‡Œé¢çš„docker, åˆ‡æ¢å‘½ä»¤ä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ   evalÂ $(minikube docker-env)</span><br></pre></td></tr></table></figure></p><p>æ’¤é”€æ›´æ”¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ   eval $(minikube docker-env -u)</span><br></pre></td></tr></table></figure></p><p>åŠ è½½åå°æ§åˆ¶é¢æ¿, ç¨ç­‰ä¸€ä¼š, è‡ªåŠ¨æ‰“å¡åå°ç•Œé¢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ   minikube dashboard</span><br></pre></td></tr></table></figure></p><h4 id="éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨"><a href="#éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨" class="headerlink" title="éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨"></a>éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨</h4><h5 id="å‘½ä»¤è¡Œéƒ¨ç½²"><a href="#å‘½ä»¤è¡Œéƒ¨ç½²" class="headerlink" title="å‘½ä»¤è¡Œéƒ¨ç½²"></a>å‘½ä»¤è¡Œéƒ¨ç½²</h5><h6 id="åˆ›å»ºnode-js-åº”ç”¨"><a href="#åˆ›å»ºnode-js-åº”ç”¨" class="headerlink" title="åˆ›å»ºnode.js åº”ç”¨"></a>åˆ›å»ºnode.js åº”ç”¨</h6><p>åˆ›å»ºæ–‡ä»¶ <code>server.js</code><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> handleRequest = <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Received request for URL: '</span> + request.url);</span><br><span class="line">  response.writeHead(<span class="number">200</span>);</span><br><span class="line">  response.end(<span class="string">'Hello World! V1'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> www = http.createServer(handleRequest);</span><br><span class="line">www.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js   // è®¿é—®åœ°å€  http://localhost:3000</span><br></pre></td></tr></table></figure></p><h6 id="åˆ›å»ºdockeré•œåƒ"><a href="#åˆ›å»ºdockeré•œåƒ" class="headerlink" title="åˆ›å»ºdockeré•œåƒ"></a>åˆ›å»ºdockeré•œåƒ</h6><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">8.10</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> server.js .</span></span><br><span class="line"><span class="bash">CMD [<span class="string">"node"</span>, <span class="string">"server.js"</span>]</span></span><br></pre></td></tr></table></figure><p>æ„å»ºé•œåƒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ docker build -t hello-node:v1 .</span><br></pre></td></tr></table></figure></p><p>å¦‚æœå‡ºç°<code>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</code> è¯´æ˜ä½ å¿˜äº†æ‰§è¡Œ <code>eval $(minikube docker-env)</code><br><strong>kubeç”¨çš„ docker å’Œä½ æœ¬åœ°ç”¨çš„ docker æ˜¯ä¸¤ä¸ªä½ç½®, kubeçš„åœ¨è™šæ‹Ÿæœºé‡Œè¿è¡Œ</strong></p><h6 id="åˆ›å»º-deployment"><a href="#åˆ›å»º-deployment" class="headerlink" title="åˆ›å»º deployment"></a>åˆ›å»º deployment</h6><p>æœ‰äº†é•œåƒå°±å…·å¤‡åˆ›å»ºpodçš„æ¡ä»¶, é€šå¸¸æ¥è¯´ä¸ç”¨ç›´æ¥åˆ›å»º <code>pod</code>, è€Œæ˜¯åˆ›å»º <code>deployment</code> æˆ–è€… <code>replication controller</code>, ç”±ä»–ä»¬æ¥è´Ÿè´£ç®¡ç†æœåŠ¡çš„è¿è¡Œ, è§„æ¨¡ç¼©æ”¾, è‡ªåŠ¨é‡å¯ç­‰ç­‰è¿™äº›æ“ä½œ, å°±å•ä¸ª<code>pod</code>æ¥è¯´æ˜¯å¯ä»¥éšæ—¶è¢«é”€æ¯çš„, ä¸èƒ½ä½œä¸ºç¨³å®šæœåŠ¡çš„ä¿è¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl run hello-node --image=hello-node:v1 --port=3000</span><br><span class="line">æˆ–</span><br><span class="line">âœ kubectl create deployment hello-node --image=hello-node:v1</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å½“å‰<code>deployment</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl get deployments </span><br><span class="line">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">hello-node     1/1     1            1           8m8s</span><br></pre></td></tr></table></figure></p><p><code>ready 1/1</code> è¯´æ˜å·²ç»å‡†å¤‡å°±ç»ªäº† </p><p>æŸ¥çœ‹ <code>pod</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ  hellonode git:(master) âœ— kubectl get pods</span><br><span class="line">NAME                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">hello-node-5c58cb6dd4-h65fx     1/1     Running   0          8m40s</span><br></pre></td></tr></table></figure></p><p>ä»è¿™ä¸¤æ¡ä¿¡æ¯å°±èƒ½çœ‹å‡ºæ¥, æ¯ä¸ªpodéƒ½æ˜¯å¸¦éšæœºå­—ç¬¦ä¸²çš„, å¹¶ä¸æ‰“ç®—ç»™äººå»æ“ä½œ, æˆ‘ä»¬ä¸»è¦ä¸“æ³¨åœ¨<code>deployment</code>å’Œ <code>service</code> çš„æ­å»º</p><p>æŸ¥çœ‹ <code>deployment</code> æè¿°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl describe deployments/hello-node</span><br><span class="line"></span><br><span class="line">Name:                   hello-node</span><br><span class="line">Namespace:              default</span><br><span class="line">CreationTimestamp:      Mon, 13 May 2019 14:17:03 +0800</span><br><span class="line">Labels:                 run=hello-node</span><br><span class="line">Annotations:            deployment.kubernetes.io/revision: 1</span><br><span class="line">Selector:               run=hello-node</span><br><span class="line">Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable</span><br><span class="line">StrategyType:           RollingUpdate</span><br><span class="line">MinReadySeconds:        0</span><br><span class="line">RollingUpdateStrategy:  25% max unavailable, 25% max surge</span><br><span class="line">Pod Template:</span><br><span class="line">  Labels:  run=hello-node</span><br><span class="line">  Containers:</span><br><span class="line">   hello-node:</span><br><span class="line">    Image:        hello-node:v1</span><br><span class="line">    Port:         3000/TCP</span><br><span class="line">    Host Port:    0/TCP</span><br><span class="line">    Environment:  &lt;none&gt;</span><br><span class="line">    Mounts:       &lt;none&gt;</span><br><span class="line">  Volumes:        &lt;none&gt;</span><br><span class="line">Conditions:</span><br><span class="line">  Type           Status  Reason</span><br><span class="line">  ----           ------  ------</span><br><span class="line">  Available      True    MinimumReplicasAvailable</span><br><span class="line">  Progressing    True    NewReplicaSetAvailable</span><br><span class="line">OldReplicaSets:  &lt;none&gt;</span><br><span class="line">NewReplicaSet:   hello-node-5c58cb6dd4 (1/1 replicas created)</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason             Age   From                   Message</span><br><span class="line">  ----    ------             ----  ----                   -------</span><br><span class="line">  Normal  ScalingReplicaSet  11m   deployment-controller  Scaled up replica set hello-node-5c58cb6dd4 to 1</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæ˜¯å¯¹<code>deployment</code>çš„æ¦‚è§ˆ, <code>Pod Template:</code> ä¸‹å°±æ˜¯æ¯ä¸ªpodsçš„é…ç½®, ä¹‹åå¯¹éƒ¨ç½²çš„æ‰©å®¹éƒ½æ˜¯åŸºäºè¿™ä¸ªå»å¤åˆ¶</p><p>åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åˆ›å»ºäº†<code>deployment</code> è€Œä¸”ä¹Ÿè‡ªåŠ¨ç”Ÿæˆ<code>pod</code>äº†, å¯æ˜¯æœåŠ¡å¹¶ä¸èƒ½è¢«è®¿é—®åˆ°, ä¸ºä»€ä¹ˆ? å› ä¸ºç«¯å£æ²¡æœ‰å¯¹å¤–æš´éœ²å‡ºæ¥, æ‰€ä»¥æœ‰äº†ä¸‹ä¸€æ­¥</p><h6 id="åˆ›å»ºservice"><a href="#åˆ›å»ºservice" class="headerlink" title="åˆ›å»ºservice"></a>åˆ›å»ºservice</h6><p><code>service</code> å°±æ˜¯ç”¨æ¥å¯¹æˆ‘æš´éœ²æœåŠ¡çš„ä¸œè¥¿, æ‰€æœ‰çš„ <code>pod</code> éƒ½æ˜¯åœ¨å†…ç½‘é€šä¿¡, å¤–éƒ¨è®¿é—®å°±å¾—è®© <code>service</code> è¿™å±‚ä»£ç†å»è½¬å‘è¿‡å», <code>--type=LoadBalancer</code> å°±æ˜¯æŒ‡å®šè½¬å‘ä¸ºè´Ÿè½½å‡è¡¡æ¨¡å¼, <code>kubectl create service -h</code> æŸ¥çœ‹æ›´å¤š, è¿™é‡Œä¸ç»†è®²</p><p>åˆ›å»ºservice<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl expose deployment hello-node --type=LoadBalancer</span><br><span class="line">æˆ–</span><br><span class="line">âœ kubectl expose deployment hello-node --type=LoadBalancer --port=3000 // è¿™é‡ŒæŒ‡å®šç«¯å£</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl get service                                     </span><br><span class="line">NAME         TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">hello-node   LoadBalancer   10.111.18.151   &lt;pending&gt;     3000:31349/TCP   3s</span><br><span class="line">kubernetes   ClusterIP      10.96.0.1       &lt;none&gt;        443/TCP          3d</span><br></pre></td></tr></table></figure></p><p>è¯¦ç»†ä¿¡æ¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl describe services hello-node </span><br><span class="line">Name:                     hello-node</span><br><span class="line">Namespace:                default</span><br><span class="line">Labels:                   run=hello-node</span><br><span class="line">Annotations:              &lt;none&gt;</span><br><span class="line">Selector:                 run=hello-node</span><br><span class="line">Type:                     LoadBalancer</span><br><span class="line">IP:                       10.111.18.151</span><br><span class="line">Port:                     &lt;unset&gt;  3000/TCP</span><br><span class="line">TargetPort:               3000/TCP</span><br><span class="line">NodePort:                 &lt;unset&gt;  31349/TCP</span><br><span class="line">Endpoints:                172.17.0.7:3000</span><br><span class="line">Session Affinity:         None</span><br><span class="line">External Traffic Policy:  Cluster</span><br><span class="line">Events:                   &lt;none&gt;</span><br></pre></td></tr></table></figure></p><p><code>NodePort</code> å°±æ˜¯ç»‘å®šåœ¨èŠ‚ç‚¹çš„é‚£ä¸ªç«¯å£ä¸Š, ç›´æ¥è®¿é—®èŠ‚ç‚¹ipå°±è¡Œ, ä¹Ÿå¯ä»¥ç”¨minikubeå‘½ä»¤ <code>minikube service hello-node</code> è‡ªåŠ¨å¸®ä½ æ‰“å¼€æœ¬åœ°åœ°å€</p><h6 id="æ‰©å±•ç¤ºä¾‹"><a href="#æ‰©å±•ç¤ºä¾‹" class="headerlink" title="æ‰©å±•ç¤ºä¾‹"></a>æ‰©å±•ç¤ºä¾‹</h6><p>çº¿ä¸Šè‚¯å®šæ˜¯æœ‰è¿™ç§åŠ¨æ€æ‰©å®¹çš„æƒ…å†µ, è€Œä¸”å¤šå®ä¾‹ä¹‹é—´æ»šåŠ¨å‡çº§ä¹Ÿä¸ä¼šåœæ­¢æœåŠ¡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl scale deployments/hello-node --replicas=4</span><br><span class="line">deployment.extensions/hello-node scaled</span><br><span class="line">âœ  hellonode git:(master) âœ— kubectl get pods</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">hello-node-5c58cb6dd4-d2qq9   1/1     Running   0          18s</span><br><span class="line">hello-node-5c58cb6dd4-h65fx   1/1     Running   0          51m</span><br><span class="line">hello-node-5c58cb6dd4-jlzjw   1/1     Running   0          18s</span><br><span class="line">hello-node-5c58cb6dd4-vmx4f   1/1     Running   0          18s</span><br></pre></td></tr></table></figure></p><h6 id="æ›´æ–°åº”ç”¨"><a href="#æ›´æ–°åº”ç”¨" class="headerlink" title="æ›´æ–°åº”ç”¨"></a>æ›´æ–°åº”ç”¨</h6><p>é‡æ–°æ„å»ºä¸€ä¸ªnodeçš„é•œåƒ<br>service.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> handleRequest = <span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Received request for URL: '</span> + request.url);</span><br><span class="line">  response.writeHead(<span class="number">200</span>);</span><br><span class="line">  response.end(<span class="string">'Hello World! V2'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> www = http.createServer(handleRequest);</span><br><span class="line">www.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ docker build -t hello-node:v2 .</span><br></pre></td></tr></table></figure><p>è®¾ç½® <code>deployment</code> ä½¿ç”¨æ–°é•œåƒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl set image deployment/hello-node hello-node=hello-node:v2</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹æ¯ä¸ªpodçš„å…·ä½“æƒ…å†µ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl describe pods</span><br></pre></td></tr></table></figure></p><p>å†è®¿é—®åˆšæ‰çš„åœ°å€å°±èƒ½çœ‹åˆ°æ”¹å˜äº†</p><h6 id="æ¸…é™¤èµ„æº"><a href="#æ¸…é™¤èµ„æº" class="headerlink" title="æ¸…é™¤èµ„æº"></a>æ¸…é™¤èµ„æº</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl delete service hello-node</span><br><span class="line">âœ kubectl delete deployments hello-node</span><br></pre></td></tr></table></figure><p>ç»è¿‡ä¸Šé¢ä¸€å¥—æ“ä½œä¸‹æ¥, åº”è¯¥ä¹Ÿå¯¹k8sæœ‰äº†ä¸€ä¸ªå¤§è‡´çš„å°è±¡äº†, æ¯•ç«Ÿå…‰çœ‹å®è·µæ‰æ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†, ä½†æ˜¯å¦‚æœéƒ¨ç½²ä¸€ä¸ªæœåŠ¡è¿™æ ·ä¸€ä¸ªå‘½ä»¤ä¸€ä¸ªå‘½ä»¤çš„æ•²æ˜¯å¾ˆè¦å‘½çš„, è€Œä¸”æœåŠ¡å™¨è¿™ç©æ„, è½»æ˜“ä¸ä¼šåŠ¨, æ—¶é—´ä¸€é•¿å°±å®¹æ˜“å¿˜, å› æ­¤ç”¨é…ç½®æ–‡ä»¶å»å¯åŠ¨æ›´åŠ åˆç†</p><h5 id="é€šè¿‡-yaml-å¯åŠ¨"><a href="#é€šè¿‡-yaml-å¯åŠ¨" class="headerlink" title="é€šè¿‡ yaml å¯åŠ¨"></a>é€šè¿‡ yaml å¯åŠ¨</h5><p>å¦‚ä¸‹: test-service.yaml<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line"><span class="attr">  name:</span> <span class="string">test-service</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    version:</span> <span class="string">v2</span></span><br><span class="line"><span class="attr">    run:</span> <span class="string">hello-node</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">test-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">LoadBalancer</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - port:</span> <span class="number">3001</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">3000</span></span><br><span class="line"><span class="attr">    protocol:</span> <span class="string">TCP</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">test-service</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">test-service</span></span><br><span class="line"><span class="attr">  labels:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">test-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">test-service</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">test-service</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">node-pod</span></span><br><span class="line"><span class="attr">        image:</span> <span class="attr">hello-node:v2</span></span><br><span class="line"><span class="attr">        imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"><span class="attr">        ports:</span> </span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure></p><p>æ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">âœ kubectl create -f test-service.yaml</span><br><span class="line">âœ minikube service test-service</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·é€šè¿‡é…ç½®æ–‡ä»¶å°±èƒ½å¯åŠ¨äº†, é…ç½®æ–‡ä»¶é‡Œé‡Œçš„å­—æ®µåç»­æˆ‘ä»¬å†è¯¦ç»†çš„è®²ä¸€ä¸‹</p><p>åˆ é™¤<code>kubectl delete -f test-service.yaml</code></p><p><a href="https://github.com/gaopengfei123123/k8s_study/tree/master/demo/hellonode" target="_blank" rel="noopener">ä»£ç åœ°å€</a></p><h4 id="ç›¸å…³èµ„æ–™"><a href="#ç›¸å…³èµ„æ–™" class="headerlink" title="ç›¸å…³èµ„æ–™"></a>ç›¸å…³èµ„æ–™</h4><p><a href="https://segmentfault.com/a/1190000014116698#articleHeader16" target="_blank" rel="noopener">å¸¦ä½ ç†è§£Kubernetesï¼Œéƒ¨ç½²ä¸€ä¸ªNodeåº”ç”¨</a><br><a href="http://dockone.io/article/4884" target="_blank" rel="noopener">Kubernetesçš„ä¸‰ç§å¤–éƒ¨è®¿é—®æ–¹å¼ï¼šNodePortã€LoadBalancer å’Œ Ingress</a><br><a href="https://yq.aliyun.com/articles/221687" target="_blank" rel="noopener">Minikube - Kubernetesæœ¬åœ°å®éªŒç¯å¢ƒ</a><br><a href="https://blog.csdn.net/cc1949/article/details/78842291" target="_blank" rel="noopener">Kubernetesä¹‹kubectlå¸¸ç”¨å‘½ä»¤</a><br><a href="https://www.cnblogs.com/boshen-hzb/p/7097811.html" target="_blank" rel="noopener">replication controllerä¸deploymentçš„åŒºåˆ«</a><br><a href="https://blog.csdn.net/weixin_33979203/article/details/89613400" target="_blank" rel="noopener">Kubenetesé‡Œpodå’Œserviceç»‘å®šçš„å®ç°æ–¹å¼</a><br><a href="https://www.jianshu.com/p/bf3fb3a6e688" target="_blank" rel="noopener">Kubernetesåˆ›å»ºèµ„æºå¯¹è±¡yamlæ–‡ä»¶ä¾‹å­</a><br><a href="https://github.com/kubernetes/minikube" target="_blank" rel="noopener">kubernetes/minikube github</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;æœ¬åœ°å¿«é€Ÿè£…ä¸€ä¸ªå¾®å‹çš„kubernetesç¯å¢ƒ, ç¿»å¢™çš„è‹¦è°èƒ½æ‡‚?&lt;/p&gt;
    
    </summary>
    
      <category term="k8s" scheme="http://blog.justwe.site/categories/k8s/"/>
    
    
      <category term="k8s" scheme="http://blog.justwe.site/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Docker for Mac éƒ¨ç½² Kubernetes</title>
    <link href="http://blog.justwe.site/2019/05/06/k8s-install-docker/"/>
    <id>http://blog.justwe.site/2019/05/06/k8s-install-docker/</id>
    <published>2019-05-06T07:58:16.000Z</published>
    <updated>2019-05-14T03:06:11.150Z</updated>
    
    <content type="html"><![CDATA[<p><code>docker for mac</code> å®‰è£…kubernetesæœ¬æ¥æ˜¯å¾ˆæ–¹ä¾¿çš„, ä½†æ˜¯å›½å†…ç©å®¶è¦æŠ˜è…¾ä¸€ä¸‹, å› ä¸º <code>gcr.io</code> è¿™ä¸ªåŸŸè¢«å¢™äº†â€¦</p><p>ç›®å‰æ¥çœ‹å‰è¾ˆä»¬å·²ç»æŠŠå‘ç»™æ·Œçš„å·®ä¸å¤šäº†, æˆ‘è€æ—©çš„æ—¶å€™ä¹Ÿè¢«æŠ˜è…¾çš„å¤´ç§ƒ, è¿™é‡Œå°±åšä¸ªæ€»ç»“<br><a id="more"></a></p><h4 id="é€šè¿‡ä»£ç†ç¿»å¢™ä¸‹è½½é•œåƒ"><a href="#é€šè¿‡ä»£ç†ç¿»å¢™ä¸‹è½½é•œåƒ" class="headerlink" title="é€šè¿‡ä»£ç†ç¿»å¢™ä¸‹è½½é•œåƒ"></a>é€šè¿‡ä»£ç†ç¿»å¢™ä¸‹è½½é•œåƒ</h4><p>è¿™ä¸ªæ–¹æ³•ç›¸å¯¹æ¥è¯´ä¸€åŠ³æ°¸é€¸, ç¼ºç‚¹æ˜¯æ¯ä¸ªæœˆæœ‰vpnçš„èŠ±è´¹, æˆ‘ä»£ç†ç”¨çš„shadowsockets, å°±æ‹¿è¿™ä¸ªæ¥ä¸¾ä¾‹:</p><p>é¦–å…ˆå®‰è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install privoxy</span><br></pre></td></tr></table></figure></p><p>æ·»åŠ é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/etc/privoxy/config</span><br></pre></td></tr></table></figure><p>é…ç½®å†…å®¹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listen-address 0.0.0.0:8118</span><br><span class="line">forward-socks5 / localhost:1080 .</span><br></pre></td></tr></table></figure></p><p>ç›‘å¬æœ¬åœ°8118ç«¯å£, è½¬å‘åˆ° localhost:1080, è¿™ä¹Ÿæ˜¯ssçš„å®¢æˆ·ç«¯çš„è½¬å‘ç«¯å£</p><p>å¯åŠ¨:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew services start privoxy</span><br></pre></td></tr></table></figure></p><p>è½¬å‘éƒ¨åˆ†å®Œæˆ, æ¥ä¸‹æ¥åœ¨ <code>docker for mac</code>é…ç½®</p><p><code>docker for mac</code> &gt; <code>preferences</code> &gt; <code>Proxies</code> &gt; ç‚¹å‡» <code>Manual proxy configuration</code></p><p><code>Web Server(HTTP)</code> å’Œ <code>Secure Web Server (HTTPS)</code> éƒ½å¡«å…¥ <code>http://{ä½ æœºå™¨IP}:8118</code> æ¯”å¦‚: â€˜<a href="http://192.168.110.203:8118&#39;" target="_blank" rel="noopener">http://192.168.110.203:8118&#39;</a></p><p>ä¸èƒ½ç”¨ 127.0.0.1, å› ä¸º docker for mac å¯åŠ¨å, docker æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¸­,è€Œä¸æ˜¯macOSä¸‹, å› æ­¤è¿™ä¸ªåœ°å€ä»£è¡¨çš„æ„ä¹‰ä¸ä¸€æ ·</p><p>ç‚¹ä¿å­˜, è¿™æ ·å°±èƒ½æ­£å¸¸å®‰è£…k8säº†, å¯ä»¥é€šè¿‡æ´»åŠ¨ç›‘è§†å™¨çœ‹ä¸€ä¸‹ä»–ä»¬çš„æµé‡æ˜¯å¦æ­£å¸¸</p><p><a href="https://juejin.im/post/58dcd8dd44d904006dfe148b" target="_blank" rel="noopener">æ•™ç¨‹æ¥æº</a></p><h4 id="è‡ªå·±é¢„å…ˆåŠ è½½ä¸€å¥—é•œåƒæ¥"><a href="#è‡ªå·±é¢„å…ˆåŠ è½½ä¸€å¥—é•œåƒæ¥" class="headerlink" title="è‡ªå·±é¢„å…ˆåŠ è½½ä¸€å¥—é•œåƒæ¥"></a>è‡ªå·±é¢„å…ˆåŠ è½½ä¸€å¥—é•œåƒæ¥</h4><p>æ‰¾ä¸ªç›®å½•, æ–°å»º <code>images.properties</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">k8s.gcr.io/pause-amd64:3.1=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1</span><br><span class="line">k8s.gcr.io/kube-controller-manager-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager-amd64:v1.10.3</span><br><span class="line">k8s.gcr.io/kube-scheduler-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler-amd64:v1.10.3</span><br><span class="line">k8s.gcr.io/kube-proxy-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy-amd64:v1.10.3</span><br><span class="line">k8s.gcr.io/kube-apiserver-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver-amd64:v1.10.3</span><br><span class="line">k8s.gcr.io/etcd-amd64:3.1.12=registry.cn-hangzhou.aliyuncs.com/google_containers/etcd-amd64:3.1.12</span><br><span class="line">k8s.gcr.io/k8s-dns-sidecar-amd64:1.14.8=registry.cn-hangzhou.aliyuncs.com/google_containers/k8s-dns-sidecar-amd64:1.14.8</span><br><span class="line">k8s.gcr.io/k8s-dns-kube-dns-amd64:1.14.8=registry.cn-hangzhou.aliyuncs.com/google_containers/k8s-dns-kube-dns-amd64:1.14.8</span><br><span class="line">k8s.gcr.io/k8s-dns-dnsmasq-nanny-amd64:1.14.8=registry.cn-hangzhou.aliyuncs.com/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.8</span><br><span class="line">k8s.gcr.io/kubernetes-dashboard-amd64:v1.8.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.8.3</span><br></pre></td></tr></table></figure></p><p>æ–°å»ºè„šæœ¬: <code>kubernetes.sh</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line"></span><br><span class="line">file=<span class="string">"./images.properties"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="string">"<span class="variable">$file</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> found."</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> IFS=<span class="string">'='</span> <span class="built_in">read</span> -r key value</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    <span class="comment">#echo "$&#123;key&#125;=$&#123;value&#125;"</span></span><br><span class="line">    docker pull <span class="variable">$&#123;value&#125;</span></span><br><span class="line">    docker tag <span class="variable">$&#123;value&#125;</span> <span class="variable">$&#123;key&#125;</span></span><br><span class="line">    docker rmi <span class="variable">$&#123;value&#125;</span></span><br><span class="line">  <span class="keyword">done</span> &lt; <span class="string">"<span class="variable">$file</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$file</span> not found."</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure></p><p>è¿è¡Œå°±è¡Œ</p><p><a href="https://my.oschina.net/wubiaowpBlogShare/blog/1921180" target="_blank" rel="noopener">æ•™ç¨‹æ¥æº</a><br><a href="https://github.com/maguowei/k8s-docker-for-mac/tree/master/image" target="_blank" rel="noopener">k8s-docker-for-mac</a></p><h4 id="æ‰¾ä¸ªgcr-ioçš„å›½å†…é•œåƒ"><a href="#æ‰¾ä¸ªgcr-ioçš„å›½å†…é•œåƒ" class="headerlink" title="æ‰¾ä¸ªgcr.ioçš„å›½å†…é•œåƒ"></a>æ‰¾ä¸ªgcr.ioçš„å›½å†…é•œåƒ</h4><p>è¿™ä¸ªæ˜¯åˆ©ç”¨äº†<code>dockerHub</code> å› ä¸ºéƒ½æ˜¯å›½å¤–çš„, å…ˆè®©<code>dockerHub</code>ç»™buildä¸€ä¸‹, ç„¶åç›´æ¥æ‹‰<code>dockerHub</code>çš„é•œåƒæ¥è¿‚å›ä¸€ä¸‹</p><p><a href="https://anjia0532.github.io/2017/11/15/gcr-io-image-mirror/" target="_blank" rel="noopener">Google Container Registry(gcr.io) ä¸­å›½å¯ç”¨é•œåƒ(é•¿æœŸç»´æŠ¤)</a><br><a href="https://github.com/anjia0532/gcr.io_mirror" target="_blank" rel="noopener">gcr.io_mirror</a><br><a href="https://jeremyxu2010.github.io/2018/05/%E5%9F%BA%E4%BA%8Edocker-for-macos%E7%9A%84kubernetes%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2/" target="_blank" rel="noopener">åŸºäºDocker for macOSçš„Kubernetesæœ¬åœ°ç¯å¢ƒæ­å»ºä¸åº”ç”¨éƒ¨ç½²</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;docker for mac&lt;/code&gt; å®‰è£…kubernetesæœ¬æ¥æ˜¯å¾ˆæ–¹ä¾¿çš„, ä½†æ˜¯å›½å†…ç©å®¶è¦æŠ˜è…¾ä¸€ä¸‹, å› ä¸º &lt;code&gt;gcr.io&lt;/code&gt; è¿™ä¸ªåŸŸè¢«å¢™äº†â€¦&lt;/p&gt;
&lt;p&gt;ç›®å‰æ¥çœ‹å‰è¾ˆä»¬å·²ç»æŠŠå‘ç»™æ·Œçš„å·®ä¸å¤šäº†, æˆ‘è€æ—©çš„æ—¶å€™ä¹Ÿè¢«æŠ˜è…¾çš„å¤´ç§ƒ, è¿™é‡Œå°±åšä¸ªæ€»ç»“&lt;br&gt;
    
    </summary>
    
      <category term="k8s" scheme="http://blog.justwe.site/categories/k8s/"/>
    
    
      <category term="k8s" scheme="http://blog.justwe.site/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Jmeter å¯¹Tcpè¿›è¡Œå‹æµ‹</title>
    <link href="http://blog.justwe.site/2019/04/30/tools-jmeter/"/>
    <id>http://blog.justwe.site/2019/04/30/tools-jmeter/</id>
    <published>2019-04-30T09:45:59.000Z</published>
    <updated>2019-04-30T10:35:17.847Z</updated>
    
    <content type="html"><![CDATA[<p>jmeteræ˜¯ä¸ªå¥½å·¥å…·, è·¨å¹³å°, æœ‰GUI, ç®€å•æ˜“ç”¨, æ‰©å±•å¤š</p><a id="more"></a><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>æœ¬åœ°ç¯å¢ƒä¸ºmacOS Mojave 10.14.4</p><p><strong>æœ¬åœ°éœ€è¦å®‰è£…java8</strong><br><a href="https://jmeter.apache.org/download_jmeter.cgi" target="_blank" rel="noopener">jmeterå®˜æ–¹ä¸‹è½½åœ°å€</a><br><a href="https://jmeter-plugins.org/install/Install/" target="_blank" rel="noopener">jmeteræ’ä»¶ä¸‹è½½</a></p><p>å½“å‰ä¸‹è½½çš„jmeterç‰ˆæœ¬ä¸º 5.1.1<br>è§£å‹ä¸‹è½½ä¹‹å, è¿è¡Œå‘½ä»¤:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ~/Downloads/apache-jmeter-5.1.1/bin/jmeter</span><br></pre></td></tr></table></figure></p><p>å°±è¿è¡Œèµ·æ¥äº†</p><h4 id="è¿›è¡Œtcpå‹æµ‹"><a href="#è¿›è¡Œtcpå‹æµ‹" class="headerlink" title="è¿›è¡Œtcpå‹æµ‹"></a>è¿›è¡Œtcpå‹æµ‹</h4><h5 id="é¦–å…ˆåˆ›å»ºThread-Group"><a href="#é¦–å…ˆåˆ›å»ºThread-Group" class="headerlink" title="é¦–å…ˆåˆ›å»ºThread Group"></a>é¦–å…ˆåˆ›å»ºThread Group</h5><p><img src="/images/jmeter/jmeter_1.jpg" alt="img"></p><p>æ³¨æ„å‡ ä¸ªå…³é”®ç‚¹:</p><ul><li>Number of Threads (users)     åˆ›å»ºè¿›ç¨‹ç»„, ç›¸å½“äºå¤šå°‘å¹¶å‘</li><li>Ramp-Up Period (in seconds)   è®¾å®šçš„å¹¶å‘å€¼åœ¨å¤šå°‘ç§’å†…åˆ°è¾¾é¢„æœŸ, æ¨¡æ‹Ÿè‡ªç„¶æµé‡</li><li>Loop Count   æ¯ä¸ªè¿›ç¨‹ç»„å¾ªç¯å¤šå°‘æ¬¡             </li></ul><p><code>Loop Count</code> * <code>Number of Threads</code> å°±æ˜¯æ•´ä½“è¯·æ±‚æ•°é‡äº†</p><h5 id="åˆ›å»ºtcp-Sampler"><a href="#åˆ›å»ºtcp-Sampler" class="headerlink" title="åˆ›å»ºtcp Sampler"></a>åˆ›å»ºtcp Sampler</h5><p><img src="/images/jmeter/jmeter_2.jpg" alt="img"></p><p>è¿™ç¯‡æ–‡ç« æ˜¯ä½¿ç”¨æœ€åŸºæœ¬çš„æ–‡å­—tcpä¼ è¾“</p><p><img src="/images/jmeter/jmeter_3.jpg" alt="img"></p><p>çœ‹å›¾è¯´è¯, TCP classnameé»˜è®¤ä¸º: <code>org.apache.jmeter.protocol.tcp.sampler.TCPClientImpl</code>, å¯ä»¥ç›´æ¥ä» <code>Text to send</code> ä¸­ä¼ å…¥æ–‡æœ¬<br>ä¼ æ–‡æœ¬çš„æ—¶å€™<strong>ä¸€å®š</strong>è¦è¾“å…¥ä¹‹ååŠ ä¸€ä¸ªå›è½¦,å†™<code>\n</code>éƒ½ä¸ç®¡ç”¨, <strong>å¿…é¡»</strong> æ˜¯å›è½¦, å®ƒæ˜¯è‡ªåŠ¨è½¬æ¢çš„, ä¸ç„¶ä¼šé€ æˆæ•°æ®æ‰¾ä¸åˆ°ç»ˆæ­¢æ–­ç‚¹</p><p>å¦‚æœä½¿ç”¨ <code>org.apache.jmeter.protocol.tcp.sampler.BinaryTCPClientImpl</code> åˆ™éœ€è¦åœ¨ <code>End of line byte value</code> é‡Œé¢ä¼ å€¼, é€šå¸¸æ˜¯<code>10</code><br>ä¸”  <code>Text to send</code> ä¼ çš„æ˜¯16è¿›åˆ¶æ•°æ®</p><h4 id="åˆ›å»º-summary-report"><a href="#åˆ›å»º-summary-report" class="headerlink" title="åˆ›å»º summary report"></a>åˆ›å»º summary report</h4><p><img src="/images/jmeter/jmeter_4.jpg" alt="img"></p><p>ç”¨äºåšç»Ÿè®¡è¡¨æ ¼</p><h4 id="åˆ›å»º-view-results-tree"><a href="#åˆ›å»º-view-results-tree" class="headerlink" title="åˆ›å»º view results tree"></a>åˆ›å»º view results tree</h4><p><img src="/images/jmeter/jmeter_5.jpg" alt="img"></p><p>ç”¨äºæŸ¥çœ‹è¯·æ±‚æ•°æ®è¿”å›æ•°æ®</p><h4 id="å®‰è£…cpu-å†…å­˜ç›‘æ§æ’ä»¶"><a href="#å®‰è£…cpu-å†…å­˜ç›‘æ§æ’ä»¶" class="headerlink" title="å®‰è£…cpu/å†…å­˜ç›‘æ§æ’ä»¶"></a>å®‰è£…cpu/å†…å­˜ç›‘æ§æ’ä»¶</h4><p>5.1.1 ç‰ˆæœ¬çš„å’Œä¹‹å‰æœçš„æœ‰äº›ä¸ä¸€æ ·, ç°åœ¨æœ‰äº†ä¸€ä¸ªå†…ç½®çš„æ‰©å±•å•†åº—</p><p><a href="https://jmeter-plugins.org/install/Install/" target="_blank" rel="noopener">æ‰©å±•ä¸‹è½½åœ°å€</a></p><p><code>Download plugins-manager.jar and put it into lib/ext directory, then restart JMeter.</code></p><p>çœ‹åˆ°è¿™å¥è¯æ²¡?  ç‚¹å°±è¡Œäº†, ç„¶åæŠŠå®ƒæ”¾åˆ°jmeterç›®å½• <code>lib/ext</code>ä¸‹,é‡å¯jmeterå°±èƒ½çœ‹åˆ°äº†</p><p><img src="/images/jmeter/jmeter_6.jpg" alt="img"></p><ol><li>ç‚¹è¿›å»æœç´¢ <code>PerfMon</code> ,å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„äº†, ç‚¹å‡»å®‰è£… , ä»æ’ä»¶ç®€ä»‹é‡Œä¹Ÿèƒ½çœ‹åˆ°<a href="https://jmeter-plugins.org/wiki/PerfMon/" target="_blank" rel="noopener">æ–‡æ¡£åœ°å€</a></li><li>åœ¨æ–‡æ¡£ä¸­æ‰¾åˆ° <code>Server Agent</code>çš„<a href="https://github.com/undera/perfmon-agent/blob/master/README.md" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></li><li>åœ¨è¢«æµ‹æœåŠ¡å™¨ä¸­å®‰è£… Server Agent , linux ç›´æ¥è¿è¡Œ <code>serverAgent.sh</code> é»˜è®¤ç«¯å£ä¸º 4444</li></ol><p>æ·»åŠ ç›‘æ§:<br><img src="/images/jmeter/jmeter_7.jpg" alt="img"><br>ç‚¹ <code>Add Row</code> æ·»åŠ ç›®æ ‡æœåŠ¡å™¨çš„ipå’Œç«¯å£å°±è¡Œ, ç«¯å£é»˜è®¤4444</p><p>ä»¥ä¸Šå°±æ˜¯ä¸€å¥—ç®€å•çš„tcpå‹æµ‹æµ‹è¯•äº†</p><p><a href="/2019/04/30/tools-jmeter/">åŸæ–‡åœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;jmeteræ˜¯ä¸ªå¥½å·¥å…·, è·¨å¹³å°, æœ‰GUI, ç®€å•æ˜“ç”¨, æ‰©å±•å¤š&lt;/p&gt;
    
    </summary>
    
      <category term="tools" scheme="http://blog.justwe.site/categories/tools/"/>
    
    
      <category term="jmeter" scheme="http://blog.justwe.site/tags/jmeter/"/>
    
  </entry>
  
  <entry>
    <title>Phpå¼€å‘è¿‡ç¨‹ä¸­ä¸å¸¸ç¢°åˆ°çš„error (2.28æ›´æ–°)</title>
    <link href="http://blog.justwe.site/2019/02/28/php-unsual-mistakes/"/>
    <id>http://blog.justwe.site/2019/02/28/php-unsual-mistakes/</id>
    <published>2019-02-28T02:30:23.000Z</published>
    <updated>2019-02-28T06:25:49.384Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œåšä¸€äº›å¤‡æ³¨,ä»¥é˜²å†æ¬¡ç¢°åˆ°<br><a id="more"></a></p><h3 id="url-å½“ä¸­çš„å‚æ•°æœ‰-amp-timestamp-1234567890è¿™æ ·çš„å­—æ®µä¼šè¢«è½¬ä¹‰æˆxtamp-1234567890"><a href="#url-å½“ä¸­çš„å‚æ•°æœ‰-amp-timestamp-1234567890è¿™æ ·çš„å­—æ®µä¼šè¢«è½¬ä¹‰æˆxtamp-1234567890" class="headerlink" title="url å½“ä¸­çš„å‚æ•°æœ‰ &amp;timestamp=1234567890è¿™æ ·çš„å­—æ®µä¼šè¢«è½¬ä¹‰æˆxtamp=1234567890"></a>url å½“ä¸­çš„å‚æ•°æœ‰ <code>&amp;timestamp=1234567890</code>è¿™æ ·çš„å­—æ®µä¼šè¢«è½¬ä¹‰æˆ<code>xtamp=1234567890</code></h3><p>è¿™ä¸ªä¸ä»…å­˜åœ¨äºé¡µé¢è§£æå½“ä¸­,å½“ä½¿ç”¨ curl è¯·æ±‚æ—¶æ‹¼æ¥çš„å‚æ•°æœ‰è¿™ç§æ ¼å¼çš„ä¹Ÿä¼šå‘ç”Ÿè½¬ä¹‰<br>è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ª:</p><ol><li>æŠŠ timestamp è¿™ä¸ªå‚æ•°æ”¾åœ¨ urlQuery çš„æœ€å‰é¢, <code>?timestamp=1234567890</code> è¿™æ ·é¿å…å‡ºç° <code>&amp;time</code>å‘ç”Ÿè½¬ä¹‰çš„æƒ…å†µ</li><li>å°†<code>&amp;</code>ç”¨<code>&amp;amp;</code>æ¥ä»£æ›¿</li></ol><h3 id="Automatically-populating-HTTP-RAW-POST-DATA-is-deprecated-and-will-be-removed-in-a-future-version"><a href="#Automatically-populating-HTTP-RAW-POST-DATA-is-deprecated-and-will-be-removed-in-a-future-version" class="headerlink" title="Automatically populating $HTTP_RAW_POST_DATA is deprecated and will be removed in a future version."></a>Automatically populating $HTTP_RAW_POST_DATA is deprecated and will be removed in a future version.</h3><p>å‡ºç°è¿™å¥è¯é€šå¸¸è¯´æ˜ä½ åœ¨ç”¨çš„ php ç‰ˆæœ¬æ˜¯5.6.è€Œä¸”åœ¨<code>php&lt;=5.6</code>çš„æ—¶å€™,è¿›è¡Œ <code>application/json</code>æ ¼å¼çš„ post æäº¤ä¼šæŠŠæ•°æ®æ”¾åœ¨<code>$HTTP_RAW_POST_DATA</code>è¿™ä¸ªç³»ç»Ÿå˜é‡é‡Œé¢,åœ¨<code>php&gt;=7</code>çš„æ—¶å€™è¿™ä¸ªå˜é‡è¢«ç§»é™¤äº†,ç»Ÿç»Ÿå½’æ€»åˆ°<code>php://input</code>è¿™é‡Œ<br>è§£å†³æ–¹æ³•:</p><ol><li><p>æ ¹æ®ç³»ç»Ÿæç¤ºçš„èµ°:</p><blockquote><p>Although that indeed would be technically impossible (as $HTTP_RAW_POST_DATA is populated in the bootstrapping phase of the PHP process) allow one to override the setting by means of calling ini_set.</p></blockquote><p> è¦ç¡®ä¿è‡ªå·±çš„ç³»ç»Ÿä¸­æ²¡æœ‰ä½¿ç”¨ <code>HTTP_RAW_POST_DATA</code>è¿™ä¸ªå˜é‡,ç›´æ¥åœ¨<code>php.ini</code>é‡Œé¢ç¦æ‰å®ƒçš„è®¾ç½®,ä½†æ˜¯å®¹æ˜“å‡ºç°ç³»ç»Ÿä¸­åˆæ‰“å¼€çš„æƒ…å†µ(åœ¨æ¡†æ¶ä¸­å¾ˆå¸¸è§)</p></li><li>æ”¹ä¸€ä¸‹è‡ªå·±çš„æäº¤æ–¹å¼, ä½¿ç”¨ <code>application/form-data</code>æˆ–è€…<code>application/x-www-form-urlencoded</code>è¿™ç§æ ¼å¼çš„æäº¤, ç„¶ååœ¨åç«¯æ¥æ”¶æ•°æ®çš„æ—¶å€™å†è½¬æˆè‡ªå·±éœ€è¦çš„æ ¼å¼(é€šå¸¸æ˜¯æ•°ç»„)<br> <a href="https://www.bram.us/2014/10/26/php-5-6-automatically-populating-http_raw_post_data-is-deprecated-and-will-be-removed-in-a-future-version/" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a></li></ol><h3 id="Exception-â€˜yii-db-Exceptionâ€™-with-message-â€˜SQLSTATE-HY000-2002-No-such-file-or-directoryâ€™"><a href="#Exception-â€˜yii-db-Exceptionâ€™-with-message-â€˜SQLSTATE-HY000-2002-No-such-file-or-directoryâ€™" class="headerlink" title="Exception â€˜yii\db\Exceptionâ€™ with message â€˜SQLSTATE[HY000] [2002] No such file or directoryâ€™"></a>Exception â€˜yii\db\Exceptionâ€™ with message â€˜SQLSTATE[HY000] [2002] No such file or directoryâ€™</h3><p>è¿™ç§æƒ…å†µå‡ºç°åœ¨å¹³æ—¶è¿è¡Œçš„å¥½å¥½çš„, ä½†æ˜¯çªç„¶æ¢ cli æ¨¡å¼åè¿™ä¸ªé…ç½®å°±å‡ºé—®é¢˜äº†,åŸå› åœ¨å½“ <code>host=localhost</code>æ—¶èµ°çš„æ˜¯ unix:socket é“¾æ¥, å½“<code>host=127.0.0.1</code>èµ°çš„æ˜¯ tcp é“¾æ¥,è¿™åœ¨<code>php-fpm</code>å’Œ<code>php-cli</code>ä¸­æœ‰ç‚¹åŒºåˆ«,å°¤å…¶æ˜¯æœ¬åœ°æ²¡æœ‰å®‰è£… mysql çš„æ—¶å€™<br>è§£å†³æ–¹æ³•æœ‰ä¸‰ç§:</p><ol><li>å°†æœ¬åœ°é“¾æ¥é…ç½®ç»Ÿä¸€æˆ <code>127.0.0.1</code></li><li>æŸ¥çœ‹ MySQL ä¸­çš„<code>user</code>è¡¨, <code>host=localhost</code>å’Œ<code>host=127.0.0.1</code>æ˜¯ä¸æ˜¯ç”¨çš„åŒä¸€ä¸ªè´¦å·å¯†ç </li><li>é…ç½®<code>php.ini</code>æ–‡ä»¶ä¸­çš„<code>pdo_mysql.default_socket=</code> å†™ä¸Šå®Œæ•´çš„ socket è·¯å¾„<br>ä»¥ä¸Šä¸‰ç§æ–¹æ³•éƒ½å¯ä»¥è¯•ä¸€ä¸‹<br><a href="http://www.cnblogs.com/mengdeep/p/7487910.html" target="_blank" rel="noopener">å‚è€ƒèµ„æ–™</a></li></ol><h3 id="å¸¸é©»å†…å­˜æ—¶å‘ç”Ÿçš„äº‹æƒ…"><a href="#å¸¸é©»å†…å­˜æ—¶å‘ç”Ÿçš„äº‹æƒ…" class="headerlink" title="å¸¸é©»å†…å­˜æ—¶å‘ç”Ÿçš„äº‹æƒ…"></a>å¸¸é©»å†…å­˜æ—¶å‘ç”Ÿçš„äº‹æƒ…</h3><p>è¿™ä¸ªæ˜¯ phper å¾ˆå°‘ç¢°åˆ°ä½†æ˜¯å¾ˆå¸¸è§çš„æƒ…å†µ, æ¯”å¦‚ç”¨ swoole å¯åŠ¨äº†ä¸€ä¸ªå¸¸é©»è¿›ç¨‹çš„æœåŠ¡, é‚£ä¹ˆå°±ä¸€å®šè¦å°å¿ƒä½¿ç”¨é™æ€å˜é‡,åœ¨åŒæ­¥æ¨¡å¼ä¸‹ä¼šå‘ç”Ÿå˜é‡æ±¡æŸ“, è¿˜æœ‰å°±æ˜¯ redis,mysql è¿™ç±»çš„é“¾æ¥,ä½ ä¼šå‘ç°é•¿æ—¶é—´é™ç½®ä»¥åå°±ä¼šå‡ºç°ä¸€äº›æ‘¸ä¸ç€å¤´è„‘çš„é—®é¢˜, è¿™ç§æƒ…å†µä¸å¦¨æƒ³ä¸€ä¸‹æ˜¯ä¸æ˜¯ server ç«¯å›æ”¶äº†è¿™ä¸ª socket,å› æ­¤åœ¨ client ç«¯æ€ä¹ˆéƒ½å†™å…¥ä¸è¿›å».  è¿˜æœ‰å°±æ˜¯ php åœ¨è¯»å–æ¶ˆæ¯çš„æ—¶å€™,å‡ºç°æ¶ˆæ¯è¿‡é•¿çš„æƒ…å†µ,é‚£ä¹ˆå°±è¦è€ƒè™‘EOFç»ˆæ­¢ç¬¦çš„é—®é¢˜äº†â€¦ å•æ¬¡ http æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯å…¨æ–°çš„ä»£ç , ä¸ç”¨è‡ªå·±è€ƒè™‘ gc çš„é—®é¢˜, ä½†æ˜¯åœ¨å¸¸é©»å†…å­˜çš„æ—¶å€™,è¿™äº›å°±æ˜¯ä¸€ä¸ªä¸ªçš„å¤§å‘äº†</p><h3 id="mysql-has-gone-away"><a href="#mysql-has-gone-away" class="headerlink" title="mysql has gone away"></a>mysql has gone away</h3><p>äº§ç”Ÿè¿™ä¸ªé”™è¯¯çš„ä¸»è¦åŸå› æ˜¯ mysql server ç«¯æ–­å¼€äº†é“¾æ¥, client ç«¯è¿˜æ‹¿ç€è¿™ä¸ªå¥æŸ„å»è¯·æ±‚,è§£å†³æ–¹å¼æœ‰ä¸¤ç§:</p><ol><li><p><code>show global variables like &#39;%timeout&#39;;</code> æŸ¥çœ‹ wait_timeout çš„æ—¶é•¿,é€‚å½“çš„è°ƒé•¿ä¸€ç‚¹, è¿™ç§æ–¹æ³•æ²»æ ‡ä¸æ²»æœ¬,è€Œä¸”æœ‰éšæ‚£</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> global wait_timeout=10;</span><br><span class="line">mysql&gt; show global variables like <span class="string">'wait_timeout'</span>;</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨ mysql ä¹‹å‰éœ€è¦ mysql_ping() ä¸€ä¸‹, å¦‚æœå‡ºç°æ–­å¼€çš„é”™è¯¯å°±å¯åŠ¨é‡è¿æœºåˆ¶</p></li></ol><h3 id="js-å’Œ-php-äº¤äº’ä¼ ä¸­æ–‡å‚æ•°çš„ç¼–è§£ç é—®é¢˜"><a href="#js-å’Œ-php-äº¤äº’ä¼ ä¸­æ–‡å‚æ•°çš„ç¼–è§£ç é—®é¢˜" class="headerlink" title="js å’Œ php äº¤äº’ä¼ ä¸­æ–‡å‚æ•°çš„ç¼–è§£ç é—®é¢˜"></a>js å’Œ php äº¤äº’ä¼ ä¸­æ–‡å‚æ•°çš„ç¼–è§£ç é—®é¢˜</h3><p>ä¹‹å‰ç¢°åˆ°äº†é—®é¢˜æ˜¯:<br>åœ¨ php ç«¯ urlencode çš„å€¼ä¸º:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orderid%3D21111111110001954%26pid%3D257742%26reason%3D%E4%B8%AA%E4%BA%BA%E6%96%B9%E9%9D%A2%E5%8E%9F%E5%9B%A0_%E4%BD%BF%E7%94%A8%E7%BA%A2%E5%8C%85%E9%87%8D%E6%96%B0%E4%B8%8B%E5%8D%95%26token%3D041d9e5575f480b7bfd58b09bd14ab1c7ee9e9594f2fcdb9f0e3e39fc634b48f</span><br></pre></td></tr></table></figure></p><p>éœ€è¦ urldecode ä¸€æ¬¡</p><p>è€Œåœ¨ js ç«¯çš„ç»“æœæ˜¯:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orderid%3D21111111110002170%26pid%3D257742%26reason%3D%25E4%25B8%25AA%25E4%25BA%25BA%25E6%2596%25B9%25E9%259D%25A2%25E5%258E%259F%25E5%259B%25A0_%25E4%25B8%25AA%25E4%25BA%25BA%25E8%25BA%25AB%25E4%25BD%2593%25E5%258E%259F%25E5%259B%25A0%26token%3D041d9e5575f480b7bfd58b09bd14ab1c7ee9e9594f2fcdb9f0e3e39fc634b48f</span><br></pre></td></tr></table></figure></p><p>éœ€è¦ urldecode ä¸¤æ¬¡</p><p>æŸ¥é˜…èµ„æ–™å:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">åœ¨åç«¯æ˜¯PHPç¨‹åºçš„æƒ…å†µä¸‹ï¼Œä¿æŒå‰ç«¯Javascriptå’ŒPHPä¹‹é—´ä¼ å€¼çš„ç»Ÿä¸€ç¼–ç å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°è¿›è¡Œå¤„ç†ï¼š</span><br><span class="line"> </span><br><span class="line">WEBå‰ç«¯JavaScript</span><br><span class="line"> </span><br><span class="line">ç¼–ç ï¼šescape(encodeURI(string))</span><br><span class="line"> </span><br><span class="line">è§£ç ï¼šunescape(decodeURI(string))</span><br><span class="line"> </span><br><span class="line">WEBåç«¯Php</span><br><span class="line"> </span><br><span class="line">ç¼–ç ï¼šurlencode(string)</span><br><span class="line"> </span><br><span class="line">è§£ç ï¼šurldecode(urldecode(string))</span><br></pre></td></tr></table></figure></p><p><a href="https://bbs.csdn.net/topics/330072196" target="_blank" rel="noopener">ä¸ºä»€ä¹ˆè¦encodeURI(url)ä¸¤æ¬¡æ‰ä¸ä¼šå‡ºç°ä¹±ç ï¼Ÿ</a></p><h3 id="PHPä¸­rawurlencodeå’Œurlencodeã€JSä¸­encodeURIä¸encodeURIComponent-çš„åŒºåˆ«"><a href="#PHPä¸­rawurlencodeå’Œurlencodeã€JSä¸­encodeURIä¸encodeURIComponent-çš„åŒºåˆ«" class="headerlink" title="PHPä¸­rawurlencodeå’Œurlencodeã€JSä¸­encodeURIä¸encodeURIComponent çš„åŒºåˆ«"></a>PHPä¸­rawurlencodeå’Œurlencodeã€JSä¸­encodeURIä¸encodeURIComponent çš„åŒºåˆ«</h3><p>rawurlencodeéµå®ˆæ˜¯94å¹´å›½é™…æ ‡å‡†å¤‡å¿˜å½•RFC 1738</p><p>urlencodeå®ç°çš„æ˜¯ä¼ ç»Ÿåšæ³•ï¼Œå’Œä¸Šè€…çš„ä¸»è¦åŒºåˆ«æ˜¯å¯¹ç©ºæ ¼çš„è½¬ä¹‰æ˜¯â€™+â€™è€Œä¸æ˜¯â€™%20â€™<br>javascriptçš„encodeURLä¹Ÿæ˜¯94å¹´æ ‡å‡†ï¼Œè€Œjavascriptçš„escapeæ˜¯å¦ä¸€ç§ç”¨â€%xxxâ€æ ‡è®°unicodeç¼–ç çš„æ–¹æ³•ã€‚<br>æ¨èåœ¨PHPä¸­ä½¿ç”¨ç”¨rawurlencodeã€‚å¼ƒç”¨urlencode</p><p>æ ·ä¾‹<br>source:<br>è¶…çº§æ— æ•Œçš„äººsadha sajdhæ•°æ®æ ·æœ¬sdls fhejrthcxzb.file.jpeg </p><p>PHP urlencode:<br>%E8%B6%85%E7%BA%A7%E6%97%A0%E6%95%8C%E7%9A%84%E4%BA%BAsadha+sajdh%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%ACsdls+fhejrthcxzb.file.jpeg </p><p>PHP rawurlencode:<br>%E8%B6%85%E7%BA%A7%E6%97%A0%E6%95%8C%E7%9A%84%E4%BA%BAsadha%20sajdh%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%ACsdls%20fhejrthcxzb.file.jpeg</p><p>Javascript encodeURI|encodeURIComponent:<br>%E8%B6%85%E7%BA%A7%E6%97%A0%E6%95%8C%E7%9A%84%E4%BA%BAsadha%20sajdh%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%ACsdls%20fhejrthcxzb.file.jpeg </p><p>Javascript escape:<br>%u8D85%u7EA7%u65E0%u654C%u7684%u4EBAsadha%20sajdh%u6570%u636E%u6837%u672Csdls%20fhejrthcxzb.file.jpeg</p><p><a href="https://blog.csdn.net/suofiya2008/article/details/6397168" target="_blank" rel="noopener">å¸–å­åŸæ–‡</a></p><p>åœ¨å‰ç«¯è¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯, js çš„ <code>encodeURIComponent</code> å’Œ <code>encodeURI</code> éƒ½ä¸ä¼šè½¬æ¢ <code>_-.!~*&#39;()#</code> è¿™äº›ä¿ç•™å­—ç¬¦, è€Œåœ¨åç«¯çš„<code>rawurlencode</code> åˆ™æ˜¯ä¼šè½¬æ¢çš„, å› æ­¤éœ€è¦å‰ç«¯å•ç‹¬æŠŠè¿™å‡ ä¸ªç»™æ‹å‡ºæ¥, å¦‚ä¸‹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"*"</span>.charCodeAt(<span class="number">0</span>) <span class="comment">// 42</span></span><br><span class="line"><span class="built_in">String</span>.fromCharCode(<span class="number">42</span>) <span class="comment">// *</span></span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæœ‰å¼ å›¾è¯´çš„å¾ˆæ˜ç™½<br><img src="http://blog-image.onlyoneip.com/urlencode.jpeg" alt=""><br><a href="https://www.zhihu.com/question/21861899/answer/91279362" target="_blank" rel="noopener">å›¾ç‰‡æ¥æº</a></p><h3 id="å…³äºå‡ºç°-lt-U-200B-gt-è¿™ç§-zero-width-space-å­—ç¬¦"><a href="#å…³äºå‡ºç°-lt-U-200B-gt-è¿™ç§-zero-width-space-å­—ç¬¦" class="headerlink" title="å…³äºå‡ºç° &lt;U+200B&gt; è¿™ç§ zero-width space å­—ç¬¦"></a>å…³äºå‡ºç° &lt;U+200B&gt; è¿™ç§ zero-width space å­—ç¬¦</h3><p>å¦‚æœå‡ºç° <code>mb_substr</code> è¿™ç±»æ“ä½œçš„æ—¶å€™, ä¼šå‡ºç°å­—æ•°åˆ¤æ–­é”™è¯¯çš„é—®é¢˜, è¿™ä¸ªæœ‰æ—¶å€™å¾ˆéš¾æ’æŸ¥, å› ä¸ºåœ¨ win ä¸Š,ä½¿ç”¨å‘½ä»¤è¡Œæˆ–è€… linux ä¸Šç”¨<code>cat</code>å‘½ä»¤æ˜¯çœ‹ä¸åˆ°å­—ç¬¦é—´æ˜¯æœ‰ &lt;U+200B&gt; çš„, å¦‚ä¸‹:<br><img src="http://blog-image.onlyoneip.com/zero-width%20space.png" alt=""></p><p>è¿™ç©æ„å„¿å‡ºç°çš„åœºæ™¯å°±æ˜¯: åœ¨å‰ç«¯è¾“å…¥æ¡†ä¸­è¾“å…¥å‡ ä¸ªå­—, ç„¶åå¤åˆ¶ç²˜è´´.  è¿™æ ·å°½ç®¡çœ‹èµ·æ¥ä¹‹é—´æ²¡æœ‰ç©ºæ ¼, ä½†æ˜¯å…¶ä¸­è¿˜æ˜¯æ’å…¥äº†è¿™ä¸ªå­—ç¬¦<br>è¿™ä¸ªå°±æ˜¯ <a href="https://zh.wikipedia.org/wiki/%E9%9B%B6%E5%AE%BD%E7%A9%BA%E6%A0%BC" target="_blank" rel="noopener">zero-width space é›¶å®½ç©ºæ ¼</a>, å¤„ç†çš„åŠæ³•ä¹Ÿå¾ˆç®€å•, å‰ç«¯ä¼ å€¼ä¹‹å‰ç»™è¿‡æ»¤ä¸€ä¸‹, æ¯”å¦‚ <a href="https://stackoverflow.com/questions/7055600/u200b-zero-width-space-characters-in-my-js-code-where-did-they-come-from" target="_blank" rel="noopener">https://stackoverflow.com/questions/7055600/u200b-zero-width-space-characters-in-my-js-code-where-did-they-come-from</a> æˆ– <a href="https://codeday.me/bug/20171122/97765.html" target="_blank" rel="noopener">https://codeday.me/bug/20171122/97765.html</a></p><p>åç«¯ php å¤„ç†çš„è¯å’Œè¿™ä¸ªä¸ä¸€æ ·, ä½¿ç”¨ utf-8 çš„å¤„ç†æ–¹å¼, å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://blog.csdn.net/qq_28018283/article/details/54136480" target="_blank" rel="noopener">ç‰¹æ®Šå­—ç¬¦<200b><200c><200d>çš„åˆ é™¤åŠæ³•ä¸åŸç†</200d></200c></200b></a></p><p>æ›¿æ¢è¿™ç§ç¼–ç <br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$value = str_replace(<span class="string">"\xe2\x80\x8b"</span>, <span class="string">''</span>, $value);</span><br><span class="line">$value = str_replace(<span class="string">"\xe2\x80\x8c"</span>, <span class="string">''</span>, $value);</span><br><span class="line">$value = str_replace(<span class="string">"\xe2\x80\x8d"</span>, <span class="string">''</span>, $value);</span><br></pre></td></tr></table></figure></p><p>ç¼–ç å¯¹ç…§å¦‚ä¸‹:<br><img src="http://blog-image.onlyoneip.com/zero-width-space-2.png" alt=""></p><h3 id="mac-è®¾ç½®crontab-e-ï¼š-â€œ-usr-bin-viâ€-exited-with-status-1"><a href="#mac-è®¾ç½®crontab-e-ï¼š-â€œ-usr-bin-viâ€-exited-with-status-1" class="headerlink" title="mac è®¾ç½®crontab -e ï¼š â€œ/usr/bin/viâ€ exited with status 1"></a>mac è®¾ç½®crontab -e ï¼š â€œ/usr/bin/viâ€ exited with status 1</h3><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> EDITOR=vim</span><br><span class="line">sudo touch /etc/crontab</span><br><span class="line">crontab -e</span><br><span class="line">crontab -l</span><br></pre></td></tr></table></figure></p><p>æŠŠé»˜è®¤ç¼–è¾‘å™¨ä» vi æ”¹æˆ vim</p><p><a href="https://segmentfault.com/a/1190000013774374" target="_blank" rel="noopener">åŸæ–‡</a></p><h3 id="å‡ºç°-The-â€œhttps-bower-herokuapp-com-packages-jquery-quot-file-could-not-be-downloaded-HTTP-1-1-502-Bad-Gateway"><a href="#å‡ºç°-The-â€œhttps-bower-herokuapp-com-packages-jquery-quot-file-could-not-be-downloaded-HTTP-1-1-502-Bad-Gateway" class="headerlink" title="å‡ºç°: The â€œhttps://bower.herokuapp.com/packages/jquery&quot; file could not be downloaded (HTTP/1.1 502 Bad Gateway)"></a>å‡ºç°: The â€œ<a href="https://bower.herokuapp.com/packages/jquery&quot;" target="_blank" rel="noopener">https://bower.herokuapp.com/packages/jquery&quot;</a> file could not be downloaded (HTTP/1.1 502 Bad Gateway)</h3><p>yii2 æ›´æ–°çš„æ—¶å€™é™æ€èµ„æºå‡ºç°é—®é¢˜, æ‰§è¡Œ <code>composer global require &quot;fxp/composer-asset-plugin:~1.4.4&quot;</code></p><p><a href="https://stackoverflow.com/questions/51441090/yii2-bower-error-heroku" target="_blank" rel="noopener">é—®é¢˜æ¥æº</a></p><h3 id="å‡ºç°-Jquery-UI-1-11-4-and-jquery-3-0-çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜"><a href="#å‡ºç°-Jquery-UI-1-11-4-and-jquery-3-0-çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜" class="headerlink" title="å‡ºç°: Jquery UI 1.11.4 and jquery 3.0 çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜"></a>å‡ºç°: Jquery UI 1.11.4 and jquery 3.0 çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜</h3><p>è¿™ä¸ªæ˜¯åœ¨éƒ¨ç½² adminLTE + rbac æ—¶å€™é‡ä¸Šçš„, æ‰“å¼€ <code>/admin/menu/create</code> ä¼šæŠ¥ <code>Jquery UI error - f.getClientRects is not a function</code> é”™è¯¯</p><p>è§£å†³æ–¹æ³•:<br>é…ç½®æ–‡ä»¶: config/web.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"> <span class="string">'components'</span> =&gt; [</span><br><span class="line">     ...</span><br><span class="line">        <span class="comment">//é™æ€èµ„æº</span></span><br><span class="line">        <span class="string">'assetManager'</span> =&gt; [</span><br><span class="line">            ...</span><br><span class="line">            <span class="string">'assetMap'</span> =&gt; [</span><br><span class="line">                <span class="string">'jquery.js'</span> =&gt; <span class="string">'https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js'</span>, <span class="comment">// </span></span><br><span class="line">                <span class="string">'jquery.min.js'</span> =&gt; <span class="string">'https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js'</span>,</span><br><span class="line"><span class="comment">//                'jquery.js' =&gt; '@web/js/jquery/jquery.js',</span></span><br><span class="line"><span class="comment">//                'jquery.min.js' =&gt; '@web/js/jquery/jquery.js',</span></span><br><span class="line">            ],</span><br><span class="line">            ...</span><br><span class="line">        ],</span><br><span class="line">    ...</span><br><span class="line"> ]</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>æŠŠç›¸åº”çš„ jquery æ›¿æ¢æˆ <code>v2.2.4</code> è§£å†³<br><a href="https://stackoverflow.com/questions/37914869/jquery-ui-error-f-getclientrects-is-not-a-function" target="_blank" rel="noopener">é—®é¢˜æ¥æº</a></p><h3 id="macOS-brewå®‰è£…php7-1-ä»¥åŠswooleæ‰©å±•"><a href="#macOS-brewå®‰è£…php7-1-ä»¥åŠswooleæ‰©å±•" class="headerlink" title="macOS brewå®‰è£…php7.1 ä»¥åŠswooleæ‰©å±•"></a>macOS brewå®‰è£…php7.1 ä»¥åŠswooleæ‰©å±•</h3><p>brewæ”¹ç‰ˆåå†…æ ¸é›†æˆäº†php, æ‰€ä»¥å¯ä»¥ç›´æ¥å®‰è£…<br>å®‰è£…php<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install php@7.1</span><br></pre></td></tr></table></figure></p><p>æŒ‰æç¤ºæŠŠ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/php@7.1/bin:$PATH"'</span> &gt;&gt; ~/.zshrc</span><br><span class="line"><span class="built_in">echo</span> <span class="string">'export PATH="/usr/local/opt/php@7.1/sbin:$PATH"'</span> &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure></p><p>è¿™äº›æ”¾åˆ°ä½ æœ¬åœ°å‘½ä»¤è¡Œé…ç½®é‡Œé¢, ç„¶åç”Ÿæˆä¸€ä¸ªè½¯é“¾<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew link php@7.1 --force</span><br></pre></td></tr></table></figure></p><p>å®‰è£…æ‰©å±•å°±å¾—ä½¿ç”¨peclå·¥å…·äº†<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/opt/php@7.1       <span class="comment"># æ‰§è¡Œå®Œ brew link ä¹‹åå°±æŒ‰è½¯é“¾çš„æ¥, è¿™æ ·çš„å¥½å¤„å°±æ˜¯ä¸ç”¨è®°å°ç‰ˆæœ¬å·, è·¯å¾„çŸ­</span></span><br><span class="line">pecl install swoole             <span class="comment"># æç¤º 'openssl/ssl.h' file not found å°±æ˜¯ä½ å®‰è£…çš„æ—¶å€™åˆ«é€‰ sslæ”¯æŒå°±è¡Œ</span></span><br></pre></td></tr></table></figure></p><p>å¦‚æœæç¤º <code>No releases available for package â€œpecl.php.net/swooleâ€</code><br>å‚è€ƒ <a href="https://blog.joefom.com/archives/137" target="_blank" rel="noopener">æ‰§è¡Œ â€˜pecl install swooleâ€™ä¹‹åï¼Œé‡åˆ°çš„ä¸€äº›å‘</a> , æŒ‰æç¤ºä¸€æ­¥æ­¥èµ°åº”è¯¥æ²¡é—®é¢˜</p><p>å®‰è£…å®Œæ¯•ä¹‹åéœ€è¦å˜ä¸€ä¸‹é…ç½®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php -i | grep .ini</span><br><span class="line">...</span><br><span class="line">Loaded Configuration File =&gt; /usr/<span class="built_in">local</span>/etc/php/7.1/php.ini     //å½“å‰åŠ è½½çš„é…ç½®æ–‡ä»¶è·¯å¾„</span><br><span class="line">...</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/etc/php/7.1</span><br></pre></td></tr></table></figure></p><p>å…ˆåˆ é™¤ php.ini é‡Œé¢ç¬¬ä¸€è¡Œçš„ <code>extension=swoole.so</code> æ”¹æˆè¿™ä¸ªsoæ–‡ä»¶çš„çœŸå®è·¯å¾„, æ¨èæ”¾åˆ°éš”å£çš„ conf.d ç›®å½•åº•ä¸‹<br>ç„¶å<code>php -m | grep sw</code> å¯ä»¥çœ‹ä¸€ä¸‹äº†<br>å®‰è£…å…¶ä»–æ‰©å±•ä¹Ÿæ˜¯æŒ‰è¿™ä¸ªè·¯æ•°æ¥</p><h3 id="å‡ºç°-Connection-reset-by-peer-æŠ¥é”™"><a href="#å‡ºç°-Connection-reset-by-peer-æŠ¥é”™" class="headerlink" title="å‡ºç° Connection reset by peer æŠ¥é”™"></a>å‡ºç° Connection reset by peer æŠ¥é”™</h3><p>è¿™æ˜¯ä¸ªtcpé“¾æ¥ä¸Šçš„é”™è¯¯, æ„å‘³ç€ <code>é“¾æ¥è¿‡ç¨‹ä¸­è¯»æˆ–è€…å†™å‡ºç°å¼‚å¸¸</code>, å‡ºç°çš„åŸå› :</p><ol><li>ABä¸¤ç«¯, Aç«¯å…³é—­äº†é“¾æ¥, Bç«¯ä»åœ¨å‘é€, åˆ™æŠ›å¼‚å¸¸</li><li>ABä¸¤ç«¯, Aé€€å‡ºä½†æ²¡å…³é—­é“¾æ¥, åˆ™Båœ¨è¯»çš„æ—¶å€™æŠ›å¼‚å¸¸</li></ol><p>æ’æŸ¥:</p><ol><li>å…ˆçœ‹çœ‹serverç«¯æ˜¯ä¸æ˜¯å¯¹åŒ…å¤§å°è¿›è¡Œäº†é™åˆ¶, bufferåˆ†é…æ˜¯å¦è¶³å¤Ÿ</li><li>æ˜¯ä¸æ˜¯ç¨‹åºé“¾æ¥åˆ°ä¸Šé™äº†, è¢«æœåŠ¡å™¨è¯¯æ€</li><li>é˜²ç«å¢™é—®é¢˜</li></ol><h3 id="Warning-preg-match-function-preg-match-Compilation-failed-PCRE-does-not-support-L-l-N-U-or-u-at"><a href="#Warning-preg-match-function-preg-match-Compilation-failed-PCRE-does-not-support-L-l-N-U-or-u-at" class="headerlink" title="Warning: preg_match() [function.preg-match]: Compilation failed: PCRE does not support \L, \l, \N, \U, or \u at"></a>Warning: preg_match() [function.preg-match]: Compilation failed: PCRE does not support \L, \l, \N, \U, or \u at</h3><p>phpæ­£åˆ™åŒ¹é…ä¸­æ–‡å­—ç¬¦çš„æ—¶å€™, ä½¿ç”¨ <code>/^[\u4e00-\u9fa5]+$/</code> è¿™ä¸€æ¡å°±ä¼šæŠ¥ä¸Šé¢çš„é”™è¯¯, æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">"phpç¼–ç¨‹"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/^[\x&#123;4e00&#125;-\x&#123;9fa5&#125;]+$/u"</span>,$str)) &#123;</span><br><span class="line"><span class="keyword">print</span>(<span class="string">"è¯¥å­—ç¬¦ä¸²å…¨éƒ¨æ˜¯ä¸­æ–‡"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">print</span>(<span class="string">"è¯¥å­—ç¬¦ä¸²ä¸å…¨éƒ¨æ˜¯ä¸­æ–‡"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://www.cnblogs.com/seanxyh/archive/2013/04/03/2998596.html" target="_blank" rel="noopener">php preg_match æ­£åˆ™åŒ¹é…ä¸­æ–‡</a></p><h3 id="phpåŒ¹é…-UTF-8-with-DOM-çš„å­—ç¬¦"><a href="#phpåŒ¹é…-UTF-8-with-DOM-çš„å­—ç¬¦" class="headerlink" title="phpåŒ¹é… UTF-8 with DOM çš„å­—ç¬¦"></a>phpåŒ¹é… UTF-8 with DOM çš„å­—ç¬¦</h3><p>è¿™ä¸ªå’Œä¸Šé¢çš„åŒ¹é…ä¸­æ–‡æ˜¯ä¸€èµ·å‡ºç°çš„, winä¸Šä½¿ç”¨ UTF-8 æ ¼å¼çš„txtæ–‡ä»¶åœ¨linuxä¸Šæ‰“å¼€å°±ä¼šå˜æˆ  <code>UTF-8 with DOM</code> è¿™ä¸ªç±»å‹, æ–‡ä»¶å†…å®¹ä¸­ä¼šå­˜åœ¨domå¤´, ä»è€Œå¹²æ‰°åˆ°ä¸€äº›åˆ¤æ–­, æ¯”å¦‚æ­£åˆ™åŒ¹é…<br>è§£å†³åŠæ³•ä¹Ÿç®€å•, å»æ‰å°±è¡Œ<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€å•çš„å°†winä¸Šçš„txtæ–‡ä»¶è½¬æˆutf-8æ ¼å¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toUTF8</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">        $type = mb_detect_encoding($str, <span class="keyword">array</span>(<span class="string">"ASCII"</span>,<span class="string">"UTF-8"</span>,<span class="string">"GB2312"</span>,<span class="string">"GBK"</span>,<span class="string">"BIG5"</span>));</span><br><span class="line">        $result = iconv($type, <span class="string">'UTF-8//IGNORE'</span>, $str);</span><br><span class="line">        <span class="comment">// é˜²æ­¢UTF-8 with BOM çš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">return</span> trim($result, <span class="string">"\xEF\xBB\xBF"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸è¿‡ <code>utf-8 with dom</code> å¯¹phpæ¥è¯´æ˜¯ä¸ªéšæ‚£, å› ä¸ºphpæ²¡æœ‰å¯¹è¿™å—çš„å¤„ç†, ä¼šå‡ºç°<code>ZERO WIDTH NO-BREAK SPACE</code>è¿™æ ·çš„é—®é¢˜, æœ‰æ•°æ®ä½†æ˜¯ä¸ä¼šåœ¨é¡µé¢è¾“å‡º</p><p>å‚è€ƒ:<br><a href="https://blog.csdn.net/wb_ustc/article/details/3575768" target="_blank" rel="noopener">PHP UTF-8çš„ BOM é—®é¢˜è§£å†³</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™é‡Œåšä¸€äº›å¤‡æ³¨,ä»¥é˜²å†æ¬¡ç¢°åˆ°&lt;br&gt;
    
    </summary>
    
      <category term="php" scheme="http://blog.justwe.site/categories/php/"/>
    
    
      <category term="php" scheme="http://blog.justwe.site/tags/php/"/>
    
      <category term="debug" scheme="http://blog.justwe.site/tags/debug/"/>
    
  </entry>
  
  <entry>
    <title>2019 ç›®æ ‡</title>
    <link href="http://blog.justwe.site/2019/02/18/2019-goal/"/>
    <id>http://blog.justwe.site/2019/02/18/2019-goal/</id>
    <published>2019-02-18T09:44:29.000Z</published>
    <updated>2019-02-18T10:04:51.888Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥å‰æ˜¯æ²¡é’±æ²¡æ—¶é—´, ç°åœ¨æˆ‘æƒ³åšä¸ªæœ‰è§„åˆ’çš„äºº:</p><ul><li>å»ä¸€è¶ŸåŠ æ‹¿å¤§è§ä¸€ä¸ªäºº</li><li>æ‹¿é©¾ç…§</li><li>çœ‹5æœ¬æŠ€æœ¯ä¹¦, è¾¾åˆ°ç†è§£80%çš„ç¨‹åº¦, ç¬”è®°è·Ÿä¸Š</li><li>å¥èº«, æœ€ä½ç›®æ ‡30åˆ†é’Ÿ5å…¬é‡Œ</li><li>è¿‡200é“leetcode, hardéš¾åº¦ä»¥ä¸‹éœ€è¦æƒ³å‡ºæ¬¡ä¼˜è§£, hard éš¾åº¦èƒ½åšåˆ°ç†è§£æœ€ä¼˜è§£</li></ul><p>ä»¥ä¸Šèƒ½å®Œæˆçš„è¯å°±æ¥ä¸‹æ¥:</p><ul><li>è‡ªå·±æä¸€ä¸ªåŸºäºk8sçš„å¾®æœåŠ¡æ¶æ„</li></ul><p>è¿™äº›ç›®æ ‡æˆªæ­¢åˆ° 2020-2-18å· å§</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä»¥å‰æ˜¯æ²¡é’±æ²¡æ—¶é—´, ç°åœ¨æˆ‘æƒ³åšä¸ªæœ‰è§„åˆ’çš„äºº:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å»ä¸€è¶ŸåŠ æ‹¿å¤§è§ä¸€ä¸ªäºº&lt;/li&gt;
&lt;li&gt;æ‹¿é©¾ç…§&lt;/li&gt;
&lt;li&gt;çœ‹5æœ¬æŠ€æœ¯ä¹¦, è¾¾åˆ°ç†è§£80%çš„ç¨‹åº¦, ç¬”è®°è·Ÿä¸Š&lt;/li&gt;
&lt;li&gt;å¥èº«, æœ€ä½ç›®æ ‡30åˆ†é’Ÿ5å…¬é‡Œ&lt;/li&gt;
&lt;li&gt;è¿‡200é“leet
      
    
    </summary>
    
    
      <category term="default" scheme="http://blog.justwe.site/tags/default/"/>
    
  </entry>
  
  <entry>
    <title>è½¬ Golang éœ€è¦é¿å…è¸©çš„ 50 ä¸ªå‘</title>
    <link href="http://blog.justwe.site/2019/01/31/go-50-tips/"/>
    <id>http://blog.justwe.site/2019/01/31/go-50-tips/</id>
    <published>2019-01-31T02:18:33.000Z</published>
    <updated>2019-01-31T02:51:52.195Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/wuYin/blog/blob/master/50-shades-of-golang-traps-gotchas-mistakes.md" target="_blank" rel="noopener">Golang éœ€è¦é¿å…è¸©çš„ 50 ä¸ªå‘</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://github.com/wuYin/blog/blob/master/50-shades-of-golang-traps-gotchas-mistakes.md&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Golang éœ€
      
    
    </summary>
    
      <category term="ç²¾é€‰è½¬è½½" scheme="http://blog.justwe.site/categories/%E7%B2%BE%E9%80%89%E8%BD%AC%E8%BD%BD/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>å…³äº Go çš„ for Range ä¸Šçš„ä¸€ä¸ªå‘</title>
    <link href="http://blog.justwe.site/2019/01/30/go-for-range-error/"/>
    <id>http://blog.justwe.site/2019/01/30/go-for-range-error/</id>
    <published>2019-01-30T08:22:57.000Z</published>
    <updated>2019-01-30T10:12:38.839Z</updated>
    
    <content type="html"><![CDATA[<p><code>range</code>ä½œä¸ºgoçš„ä¸€ä¸ªè¯­æ³•ç³–åœ¨è¿›è¡Œè¿­ä»£çš„æ—¶å€™æ˜¯å¾ˆæ–¹ä¾¿çš„, ä½†6æ˜¯ä¼ å€èµ‹å€¼çš„æ—¶å€™éœ€è¦å°å¿ƒä¸€ç‚¹</p><a id="more"></a><h5 id="å‡ºç°é—®é¢˜"><a href="#å‡ºç°é—®é¢˜" class="headerlink" title="å‡ºç°é—®é¢˜"></a>å‡ºç°é—®é¢˜</h5><p>ç›´æ¥ä¸Šä»£ç :</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">slice := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]*<span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, value := <span class="keyword">range</span> slice &#123;</span><br><span class="line">fmt.Printf(<span class="string">"value's memery address: %v | value's value: %v \n"</span>, &amp;value, value)</span><br><span class="line">myMap[index] = &amp;value</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">"=====new map by range====="</span>)</span><br><span class="line">fmt.Printf(<span class="string">"result: %v \n"</span>, myMap)</span><br><span class="line">prtMap(myMap)</span><br><span class="line"></span><br><span class="line">myMap2 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]*<span class="keyword">int</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(slice); i++ &#123;</span><br><span class="line">myMap2[i] = &amp;slice[i]</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(<span class="string">"=====new map by for====="</span>)</span><br><span class="line">fmt.Printf(<span class="string">"result: %v \n"</span>, myMap2)</span><br><span class="line">prtMap(myMap2)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">prtMap</span><span class="params">(myMap <span class="keyword">map</span>[<span class="keyword">int</span>]*<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">fmt.Printf(<span class="string">"map[%v]=%v\n"</span>, key, *value)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">value<span class="string">'s memery address: 0xc0000160a8 | value'</span>s value: 0</span><br><span class="line">value<span class="string">'s memery address: 0xc0000160a8 | value'</span>s value: 1</span><br><span class="line">value<span class="string">'s memery address: 0xc0000160a8 | value'</span>s value: 2</span><br><span class="line">value<span class="string">'s memery address: 0xc0000160a8 | value'</span>s value: 3</span><br><span class="line">=====new map by range=====</span><br><span class="line">result: map[0:0xc0000160a8 1:0xc0000160a8 2:0xc0000160a8 3:0xc0000160a8]</span><br><span class="line">map[1]=3</span><br><span class="line">map[2]=3</span><br><span class="line">map[3]=3</span><br><span class="line">map[0]=3</span><br><span class="line">i<span class="string">'s memery address: 0xc000016120 | value: 0</span></span><br><span class="line"><span class="string">i'</span>s memery address: 0xc000016120 | value: 1</span><br><span class="line">i<span class="string">'s memery address: 0xc000016120 | value: 2</span></span><br><span class="line"><span class="string">i'</span>s memery address: 0xc000016120 | value: 3</span><br><span class="line">=====new map by <span class="keyword">for</span>=====</span><br><span class="line">result: map[2:0xc00001c110 3:0xc00001c118 0:0xc00001c100 1:0xc00001c108]</span><br><span class="line">map[2]=2</span><br><span class="line">map[3]=3</span><br><span class="line">map[0]=0</span><br><span class="line">map[1]=1</span><br></pre></td></tr></table></figure></p><h5 id="çŒœæµ‹åŸå› "><a href="#çŒœæµ‹åŸå› " class="headerlink" title="çŒœæµ‹åŸå› "></a>çŒœæµ‹åŸå› </h5><p><code>range</code> å’Œ <code>for</code>  è¿›è¡Œèµ‹å€¼æ“ä½œ<strong>åªæ‰§è¡Œäº†ä¸€æ¬¡</strong>, å› æ­¤åœ¨ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­ <code>value</code>å’Œ<code>i</code>çš„å†…å­˜åœ°å€åœ¨å¾ªç¯çš„æ—¶å€™éƒ½æ²¡å˜è¿‡, åœ¨è¿›è¡Œå€¼æ‹·è´çš„æ—¶å€™æ˜¯æ²¡é—®é¢˜çš„, ä½†æ˜¯ä¸€æ—¦åŠ ä¸Š <code>&amp;</code> çš„æ—¶å€™å°±å˜å¾—å¾ˆå±é™©äº†, é€ æˆçš„ç»“æœå°±æ˜¯ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­çš„é—®é¢˜, æ–°æ•°ç»„å­˜çš„éƒ½æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€, åœ¨ for å¾ªç¯çš„æ—¶å€™å› ä¸ºåªæ˜¯åˆ©ç”¨çš„ç´¢å¼•, æ²¡æœ‰ç›´æ¥ç”¨åˆ°åˆ‡ç‰‡çš„å€¼è€Œä¸ä¼šå¼•å‘è¿™äº›é—®é¢˜, åœ¨ range çš„æ—¶å€™ä¼šå‡ºç° key,value åŒæ—¶å‡ºç°,é‚£ä¹ˆå°±è¦å°å¿ƒå¤„ç†äº†, å› ä¸ºè¿™é‡Œçš„valueå¹¶ä¸æ˜¯åˆ‡ç‰‡ä¸­çš„åŸå€¼, è€Œæ˜¯ä¸€ä¸ªæ‹·è´å‡ºæ¥çš„</p><p><a href="https://www.jianshu.com/p/35c2662b5b57" target="_blank" rel="noopener">Go Range å†…éƒ¨å®ç°</a><br><a href="https://studygolang.com/articles/9701" target="_blank" rel="noopener">goè¯­è¨€å‘ä¹‹for range</a></p><h5 id="ç±»ä¼¼çš„é—®é¢˜"><a href="#ç±»ä¼¼çš„é—®é¢˜" class="headerlink" title="ç±»ä¼¼çš„é—®é¢˜"></a>ç±»ä¼¼çš„é—®é¢˜</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">wg := sync.WaitGroup&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"i is %d \n"</span>, i)</span><br><span class="line">wg.Done()</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡º 4,4,4,4</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå’Œä¸Šä¸€ä¸ªçš„é—®é¢˜è¿˜ä¸ä¸€æ ·, è¿™ä¸ªå°±æ˜¯é—­åŒ…çš„æ‰§è¡Œé¡ºåºä»¥åŠå˜é‡ä½œç”¨åŸŸçš„é—®é¢˜, åœ¨æ‰§è¡Œé—­åŒ…çš„æ—¶å€™forå¾ªç¯å·²ç»æ‰§è¡Œå®Œæ¯•,æ­¤æ—¶i=4, æ¥ä¸‹æ¥æ‰ä¼šæ‰§è¡Œé—­åŒ…å†…çš„å‡½æ•°, è§„é¿è¿™ä¸ªé—®é¢˜ä¹Ÿç®€å•, æŠŠå˜é‡çš„ä½œç”¨åŸŸæ”¹ä¸€ä¸‹å°±è¡Œ, è¿˜æœ‰å°±æ˜¯å‡½æ•°å‚æ•°çš„å€¼æ‹·è´ç‰¹ç‚¹<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">4</span>; i++ &#123;</span><br><span class="line">wg.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">"i is %d \n"</span>, i)</span><br><span class="line">wg.Done()</span><br><span class="line">&#125;(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://studygolang.com/articles/4313" target="_blank" rel="noopener">é—­åŒ…å’Œå˜é‡ä½œç”¨åŸŸ</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;code&gt;range&lt;/code&gt;ä½œä¸ºgoçš„ä¸€ä¸ªè¯­æ³•ç³–åœ¨è¿›è¡Œè¿­ä»£çš„æ—¶å€™æ˜¯å¾ˆæ–¹ä¾¿çš„, ä½†6æ˜¯ä¼ å€èµ‹å€¼çš„æ—¶å€™éœ€è¦å°å¿ƒä¸€ç‚¹&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="range" scheme="http://blog.justwe.site/tags/range/"/>
    
  </entry>
  
  <entry>
    <title>è½¬ Macä¸Šä¸€äº›å¥½ç©çš„å‘½ä»¤è¡Œå·¥å…·</title>
    <link href="http://blog.justwe.site/2019/01/18/tool-mac-terminal-awesome/"/>
    <id>http://blog.justwe.site/2019/01/18/tool-mac-terminal-awesome/</id>
    <published>2019-01-18T10:26:42.000Z</published>
    <updated>2019-01-21T09:55:22.514Z</updated>
    
    <content type="html"><![CDATA[<p>macä¸Šä¸€äº›æœ‰æ„æ€çš„å‘½ä»¤è¡Œå°å·¥å…·</p><a id="more"></a><h3 id="asciinema-å’Œ-svg-term"><a href="#asciinema-å’Œ-svg-term" class="headerlink" title="asciinema å’Œ  svg-term"></a>asciinema å’Œ  svg-term</h3><p>assiiname æ˜¯ç”¨æ¥å‘½ä»¤è¡Œå½•å±çš„, svg-term å°†æ–‡ä»¶è½¬æ¢æˆsvgåŠ¨å›¾, è¿™ä¸ªåšæˆªå±å¾ˆæ–¹ä¾¿</p><p>å®‰è£…:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install asciinema</span><br><span class="line">npm install -g svg-term</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨æ–¹å¼:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">asciinema rec cast.json   // å¼€å§‹å½•åˆ¶, æ•°æ®ä¿å­˜åœ¨cast.json, æŒ‰ ctrl+d ä¿å­˜</span><br><span class="line">cat cast.json | svg-term-cli   //è¾“å‡ºsvgæ–‡ä»¶</span><br></pre></td></tr></table></figure></p><p>æ¯”å¦‚ä¸‹å›¾<br><img src="/images/terminal/demo.svg" alt="å›¾ç‰‡"><br>ç¼ºç‚¹å°±æ˜¯å¦‚æœæ–‡ä»¶ç‰¹åˆ«å¤§å¸§ç‡å—åˆ°ä¸¥é‡çš„å½±å“</p><h4 id="sl-å’Œ-cmatrix-å°ç‰¹æ•ˆç©å…·"><a href="#sl-å’Œ-cmatrix-å°ç‰¹æ•ˆç©å…·" class="headerlink" title="sl å’Œ cmatrix å°ç‰¹æ•ˆç©å…·"></a>sl å’Œ cmatrix å°ç‰¹æ•ˆç©å…·</h4><p>å®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install sl</span><br><span class="line">brew install cmatrix</span><br></pre></td></tr></table></figure></p><p>å¹³æ—¶è£…å“”ç”¨çš„</p><h4 id="bat"><a href="#bat" class="headerlink" title="bat"></a>bat</h4><p>å®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install bat</span><br></pre></td></tr></table></figure></p><p>æ›¿ä»£ <code>cat</code> å‘½ä»¤, æ”¯æŒä»£ç é«˜äº®</p><h4 id="ncdu-æ¸…ç†ç£ç›˜"><a href="#ncdu-æ¸…ç†ç£ç›˜" class="headerlink" title="ncdu æ¸…ç†ç£ç›˜"></a>ncdu æ¸…ç†ç£ç›˜</h4><p>å¦‚æ ‡é¢˜, æ¸…ç†ç£ç›˜, ç›´æ¥è¿è¡Œå°±è¡Œ</p><p>å®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install ncdu</span><br></pre></td></tr></table></figure></p><p>æ”¶è—é“¾æ¥:<br><a href="https://juejin.im/post/5c3dcecef265da6163024b1c" target="_blank" rel="noopener">ä¼˜ç§€çš„å‘½ä»¤è¡Œå·¥å…·æ•´ç†ï¼ˆä¸€ï¼‰</a><br><a href="https://juejin.im/post/5c418e2df265da616501d461" target="_blank" rel="noopener">ä¼˜ç§€çš„å‘½ä»¤è¡Œå·¥å…·æ•´ç†ï¼ˆäºŒï¼‰</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;macä¸Šä¸€äº›æœ‰æ„æ€çš„å‘½ä»¤è¡Œå°å·¥å…·&lt;/p&gt;
    
    </summary>
    
      <category term="tools" scheme="http://blog.justwe.site/categories/tools/"/>
    
    
      <category term="tools" scheme="http://blog.justwe.site/tags/tools/"/>
    
      <category term="mac" scheme="http://blog.justwe.site/tags/mac/"/>
    
      <category term="terminal" scheme="http://blog.justwe.site/tags/terminal/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨Gorilla Websocket æä¸€ä¸ªèŠå¤©å®¤</title>
    <link href="http://blog.justwe.site/2019/01/15/go-chat/"/>
    <id>http://blog.justwe.site/2019/01/15/go-chat/</id>
    <published>2019-01-15T03:27:36.000Z</published>
    <updated>2019-01-15T05:47:41.682Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸ªdemoå®ç°äº†:</p><ol><li>æ¶ˆæ¯å¹¿æ’­</li><li>å¿ƒè·³æ£€æµ‹</li></ol><p>æä¾›äº†ä¸€ä¸ªé€šè¿‡å‘½ä»¤è¡Œæ¥è¿›è¡ŒèŠå¤©çš„ä¾‹å­</p><a id="more"></a><p>å…·ä½“é€»è¾‘éƒ½åœ¨ websocket.go è¿™ä¸ªæ–‡ä»¶é‡Œ</p><p>è¿™é‡Œçš„æ ¸å¿ƒå°±æ˜¯ <code>aliveList</code> è¿™ä¸ªå…¨å±€å˜é‡, è´Ÿè´£æŠŠæ¶ˆæ¯åˆ†å‘ç»™å„å®¢æˆ·ç«¯, äº‹ä»¶ç”¨channelæ¥ä¼ é€’,  å‡å°‘é˜»å¡</p><p>å•ä¸ªé“¾æ¥ä¼šåœ¨ <code>aliveList</code> ä¸­æ³¨å†Œ, ConnList å°±æ˜¯æ‰€æœ‰æ´»è·ƒçš„é“¾æ¥</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AliveList å½“å‰åœ¨çº¿åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">type</span> AliveList <span class="keyword">struct</span> &#123;</span><br><span class="line">ConnList  <span class="keyword">map</span>[<span class="keyword">string</span>]*Client</span><br><span class="line">register  <span class="keyword">chan</span> *Client</span><br><span class="line">destroy   <span class="keyword">chan</span> *Client</span><br><span class="line">broadcast <span class="keyword">chan</span> Message</span><br><span class="line">cancel    <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">Len       <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Client socketå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">type</span> Client <span class="keyword">struct</span> &#123;</span><br><span class="line">ID     <span class="keyword">string</span></span><br><span class="line">conn   *websocket.Conn</span><br><span class="line">cancel <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡å¯åŠ¨åä¼šæ‰§è¡Œäº‹ä»¶ç›‘å¬å¾ªç¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨ç›‘å¬</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(al *AliveList)</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">log.Println(<span class="string">"å¼€å§‹ç›‘å¬æ³¨å†Œäº‹ä»¶"</span>)</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> client := &lt;-al.register:</span><br><span class="line">log.Println(<span class="string">"æ³¨å†Œäº‹ä»¶:"</span>, client.ID)</span><br><span class="line">al.ConnList[client.ID] = client</span><br><span class="line">al.Len++</span><br><span class="line">al.SysBroadcast(ConnectedMessage, Message&#123;</span><br><span class="line">ID:      client.ID,</span><br><span class="line">Content: <span class="string">"connected"</span>,</span><br><span class="line">SentAt:  time.Now().Unix(),</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> client := &lt;-al.destroy:</span><br><span class="line">log.Println(<span class="string">"é”€æ¯äº‹ä»¶:"</span>, client.ID)</span><br><span class="line">err := client.conn.Close()</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Printf(<span class="string">"destroy Error: %v \n"</span>, err)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">delete</span>(al.ConnList, client.ID)</span><br><span class="line">al.Len--</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> message := &lt;-al.broadcast:</span><br><span class="line">log.Printf(<span class="string">"å¹¿æ’­äº‹ä»¶: %s %s %d \n"</span>, message.ID, message.Content, message.Type)</span><br><span class="line"><span class="keyword">for</span> id := <span class="keyword">range</span> al.ConnList &#123;</span><br><span class="line"><span class="keyword">if</span> id != message.ID &#123;</span><br><span class="line"></span><br><span class="line">err := al.sendMessage(id, message)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Println(<span class="string">"broadcastError: "</span>, err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> sign := &lt;-al.cancel:</span><br><span class="line">log.Println(<span class="string">"ç»ˆæ­¢äº‹ä»¶: "</span>, sign)</span><br><span class="line">os.Exit(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ¶ˆæ¯çš„ç±»å‹æ¯”è¾ƒå¤š, å•çº¯å­—ç¬¦ä¸²æ— æ³•æ»¡è¶³éœ€æ±‚, å°±é€‰ç”¨äº†æ¯”è¾ƒå¸¸ç”¨çš„jsonæ ¼å¼å»ä¼ é€’, æ¶ˆæ¯ç›®å‰åˆ†:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line"><span class="comment">// SystemMessage ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">SystemMessage = <span class="literal">iota</span></span><br><span class="line"><span class="comment">// BroadcastMessage å¹¿æ’­æ¶ˆæ¯(æ­£å¸¸çš„æ¶ˆæ¯)</span></span><br><span class="line">BroadcastMessage</span><br><span class="line"><span class="comment">// HeartBeatMessage å¿ƒè·³æ¶ˆæ¯</span></span><br><span class="line">HeartBeatMessage</span><br><span class="line"><span class="comment">// ConnectedMessage ä¸Šçº¿é€šçŸ¥</span></span><br><span class="line">ConnectedMessage</span><br><span class="line"><span class="comment">// DisconnectedMessage ä¸‹çº¿é€šçŸ¥</span></span><br><span class="line">DisconnectedMessage</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Message æ¶ˆæ¯ä½“ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">ID      <span class="keyword">string</span></span><br><span class="line">Content <span class="keyword">string</span></span><br><span class="line">SentAt  <span class="keyword">int64</span></span><br><span class="line">Type    <span class="keyword">int</span>     <span class="comment">// &lt;- SystemMessage ç­‰ç±»å‹å°±æ˜¯è¿™é‡Œäº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰ç©ºé—²æ—¶é—´å°±å†ææå¤šèŠå¤©å®¤çš„å®ç°, ä»¥åŠä¼˜åŒ–ä¸€ä¸‹ç›®å‰çš„äº‹ä»¶å¾ªç¯é€»è¾‘<br><del>å¦‚æœè¿˜æœ‰æ›´å¤šçš„ä½™åŠ›, å°±æä¸€ä¸ªå¥½çœ‹ç‚¹çš„å®¢æˆ·ç«¯?</del></p><p><a href="https://github.com/gaopengfei123123/chat" target="_blank" rel="noopener">demoåœ°å€</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;è¿™ä¸ªdemoå®ç°äº†:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¶ˆæ¯å¹¿æ’­&lt;/li&gt;
&lt;li&gt;å¿ƒè·³æ£€æµ‹&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æä¾›äº†ä¸€ä¸ªé€šè¿‡å‘½ä»¤è¡Œæ¥è¿›è¡ŒèŠå¤©çš„ä¾‹å­&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
      <category term="websocket" scheme="http://blog.justwe.site/tags/websocket/"/>
    
  </entry>
  
  <entry>
    <title>è½¬ Yii2 æ–­çº¿é‡è¿é—®é¢˜</title>
    <link href="http://blog.justwe.site/2018/12/19/yii-mysql/"/>
    <id>http://blog.justwe.site/2018/12/19/yii-mysql/</id>
    <published>2018-12-19T03:31:00.000Z</published>
    <updated>2018-12-19T03:40:02.627Z</updated>
    
    <content type="html"><![CDATA[<p>yii2 + swoole çš„æ¨¡å¼ä¸‹å› ä¸ºä½¿ç”¨swooleåšçš„å¸¸é©»å†…å­˜æœåŠ¡, é‚£ä¹ˆä¹‹å‰çš„è®¾è®¡æ€è·¯ä¼šæœ‰ä¸€ç‚¹åå·®, ä¸æ˜¯ç¬¬ä¸€çœ¼èƒ½çœ‹åˆ°çš„å°±æ˜¯ <code>mysql has gone away</code>çš„é—®é¢˜</p><p>ç›®å‰è§£å†³æ€è·¯å°±æ˜¯å½“sqlå‘½ä»¤æŠ¥é”™<code>mysql has gone away</code>çš„æ—¶å€™å°±æ–­å¼€é‡è¿å†é‡æ–°æ‰§è¡Œä¸€æ¬¡</p><a id="more"></a><p>å‚è€ƒ <a href="https://www.yiichina.com/topic/7296" target="_blank" rel="noopener">Yii2å®ç°mysqlæ–­çº¿é‡è¿</a></p><p>é‡å†™ä¸€ä¸ªcommandç±»</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">common</span>\<span class="title">components</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">use</span> <span class="title">Yii</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–°å¢åŠ æ‰§è¡Œsqlæ—¶æ–­å¼€é‡è¿</span></span><br><span class="line"><span class="comment">     * æ•°æ®åº“è¿æ¥æ–­å¼€å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * errorInfo = [''HY000',2006,'é”™è¯¯ä¿¡æ¯']</span></span><br><span class="line"><span class="comment">     * Class Command</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@package</span> common\components</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Command</span> <span class="keyword">extends</span> \<span class="title">yii</span>\<span class="title">db</span>\<span class="title">Command</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> EVENT_DISCONNECT = <span class="string">'disconnect'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¤„ç†ä¿®æ”¹ç±»å‹sqlçš„æ–­çº¿é‡è¿é—®é¢˜</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> \Exception</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> \yii\db\Exception</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">parent</span>::execute();</span><br><span class="line">            &#125;<span class="keyword">catch</span>(\<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;handleException($e))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">parent</span>::execute();</span><br><span class="line">                <span class="keyword">throw</span> $e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¤„ç†æŸ¥è¯¢ç±»sqlæ–­çº¿é‡è¿é—®é¢˜</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> string $method</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> null $fetchMode</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> \Exception</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@throws</span> \yii\db\Exception</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">queryInternal</span><span class="params">($method, $fetchMode = null)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">parent</span>::queryInternal($method, $fetchMode);</span><br><span class="line">            &#125;<span class="keyword">catch</span>(\<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;handleException($e))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">parent</span>::queryInternal($method, $fetchMode);</span><br><span class="line">                <span class="keyword">throw</span> $e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * å¤„ç†æ‰§è¡Œsqlæ—¶æ•è·çš„å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * å¹¶ä¸”æ ¹æ®å¼‚å¸¸ä¿¡æ¯æ¥å†³å®šæ˜¯å¦éœ€è¦é‡æ–°è¿æ¥æ•°æ®åº“</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@param</span> \Exception $e</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> bool true: éœ€è¦é‡æ–°æ‰§è¡Œsql false: ä¸éœ€è¦é‡æ–°æ‰§è¡Œsql</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">handleException</span><span class="params">(\Exception $e)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//å¦‚æœä¸æ˜¯yii\db\Exceptionå¼‚å¸¸æŠ›å‡ºè¯¥å¼‚å¸¸æˆ–è€…ä¸æ˜¯MySQL server has gone away</span></span><br><span class="line">            $offset = stripos($e-&gt;getMessage(),<span class="string">'MySQL server has gone away'</span>);</span><br><span class="line">            <span class="keyword">if</span>(($e <span class="keyword">instanceof</span> \yii\db\<span class="keyword">Exception</span>) == <span class="keyword">false</span> <span class="keyword">OR</span> $offset === <span class="keyword">false</span>)</span><br><span class="line">                <span class="comment">//OR $e-&gt;errorInfo[0] != 'HY000' OR $e-&gt;errorInfo[1] != 2006)</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;trigger(<span class="keyword">static</span>::EVENT_DISCONNECT);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å°†pdoè®¾ç½®ä»null</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;pdoStatement = <span class="keyword">NULL</span>;</span><br><span class="line">            <span class="comment">//$this-&gt;db-&gt;resetPdo();</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å…³äºdbçš„é…ç½®ç»™åŠ ä¸ŠæŒ‡å®šçš„class<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="string">'components'</span> =&gt; [</span><br><span class="line">            <span class="string">'db'</span> =&gt; [</span><br><span class="line">                <span class="string">'class'</span>   =&gt; <span class="string">'yii\db\Connection'</span>,</span><br><span class="line">                <span class="string">'commandClass'</span> =&gt; <span class="string">'common\components\Command'</span>,<span class="comment">// åŠ ä¸Šè¿™ä¸ª</span></span><br><span class="line">                <span class="string">'username'</span> =&gt; <span class="string">'XXX'</span>,</span><br><span class="line">                <span class="string">'password'</span> =&gt; <span class="string">'XXX'</span>,</span><br><span class="line">                <span class="string">'dsn'</span> =&gt; <span class="string">'mysql:host=XXX;dbname=XXX;port=3306'</span>,</span><br><span class="line">            ],</span><br><span class="line">        ],</span><br><span class="line">    ];</span><br></pre></td></tr></table></figure></p><p>ç›¸å…³æ–‡ç« :<br><a href="https://www.yiichina.com/topic/7296" target="_blank" rel="noopener">Yii2å®ç°mysqlæ–­çº¿é‡è¿</a><br><a href="https://blog.csdn.net/cenfei78325747/article/details/7854611" target="_blank" rel="noopener">åœ¨mysqlä¸­connectionè®¾ç½®å’Œwait-timeoutçš„è®¾ç½®</a><br><a href="https://blog.csdn.net/csCrazybing/article/details/53303807" target="_blank" rel="noopener">æŸ¥çœ‹mysqlè¿æ¥æƒ…å†µï¼Œä»¥åŠè¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®</a><br><a href="https://blog.csdn.net/cor_twi/article/details/53098740" target="_blank" rel="noopener">æºç å‰–æYiié”™è¯¯ Invalid parameter number: no parameters were bound</a><br><a href="https://blog.csdn.net/cor_twi/article/details/52884730" target="_blank" rel="noopener">Yii æ•°æ®åº“é‡è¿å‘Šåˆ«General error: 2006 MySQL server has gone away</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;yii2 + swoole çš„æ¨¡å¼ä¸‹å› ä¸ºä½¿ç”¨swooleåšçš„å¸¸é©»å†…å­˜æœåŠ¡, é‚£ä¹ˆä¹‹å‰çš„è®¾è®¡æ€è·¯ä¼šæœ‰ä¸€ç‚¹åå·®, ä¸æ˜¯ç¬¬ä¸€çœ¼èƒ½çœ‹åˆ°çš„å°±æ˜¯ &lt;code&gt;mysql has gone away&lt;/code&gt;çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;ç›®å‰è§£å†³æ€è·¯å°±æ˜¯å½“sqlå‘½ä»¤æŠ¥é”™&lt;code&gt;mysql has gone away&lt;/code&gt;çš„æ—¶å€™å°±æ–­å¼€é‡è¿å†é‡æ–°æ‰§è¡Œä¸€æ¬¡&lt;/p&gt;
    
    </summary>
    
      <category term="yii2" scheme="http://blog.justwe.site/categories/yii2/"/>
    
    
      <category term="yii2" scheme="http://blog.justwe.site/tags/yii2/"/>
    
  </entry>
  
  <entry>
    <title>Go Mysqlæ•°æ®åº“è¿æ¥æ± çš„ä½¿ç”¨</title>
    <link href="http://blog.justwe.site/2018/12/17/go-mysql-pool/"/>
    <id>http://blog.justwe.site/2018/12/17/go-mysql-pool/</id>
    <published>2018-12-17T06:48:26.000Z</published>
    <updated>2018-12-17T07:28:32.770Z</updated>
    
    <content type="html"><![CDATA[<p>å»ºç«‹ä¸€ä¸ªmysqlè¿æ¥æ± å°†æå¤§çš„ç¼©çŸ­åº”ç”¨çš„å“åº”æ—¶é—´, å‡å°‘é¢‘ç¹çš„ioå¼€é”€ä»¥åŠgc, è¿™åœ¨golangé‡Œé¢ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å°±å®ç°çš„</p><a id="more"></a><p>ç¤ºä¾‹ä»£ç :</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"database/sql"</span></span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line">_ <span class="string">"github.com/GO-SQL-Driver/MySQL"</span></span><br><span class="line"><span class="string">"net/http"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> db *sql.DB</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">db, _ = sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123123@tcp(localhost:33060)/go?charset=utf8"</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">db.SetMaxOpenConns(<span class="number">300</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line">db.SetMaxIdleConns(<span class="number">100</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æ¯ä¸ªé“¾æ¥çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">db.SetConnMaxLifetime(time.Second * <span class="number">5</span>)</span><br><span class="line">err := db.Ping()</span><br><span class="line">checkErr(err)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">startServer(<span class="string">":9999"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startServer</span><span class="params">(port <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">http.HandleFunc(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">record := doSomething()</span><br><span class="line">fmt.Fprintln(w, record)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">"listening http://localhost%s\n"</span>, port)</span><br><span class="line">err := http.ListenAndServe(port, <span class="literal">nil</span>)</span><br><span class="line">checkErr(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doSomething</span><span class="params">()</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">string</span></span> &#123;</span><br><span class="line">rows, err := db.Query(<span class="string">"SELECT * FROM test LIMIT 1"</span>)</span><br><span class="line">checkErr(err)</span><br><span class="line"><span class="keyword">defer</span> rows.Close()</span><br><span class="line"></span><br><span class="line">columns, _ := rows.Columns()</span><br><span class="line">scanArgs := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(columns))</span><br><span class="line">values := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(columns))</span><br><span class="line"><span class="keyword">for</span> j := <span class="keyword">range</span> values &#123;</span><br><span class="line">scanArgs[j] = &amp;values[j]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">record := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line"><span class="comment">//å°†è¡Œæ•°æ®ä¿å­˜åˆ°recordå­—å…¸</span></span><br><span class="line">err = rows.Scan(scanArgs...)</span><br><span class="line"><span class="keyword">for</span> i, col := <span class="keyword">range</span> values &#123;</span><br><span class="line"><span class="keyword">if</span> col != <span class="literal">nil</span> &#123;</span><br><span class="line">record[columns[i]] = <span class="keyword">string</span>(col.([]<span class="keyword">byte</span>))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fmt.Println(record)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> record</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">doSomething2</span><span class="params">()</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">string</span></span> &#123;</span><br><span class="line">dbConn, _ := sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123123@tcp(localhost:33060)/go?charset=utf8"</span>)</span><br><span class="line"><span class="keyword">defer</span> dbConn.Close()</span><br><span class="line"></span><br><span class="line">rows, err := dbConn.Query(<span class="string">"SELECT * FROM test LIMIT 1"</span>)</span><br><span class="line">checkErr(err)</span><br><span class="line"><span class="keyword">defer</span> rows.Close()</span><br><span class="line"></span><br><span class="line">columns, _ := rows.Columns()</span><br><span class="line">scanArgs := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(columns))</span><br><span class="line">values := <span class="built_in">make</span>([]<span class="keyword">interface</span>&#123;&#125;, <span class="built_in">len</span>(columns))</span><br><span class="line"><span class="keyword">for</span> j := <span class="keyword">range</span> values &#123;</span><br><span class="line">scanArgs[j] = &amp;values[j]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">record := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line"><span class="comment">//å°†è¡Œæ•°æ®ä¿å­˜åˆ°recordå­—å…¸</span></span><br><span class="line">err = rows.Scan(scanArgs...)</span><br><span class="line"><span class="keyword">for</span> i, col := <span class="keyword">range</span> values &#123;</span><br><span class="line"><span class="keyword">if</span> col != <span class="literal">nil</span> &#123;</span><br><span class="line">record[columns[i]] = <span class="keyword">string</span>(col.([]<span class="keyword">byte</span>))</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fmt.Println(record)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> record</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkErr</span><span class="params">(err error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç :</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main_test.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestDoSomething</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">record := doSomething()</span><br><span class="line"></span><br><span class="line">t.Log(record)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDoSomething</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">doSomething()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDoSomethingParallel</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">b.RunParallel(<span class="function"><span class="keyword">func</span><span class="params">(pb *testing.PB)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> pb.Next() &#123;</span><br><span class="line">doSomething()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDoSomethingWithoutPoll</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">doSomething2()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkDoSomethingWithoutPollParallel</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">b.RunParallel(<span class="function"><span class="keyword">func</span><span class="params">(pb *testing.PB)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> pb.Next() &#123;</span><br><span class="line">doSomething2()</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•è¾“å‡ºå¯¹æ¯”:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> --bench=.</span><br><span class="line"></span><br><span class="line">goos: darwin</span><br><span class="line">goarch: amd64</span><br><span class="line">BenchmarkDoSomething-4                             20000             67898 ns/op</span><br><span class="line">BenchmarkDoSomethingParallel-4                     50000             29347 ns/op</span><br><span class="line">BenchmarkDoSomethingWithoutPoll-4                   1000           8400516 ns/op</span><br><span class="line">BenchmarkDoSomethingWithoutPollParallel-4           2000           8167164 ns/op</span><br><span class="line">PASS</span><br><span class="line">ok      _/Users/gpf/Documents/go/code/mysql_curd/pool   28.857s</span><br></pre></td></tr></table></figure></p><p>å…³é”®å°±æ˜¯è¿™å‡ ä¸ªæ–¹æ³•:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db, _ = sql.Open(<span class="string">"mysql"</span>, <span class="string">"root:123123@tcp(localhost:33060)/go?charset=utf8"</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">db.SetMaxOpenConns(<span class="number">300</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æœ€å¤§ç©ºé—²è¿æ¥æ•°</span></span><br><span class="line">db.SetMaxIdleConns(<span class="number">100</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®æ¯ä¸ªé“¾æ¥çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">db.SetConnMaxLifetime(time.Second * <span class="number">5</span>)</span><br></pre></td></tr></table></figure></p><p>è®¾ç½®è¶…æ—¶æ—¶é—´å¾ˆæœ‰å¿…è¦, é¿å…å‡ºç°serverç«¯ä¸»åŠ¨å…³é—­çš„æƒ…å†µ <code>mysql has gone away...</code></p><p><a href="http://www.01happy.com/golang-go-sql-drive-mysql-connection-pooling/" target="_blank" rel="noopener">ä»£ç æ¥æº</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å»ºç«‹ä¸€ä¸ªmysqlè¿æ¥æ± å°†æå¤§çš„ç¼©çŸ­åº”ç”¨çš„å“åº”æ—¶é—´, å‡å°‘é¢‘ç¹çš„ioå¼€é”€ä»¥åŠgc, è¿™åœ¨golangé‡Œé¢ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å°±å®ç°çš„&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
      <category term="mysql" scheme="http://blog.justwe.site/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Goé‡Œçš„ç‚¹ç‚¹ç‚¹è¯­æ³•</title>
    <link href="http://blog.justwe.site/2018/12/14/go-dotdotdot/"/>
    <id>http://blog.justwe.site/2018/12/14/go-dotdotdot/</id>
    <published>2018-12-14T02:37:32.000Z</published>
    <updated>2018-12-14T02:49:03.449Z</updated>
    
    <content type="html"><![CDATA[<p>golang ä»£ç é‡Œé¢æœ‰æ—¶ä¼šå‡ºç° <code>...</code> è¿™ä¸ªæ“ä½œ, åˆæ¬¡çœ‹åˆ°ä¹Ÿæ˜¯æ‘¸ä¸åˆ°å¤´è„‘,<br>å…¶å®ä»–æ˜¯ç”¨æ¥åšæ•°ç»„çš„ææ„ç”¨çš„</p><a id="more"></a><p>ä¸¾ä¸ªä¾‹å­å°±æ˜ç™½äº†:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">pm := []<span class="keyword">string</span>&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>&#125;</span><br><span class="line">test(<span class="string">"abc"</span>, pm...) <span class="comment">// ç›¸å½“äº test("abc", "a", "b", "c")</span></span><br><span class="line"></span><br><span class="line">ap := []<span class="keyword">string</span>&#123;<span class="string">"f"</span>, <span class="string">"g"</span>&#125;</span><br><span class="line">rs := <span class="built_in">append</span>(pm, ap...)  <span class="comment">// ç›¸å½“äº append(pm, ap[0], ap[1], ä»¥æ­¤ç±»æ¨)</span></span><br><span class="line">fmt.Println(<span class="string">"rs:"</span>, rs)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(name <span class="keyword">string</span>, pms ...<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">"output name:"</span>, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> pms &#123;</span><br><span class="line">fmt.Printf(<span class="string">"k: %v, v: %v \n"</span>, k, v)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output name: abc</span><br><span class="line">k: 0, v: a</span><br><span class="line">k: 1, v: b</span><br><span class="line">k: 2, v: c</span><br><span class="line">rs: [a b c f g]</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåšäº†ä¸¤ä¸ªç¤ºä¾‹: </p><ol><li><p>åœ¨funcä¸­çš„ <code>...</code> eg: <code>func test(name string, pms ...string)</code><br>ä»£è¡¨ç€ä¸é™å‚æ•°æ•°é‡, è€Œå¤šå‡ºçš„å‚æ•°éƒ½æ”¾åœ¨äº† <code>var pms []string</code> è¿™ä¸ªæ•°ç»„å½“ä¸­, åœ¨goä¸­å…¸å‹çš„ä½¿ç”¨ä¾‹å­å°±æ˜¯ <code>fmt.Print</code> è¿™ä¸€ç³»åˆ—çš„æ–¹æ³•</p></li><li><p>åœ¨ä¼ å‚çš„æ—¶å€™ä½¿ç”¨<code>...</code> æ˜¯ç”¨æ¥è¡¨ç¤ºå°†æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ å•ç‹¬ä¼ å…¥å‡½æ•°ä¸­<br>è¾ƒé•¿ç”¨çš„å°±æ˜¯å‡ºç°æ•°ç»„åˆå¹¶çš„æ—¶å€™, ä½¿ç”¨<code>append()</code> æ–¹æ³•æ—¶:<br>è¿™æ ·å†™æ­£ç¡®</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ap := []<span class="keyword">string</span>&#123;<span class="string">"f"</span>, <span class="string">"g"</span>&#125;</span><br><span class="line">   rs := <span class="built_in">append</span>(pm, ap...)  <span class="comment">// ç›¸å½“äº append(pm, ap[0], ap[1], ä»¥æ­¤ç±»æ¨)</span></span><br></pre></td></tr></table></figure></li></ol><p>è¿™æ ·å†™å°±æŠ¥é”™<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ap := []<span class="keyword">string</span>&#123;<span class="string">"f"</span>, <span class="string">"g"</span>&#125;</span><br><span class="line">rs := <span class="built_in">append</span>(pm, ap)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;golang ä»£ç é‡Œé¢æœ‰æ—¶ä¼šå‡ºç° &lt;code&gt;...&lt;/code&gt; è¿™ä¸ªæ“ä½œ, åˆæ¬¡çœ‹åˆ°ä¹Ÿæ˜¯æ‘¸ä¸åˆ°å¤´è„‘,&lt;br&gt;å…¶å®ä»–æ˜¯ç”¨æ¥åšæ•°ç»„çš„ææ„ç”¨çš„&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>Crontab è®¾ç½®ä¸€å°æ—¶æ‰§è¡Œä¸€æ¬¡</title>
    <link href="http://blog.justwe.site/2018/12/11/linux-crontab/"/>
    <id>http://blog.justwe.site/2018/12/11/linux-crontab/</id>
    <published>2018-12-11T02:55:47.000Z</published>
    <updated>2018-12-11T03:21:59.706Z</updated>
    
    <content type="html"><![CDATA[<p>å¦‚æœä¸»ç®¡ç»™ä½ ä¸ªä»»åŠ¡, è®©ä½ æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡è„šæœ¬, æ˜¯ä¸æ˜¯å°±æ˜¯è¿™æ ·:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* */1 * * * xxxxx.bash</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·å°±é”™äº†å‘¦~</p><a id="more"></a><p>ä»¥ä¸Šäº§ç”Ÿçš„ç»“æœæ˜¯æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡, å› ä¸ºä»åŒ¹é…è§’åº¦æ¥çœ‹æ¯åˆ†é’Ÿéƒ½ç¬¦åˆè§„åˆ™, ç»§è€Œæ‰§è¡Œå‘½ä»¤</p><p>å› æ­¤å¯¹äºæ•´ç‚¹å®šæ—¶ä»»åŠ¡æœ‰ä¸¤ç§å†™æ³•:</p><p>æ¯<strong>æ•´ç‚¹</strong>æ‰§è¡Œä¸€æ¬¡:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 */1 * * * xxxxx.bash</span><br></pre></td></tr></table></figure></p><p>æ¯<strong>éš”60åˆ†é’Ÿ</strong>æ‰§è¡Œä¸€æ¬¡:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/60 * * * * xxxxx.bash</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„æˆ‘çš„æè¿°å•Š, æ•´ç‚¹å’Œéš”60åˆ†é’Ÿå…¶å®æ˜¯ä¸¤ä¸ªä¸œè¥¿, æ ¹æ®å…·ä½“ä¸šåŠ¡è¦æ±‚å»ä½¿ç”¨å®ƒ</p><p><img src="/images/crontab.png" alt=""></p><p>å…³äºå®šæ—¶å™¨è¿™é‡Œæœ‰ä¸‰ä¸ªç¤ºä¾‹:</p><ol><li><p>åœ¨ä¸Šåˆ8ç‚¹åˆ°11ç‚¹çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 8-11 * * * <span class="built_in">command</span></span><br></pre></td></tr></table></figure></li><li><p>æ¯éš”ä¸¤å¤©çš„ä¸Šåˆ8ç‚¹åˆ°11ç‚¹çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 8-11 */2 * * <span class="built_in">command</span></span><br></pre></td></tr></table></figure></li><li><p>æ¯ä¸ªæ˜ŸæœŸä¸€çš„ä¸Šåˆ8ç‚¹åˆ°11ç‚¹çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3,15 8-11 * * 1 <span class="built_in">command</span></span><br></pre></td></tr></table></figure></li></ol><p>è¯¦ç»†çš„crontabæ“ä½œå¯ä»¥å‚è€ƒè¿™ç¯‡åšå®¢:<br><a href="https://blog.csdn.net/u014726937/article/details/51182666" target="_blank" rel="noopener">crontabâ€“å®šæ—¶å™¨å‘½ä»¤</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;å¦‚æœä¸»ç®¡ç»™ä½ ä¸ªä»»åŠ¡, è®©ä½ æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡è„šæœ¬, æ˜¯ä¸æ˜¯å°±æ˜¯è¿™æ ·:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;* */1 * * * xxxxx.bash&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ ·å°±é”™äº†å‘¦~&lt;/p&gt;
    
    </summary>
    
      <category term="tools" scheme="http://blog.justwe.site/categories/tools/"/>
    
    
      <category term="linux" scheme="http://blog.justwe.site/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>é€šè¿‡Channelæ§åˆ¶å¹¶å‘æ•°é‡</title>
    <link href="http://blog.justwe.site/2018/12/04/go-channel-waitgroup/"/>
    <id>http://blog.justwe.site/2018/12/04/go-channel-waitgroup/</id>
    <published>2018-12-04T06:14:30.000Z</published>
    <updated>2018-12-04T06:26:24.991Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨ <code>go</code> å…³é”®å­—æœ‰æ—¶å€™éœ€è¦æ§åˆ¶ä¸€ä¸‹å¹¶å‘çš„æ•°é‡, ä½†ä¸è‡³äºå»ä¿®æ”¹ <code>runtime.GOMAXPROCS</code> è¿™ä¸ªæ•°å€¼, è¿™é‡Œå°±ç”¨åˆ°äº†ç¼“å†²<code>channel</code>çš„ç‰¹æ€§</p><a id="more"></a><p>demo:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"sync"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// WaitGroup ä¸€ä¸ªå¼‚æ­¥ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> WaitGroup <span class="keyword">struct</span> &#123;</span><br><span class="line">workChan <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line">wg       sync.WaitGroup</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewPool ç”Ÿæˆä¸€ä¸ªå·¥ä½œæ± , coreNum é™åˆ¶</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPool</span><span class="params">(coreNum <span class="keyword">int</span>)</span> *<span class="title">WaitGroup</span></span> &#123;</span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, coreNum)</span><br><span class="line"><span class="keyword">return</span> &amp;WaitGroup&#123;</span><br><span class="line">workChan: ch,</span><br><span class="line">wg:       sync.WaitGroup&#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add æ·»åŠ </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ap *WaitGroup)</span> <span class="title">Add</span><span class="params">(num <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; num; i++ &#123;</span><br><span class="line">ap.workChan &lt;- i</span><br><span class="line">ap.wg.Add(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Done å®Œç»“</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ap *WaitGroup)</span> <span class="title">Done</span><span class="params">()</span></span> &#123;</span><br><span class="line">LOOP:</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> &lt;-ap.workChan:</span><br><span class="line"><span class="keyword">break</span> LOOP</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">ap.wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Wait ç­‰å¾…</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(ap *WaitGroup)</span> <span class="title">Wait</span><span class="params">()</span></span> &#123;</span><br><span class="line">ap.wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>test:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> pool</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">"fmt"</span></span><br><span class="line"><span class="string">"testing"</span></span><br><span class="line"><span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRun</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">work := NewPool(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">50</span>; i++ &#123;</span><br><span class="line">work.Add(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">go</span> testFunc(i, work)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">"waiting..."</span>)</span><br><span class="line">work.Wait()</span><br><span class="line">t.Log(<span class="string">"done"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFunc</span><span class="params">(i <span class="keyword">int</span>, wg *WaitGroup)</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wg.Done()</span><br><span class="line">fmt.Println(time.Now().Format(<span class="string">"2006-01-02T15:04:05Z07:00"</span>), <span class="string">"output: "</span>, i)</span><br><span class="line">time.Sleep(time.Second * <span class="number">1</span>)</span><br><span class="line">fmt.Println(time.Now().Format(<span class="string">"2006-01-02T15:04:05Z07:00"</span>), <span class="string">"output: "</span>, i, <span class="string">"done"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">2018-12-04T14:22:27+08:00 output:  3</span><br><span class="line">2018-12-04T14:22:27+08:00 output:  1</span><br><span class="line">2018-12-04T14:22:27+08:00 output:  0</span><br><span class="line">2018-12-04T14:22:27+08:00 output:  2</span><br><span class="line">2018-12-04T14:22:28+08:00 output:  3 <span class="keyword">done</span></span><br><span class="line">2018-12-04T14:22:28+08:00 output:  0 <span class="keyword">done</span></span><br><span class="line">2018-12-04T14:22:28+08:00 output:  1 <span class="keyword">done</span></span><br><span class="line">2018-12-04T14:22:28+08:00 output:  5</span><br><span class="line">2018-12-04T14:22:28+08:00 output:  6</span><br><span class="line">2018-12-04T14:22:28+08:00 output:  2 <span class="keyword">done</span></span><br><span class="line">2018-12-04T14:22:28+08:00 output:  7</span><br><span class="line">2018-12-04T14:22:28+08:00 output:  4</span><br><span class="line">2018-12-04T14:22:29+08:00 output:  4 <span class="keyword">done</span></span><br><span class="line">2018-12-04T14:22:29+08:00 output:  8</span><br><span class="line">2018-12-04T14:22:29+08:00 output:  7 <span class="keyword">done</span></span><br><span class="line">2018-12-04T14:22:29+08:00 output:  6 <span class="keyword">done</span></span><br><span class="line">.....</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯è¦å¸¦ä¸Š <code>sync.WaitGroup</code>, ä¿è¯æœ€åä¸€æ¬¡å¾ªç¯æ—¶æºç¨‹ä¸ä¼šè¿‡æ—©é€€å‡º</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä½¿ç”¨ &lt;code&gt;go&lt;/code&gt; å…³é”®å­—æœ‰æ—¶å€™éœ€è¦æ§åˆ¶ä¸€ä¸‹å¹¶å‘çš„æ•°é‡, ä½†ä¸è‡³äºå»ä¿®æ”¹ &lt;code&gt;runtime.GOMAXPROCS&lt;/code&gt; è¿™ä¸ªæ•°å€¼, è¿™é‡Œå°±ç”¨åˆ°äº†ç¼“å†²&lt;code&gt;channel&lt;/code&gt;çš„ç‰¹æ€§&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
  </entry>
  
  <entry>
    <title>Nginxè½¬å‘åˆ°goæœåŠ¡å½“ä¸­</title>
    <link href="http://blog.justwe.site/2018/11/25/go-nginx-docker/"/>
    <id>http://blog.justwe.site/2018/11/25/go-nginx-docker/</id>
    <published>2018-11-25T07:39:36.000Z</published>
    <updated>2018-11-25T07:52:38.746Z</updated>
    
    <content type="html"><![CDATA[<p>é€šè¿‡docker-composeç¼–æ’çš„å®¹å™¨æ€»æ˜¯æœ‰ä¸€äº›å¥‡æ€ªçš„é—®é¢˜</p><a id="more"></a><p>é—®é¢˜æ ¸å¿ƒå°±æ˜¯go-serverå’Œnginxæ‰€å±ä¸åŒçš„å®¹å™¨, éœ€è¦å¤–ç•Œèƒ½è®¿é—®åˆ°goçš„æœåŠ¡å°±éœ€è¦è¿›è¡Œè½¬å‘äº†</p><p>å¦‚æœæ˜¯åœ¨åŒä¸€ä¸ªå®¹å™¨ä¸­åªéœ€è¦:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  .a.com;</span><br><span class="line"></span><br><span class="line">    charset utf-8;</span><br><span class="line">    access_log  /home/a.com.access.log;</span><br><span class="line"></span><br><span class="line">    location /(css|js|fonts|img)/ &#123;</span><br><span class="line">        access_log off;</span><br><span class="line">        expires 1d;</span><br><span class="line"></span><br><span class="line">        root &quot;/path/to/app_a/static&quot;;</span><br><span class="line">        try_files $uri @backend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files /_not_exists_ @backend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location @backend &#123;</span><br><span class="line">        proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">        proxy_set_header Host            $http_host;</span><br><span class="line"></span><br><span class="line">        proxy_pass http://127.0.0.1:8080;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://beego.me/docs/deploy/nginx.md" target="_blank" rel="noopener">beego-nginxéƒ¨ç½²</a></p><p>é‚£ä¹ˆå¦‚æœæ˜¯ä¸¤ä¸ªå®¹å™¨å½“ä¸­å‘¢? åŸºäºä¸Šé¢çš„ä¾‹å­, æˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>upstream</code>, </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">upstream go_server_proxy &#123;</span><br><span class="line">    # è¿™é‡Œçš„server éœ€è¦ç”¨åˆ° å®¹å™¨å:ç«¯å£ çš„å½¢å¼</span><br><span class="line">    server go_server:9090;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root /var/www;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    charset utf-8;</span><br><span class="line">    access_log  /var/log/nginx/def.access.log;</span><br><span class="line"></span><br><span class="line">    location /(css|js|fonts|img)/ &#123;</span><br><span class="line">        access_log off;</span><br><span class="line">        expires 1d;</span><br><span class="line"></span><br><span class="line">        root &quot;/var/www/static&quot;;</span><br><span class="line">        try_files $uri @backend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files /_not_exists_ @backend;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location @backend &#123;</span><br><span class="line">        proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">        proxy_set_header Host            $http_host;</span><br><span class="line">        proxy_pass  http://go_server_proxy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšçš„åŸå› æ˜¯å®¹å™¨ä¹‹é—´çš„ipå¹¶ä¸å›ºå®š, ä½¿ç”¨å®¹å™¨ååšhoståœ°å€æ˜¯æ›´ç®€å•çš„é€‰æ‹©</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;é€šè¿‡docker-composeç¼–æ’çš„å®¹å™¨æ€»æ˜¯æœ‰ä¸€äº›å¥‡æ€ªçš„é—®é¢˜&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
      <category term="docker" scheme="http://blog.justwe.site/tags/docker/"/>
    
      <category term="nginx" scheme="http://blog.justwe.site/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>Go ç«ç„°å›¾åˆ†æ</title>
    <link href="http://blog.justwe.site/2018/11/01/go-flame-graph/"/>
    <id>http://blog.justwe.site/2018/11/01/go-flame-graph/</id>
    <published>2018-11-01T09:03:33.000Z</published>
    <updated>2018-11-25T07:38:45.761Z</updated>
    
    <content type="html"><![CDATA[<p>go version go1.11.1 darwin/amd64</p><p>å®‰è£…:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/uber/go-torch</span><br><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/uber/go-torch</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/brendangregg/FlameGraph.git</span><br></pre></td></tr></table></figure></p><p>å®‰è£…æµ‹è¯•å·¥å…·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/Masterminds/glide</span><br><span class="line">$ <span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/uber/go-torch</span><br><span class="line">$ glide install</span><br></pre></td></tr></table></figure></p><p>æ€§èƒ½åˆ†æå·¥å…·</p><a id="more"></a><p><code>glide install</code>å¦‚æœå‡ºç°  <code>Update failed for golang.org/x/sys: Cannot detect VCS</code> è¿™ç§æŠ¥é”™, å¯ä»¥æ‰§è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ glide mirror <span class="built_in">set</span> https://golang.org/x/sys https://github.com/golang/sys</span><br></pre></td></tr></table></figure></p><p>æ”¹å˜ <code>$HOME/.gilde/mirrors.yaml</code> çš„é•œåƒé“¾æ¥å³å¯</p><p>è¿è¡Œæ—¶å®Œæˆåè¾“å…¥ web<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ go tool pprof --seconds 25 http://localhost:9090/debug/pprof/profile</span><br><span class="line">Fetching profile over HTTP from http://localhost:9090/debug/pprof/profile?seconds=25</span><br><span class="line">Please <span class="built_in">wait</span>... (25s)</span><br><span class="line">Saved profile <span class="keyword">in</span> /Users/gpf/pprof/pprof.samples.cpu.002.pb.gz</span><br><span class="line">Type: cpu</span><br><span class="line">Time: Nov 2, 2018 at 11:46am (CST)</span><br><span class="line">Duration: 25s, Total samples = 2.17s ( 8.68%)</span><br><span class="line">Entering interactive mode (<span class="built_in">type</span> <span class="string">"help"</span> <span class="keyword">for</span> commands, <span class="string">"o"</span> <span class="keyword">for</span> options)</span><br><span class="line">(pprof) web</span><br><span class="line">Failed to execute dot. Is Graphviz installed? Error: <span class="built_in">exec</span>: <span class="string">"dot"</span>: executable file not found <span class="keyword">in</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p><p>å‡ºç° <code>Failed to execute dot. Is Graphviz installed? Error: exec: &quot;dot&quot;: executable file not found in $PATH</code> æŠ¥é”™, éœ€è¦å®‰è£… <code>graphviz</code>  åœ¨ mac ä¸Šå°±ç›´æ¥ <code>brew install graphviz</code> å³å¯</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;go version go1.11.1 darwin/amd64&lt;/p&gt;
&lt;p&gt;å®‰è£…:&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ go get github.com/uber/go-torch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$GOPATH&lt;/span&gt;/src/github.com/uber/go-torch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ git &lt;span class=&quot;built_in&quot;&gt;clone&lt;/span&gt; https://github.com/brendangregg/FlameGraph.git&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å®‰è£…æµ‹è¯•å·¥å…·&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ go get github.com/Masterminds/glide&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ &lt;span class=&quot;built_in&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;$GOPATH&lt;/span&gt;/src/github.com/uber/go-torch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ glide install&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;æ€§èƒ½åˆ†æå·¥å…·&lt;/p&gt;
    
    </summary>
    
      <category term="go" scheme="http://blog.justwe.site/categories/go/"/>
    
    
      <category term="go" scheme="http://blog.justwe.site/tags/go/"/>
    
      <category term="flame-graph" scheme="http://blog.justwe.site/tags/flame-graph/"/>
    
  </entry>
  
  <entry>
    <title>Git-Diff</title>
    <link href="http://blog.justwe.site/2018/10/26/git-diff/"/>
    <id>http://blog.justwe.site/2018/10/26/git-diff/</id>
    <published>2018-10-26T07:01:51.000Z</published>
    <updated>2018-10-26T07:05:19.648Z</updated>
    
    <content type="html"><![CDATA[<p>git å¯¹æ¯”æ–‡ä»¶å·®å¼‚</p><a id="more"></a><p>é€šå¸¸ <code>git diff COMMIT_ID_1 COMMIT_DI_2</code> æŸ¥çœ‹</p><p>åªæŸ¥çœ‹æ›´æ”¹è¿‡çš„æ–‡ä»¶ç›®å½•</p><p><code>git diff  --name-only COMMIT_ID_1 COMMIT_DI_2</code></p><p>å¿«æ·ç”¨æ³•å°±æ˜¯:</p><p><code>git diff  --name-only HEAD HEAD^</code></p><p>å¯¹æ¯”å’Œä¸Šæ¬¡æäº¤æ—¶çš„æ”¹åŠ¨</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;git å¯¹æ¯”æ–‡ä»¶å·®å¼‚&lt;/p&gt;
    
    </summary>
    
      <category term="git" scheme="http://blog.justwe.site/categories/git/"/>
    
    
      <category term="git" scheme="http://blog.justwe.site/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡ Git Revert çš„ç»å†</title>
    <link href="http://blog.justwe.site/2018/10/25/git-revert/"/>
    <id>http://blog.justwe.site/2018/10/25/git-revert/</id>
    <published>2018-10-25T08:27:06.000Z</published>
    <updated>2018-10-25T09:17:03.714Z</updated>
    
    <content type="html"><![CDATA[<p>åˆä½œå¼€å‘ç»å¸¸ä¼šæ<code>merge request</code>å˜›, ç„¶åå°±æäº†ä¸€ä¸ªä¸è¯¥æçš„, è¿˜æ‰‹æŠ–ç»™åˆå¹¶äº†â€¦.</p><a id="more"></a><p>è¿”ç°é—®é¢˜ä»¥åå‡†å¤‡å›é€€, ç„¶åæŠ¬çœ¼ä¸€çœ‹å„åˆ†æ”¯çš„åˆå¹¶æƒ…å†µâ€¦.<br><img src="http://blog-image.onlyoneip.com/git-merge-line.png" alt=""></p><p>å“‡è„‘å£³ç—›, è¿™å°±ç”¨ä¸äº†å¹³æ—¶æœ€å–œæ¬¢çš„ <code>reset</code> äº†, æŸ¥äº†æŸ¥èµ„æ–™, æƒ³<strong>å–æ¶ˆæŸä¸€æ¬¡ merge request</strong>ç”¨ <code>revert</code> æ˜¯æœ€åˆé€‚çš„</p><p>æ¥ä¸‹æ¥åˆ†ä¸‰æ­¥,å…ˆæ‰¾åˆ°è¦å›é€€çš„é‚£æ¬¡ mr, é€šå¸¸æ˜¯è¿™æ ·çš„:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> </span><br><span class="line"></span><br><span class="line">commit 365ea982c24f2c60150df6159734ab73b74515bc (origin/master, origin/HEAD)</span><br><span class="line">Merge: 465fbfb8 f15b39ae</span><br><span class="line">Author: xxx &lt;xxx&gt;</span><br><span class="line">Date:   Thu Oct 25 15:41:10 2018 +0800</span><br><span class="line"></span><br><span class="line">    Merge branch <span class="string">'master'</span> of xxxxxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line">commit 465fbfb8084089f9d08516b4d75ba51ae5dcd5ce</span><br><span class="line">Author: xxx &lt;xxx&gt;</span><br><span class="line">Date:   Thu Oct 25 15:41:03 2018 +0800</span><br><span class="line"></span><br><span class="line">    merge</span><br><span class="line"></span><br><span class="line">commit 1e309ff40fd02d1c9c6e604c2649d8a94086a573</span><br><span class="line">Author: xxx &lt;zhangkaixuan&gt;</span><br><span class="line">Date:   Thu Oct 25 15:40:37 2018 +0800</span><br><span class="line"></span><br><span class="line">    merge</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„, è¿™åªæ˜¯ log çš„ä¸­é—´çš„ä¸€éƒ¨åˆ†, å‡è®¾ mr ä¹‹ååç»­åˆæœ‰å¾ˆå¤š mr å·²ç»åˆå¹¶äº†, é‚£ä¹ˆå…ˆæ‰¾åˆ°æˆ‘ä»¬è¦å›é€€çš„ <code>commit id</code>, è¿™é‡Œå°±å‡è®¾ä¸€ä¸ªå« <code>c76627674dedf4fc067cb0c5b2afbc123fd9c053</code></p><ol><li><p>æ‰§è¡Œ <code>git revert -m 1 c76627674dedf4fc067cb0c5b2afbc123fd9c053</code></p><p> é€šå¸¸æ‰§è¡Œè¿™ä¸€æ­¥ä¹‹åæ²¡ä»€ä¹ˆå†²çªå°±å¯ä»¥äº†, ç„¶åæœ‰å†²çªäº†, å°±å’Œæ­£å¸¸çš„ merger conflicts å¤„ç†ä¸€æ ·</p></li><li><p>è§£å†³å®Œå†²çª, æ‰§è¡Œ <code>git revert --continue</code> è¿™å°±ç®—åˆå¹¶äº†</p><p> é‚£ä¹ˆå›æ»šåˆ°ä¸€åŠä¸æƒ³åšäº†, ä¹Ÿå¥½è¯´, æ‰§è¡Œ <code>git revert --abort</code> ä»¥å, å¤§å®¶å°±å½“æ— äº‹å‘ç”Ÿè¿‡</p></li></ol><p>å…³äº <code>git revert -m 1</code> è¿™ä¸ª<code>1</code>æŒ‡çš„æ˜¯ <code>mainline</code>, 1 ä»£è¡¨ç€ master è¿™æ¡çº¿<br><a href="https://stackoverflow.com/a/5971033/9561528" target="_blank" rel="noopener">èµ„æ–™å‚è€ƒ: Why does git revert complain about a missing -m option?</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åˆä½œå¼€å‘ç»å¸¸ä¼šæ&lt;code&gt;merge request&lt;/code&gt;å˜›, ç„¶åå°±æäº†ä¸€ä¸ªä¸è¯¥æçš„, è¿˜æ‰‹æŠ–ç»™åˆå¹¶äº†â€¦.&lt;/p&gt;
    
    </summary>
    
      <category term="git" scheme="http://blog.justwe.site/categories/git/"/>
    
    
      <category term="git" scheme="http://blog.justwe.site/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>è½¬ Vscode è®¾ç½®ç»ˆç«¯å­—ä½“</title>
    <link href="http://blog.justwe.site/2018/10/16/vscode-terminal-font-macOS/"/>
    <id>http://blog.justwe.site/2018/10/16/vscode-terminal-font-macOS/</id>
    <published>2018-10-16T07:50:28.000Z</published>
    <updated>2018-10-16T07:59:17.477Z</updated>
    
    <content type="html"><![CDATA[<p>mac ä¸Šè®¾ç½®vscodeç»ˆç«¯æ ·å¼(å°¤å…¶æ˜¯æƒ³ç”¨ powershell ä¸»é¢˜çš„)</p><a id="more"></a><h3 id="Macä¸‹é…ç½®vscodeç»ˆç«¯å­—ä½“ï¼š"><a href="#Macä¸‹é…ç½®vscodeç»ˆç«¯å­—ä½“ï¼š" class="headerlink" title="Macä¸‹é…ç½®vscodeç»ˆç«¯å­—ä½“ï¼š"></a>Macä¸‹é…ç½®vscodeç»ˆç«¯å­—ä½“ï¼š</h3><p>åœ¨Mac 10.13.6ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼ˆäº²æµ‹å¯ç”¨ï¼‰ï¼Œå…¶ä»–ç‰ˆæœ¬åšå‚è€ƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½å®‰è£…å­—ä½“</span><br><span class="line"><span class="variable">$cd</span> /Library/Fonts</span><br><span class="line"><span class="variable">$sudo</span> git <span class="built_in">clone</span> https://github.com/abertsch/Menlo-for-Powerline.git</span><br></pre></td></tr></table></figure><p>config.json ä½ç½®<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Windows %APPDATA%\Code\User\settings.json</span><br><span class="line">Mac <span class="variable">$HOME</span>/Library/Application Support/Code/User/settings.json</span><br><span class="line">Linux <span class="variable">$HOME</span>/.config/Code/User/settings.json</span><br></pre></td></tr></table></figure></p><p>åœ¨ vscode é…ç½®ä¸­è®¾ç½®å­—ä½“ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="variable">$HOME</span>/Library/Application Support/Code/User/settings.json</span><br><span class="line"><span class="comment"># æ–‡ä»¶å†…æŒ‡å®šå­—ä½“ä¸»é¢˜</span></span><br><span class="line"><span class="string">"terminal.integrated.fontFamily"</span>: <span class="string">"Menlo for Powerline"</span></span><br></pre></td></tr></table></figure></p><h3 id="åœ¨Ubuntu-18-04-1LTS-ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼ˆäº²æµ‹å¯ç”¨ï¼‰ï¼Œå…¶ä»–ç‰ˆæœ¬linuxåšå‚è€ƒã€‚"><a href="#åœ¨Ubuntu-18-04-1LTS-ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼ˆäº²æµ‹å¯ç”¨ï¼‰ï¼Œå…¶ä»–ç‰ˆæœ¬linuxåšå‚è€ƒã€‚" class="headerlink" title="åœ¨Ubuntu 18.04.1LTS ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼ˆäº²æµ‹å¯ç”¨ï¼‰ï¼Œå…¶ä»–ç‰ˆæœ¬linuxåšå‚è€ƒã€‚"></a>åœ¨Ubuntu 18.04.1LTS ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼ˆäº²æµ‹å¯ç”¨ï¼‰ï¼Œå…¶ä»–ç‰ˆæœ¬linuxåšå‚è€ƒã€‚</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹è½½å®‰è£…å­—ä½“</span><br><span class="line"><span class="variable">$cd</span> /usr/share/fonts/truetype/</span><br><span class="line"><span class="variable">$sudo</span> git <span class="built_in">clone</span> https://github.com/abertsch/Menlo-for-Powerline.git</span><br><span class="line">åˆ·æ–°å­—ä½“</span><br><span class="line"><span class="variable">$sudo</span> <span class="built_in">fc</span>-cache -f -v</span><br></pre></td></tr></table></figure><p>å›åˆ°  Vs Codeçš„ç”¨æˆ·è®¾ç½®.json  ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç <br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"terminal.integrated.fontFamily": "Menlo for Powerline",</span><br></pre></td></tr></table></figure></p><p><a href="https://blog.csdn.net/chenghai37/article/details/81417293" target="_blank" rel="noopener">æ–‡ç« æ¥æº</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mac ä¸Šè®¾ç½®vscodeç»ˆç«¯æ ·å¼(å°¤å…¶æ˜¯æƒ³ç”¨ powershell ä¸»é¢˜çš„)&lt;/p&gt;
    
    </summary>
    
      <category term="tools" scheme="http://blog.justwe.site/categories/tools/"/>
    
    
      <category term="tools" scheme="http://blog.justwe.site/tags/tools/"/>
    
  </entry>
  
</feed>
