<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Github-Webhook å°å·¥å…·]]></title>
    <url>%2F2019%2F11%2F14%2Ftool-github-webhook%2F</url>
    <content type="text"><![CDATA[æœ€è¿‘å†™äº†ä¸€ä¸ªå°å·¥å…·, ç”¨æ¥æŽ¥æ”¶github webhookæ¶ˆæ¯, ä»¥åœ¨æœåŠ¡å™¨ä¸Šè‡ªåŠ¨æ‰§è¡Œè„šæœ¬ gaopengfei123123/hook github hook serverä¸€ä¸ªç”¨æ¥æŽ¥æ”¶webhookçš„server çŽ¯å¢ƒgolang v1.11+ (å› ä¸ºç”¨åˆ°äº†go mod) å®‰è£…æ‰§è¡Œ:1go get -u github.com/gaopengfei123123/hook åˆ›å»ºæ–‡ä»¶ main.go123456789package mainimport ( "github.com/gaopengfei123123/hook")func main() &#123; hook.Execute()&#125; æ‰§è¡Œå‘½ä»¤1go build -o app main.go app è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å°±æ˜¯æœ¬ä½“äº†, æ”¾åˆ°åˆé€‚çš„åœ°æ–¹, æ‰§è¡Œ:1./app start -d åŽå°å¯åŠ¨, app åŒç›®å½•ä¸‹ä¼šåˆ›å»º scripts, logs ä¸¤ä¸ªç›®å½•, å’Œä¸€ä¸ª hook.pid ä¿å­˜pid æ£€æµ‹æ˜¯å¦å¯åŠ¨:12[root@xxx]# curl localhost:8080/ping&#123;"message":"pong v5"&#125; è¯´æ˜ŽæœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸ, æœåŠ¡åœ°å€ä¸º0.0.0.0:8080 æŽ¥å£ 0.0.0.0:8080/ping æ£€æµ‹æŽ¥å£ 0.0.0.0:8080/push æŽ¥å—github webhookè¯·æ±‚, æ ¹æ® Repository.Name åŽ»åˆ¤æ–­æ‰§è¡Œä»€ä¹ˆè„šæœ¬ å¯ç”¨æŒ‡ä»¤1234reload é‡æ–°åŠ è½½æ—¥å¿—, ä»¥åŠå¹³æ»‘é‡å¯start å¯åŠ¨å‘½ä»¤, -d åŽå°è¿è¡Œstop ç»ˆæ­¢å‘½ä»¤version ç¨‹åºç‰ˆæœ¬ ç›®å½•åŠŸèƒ½: logs å­˜æ”¾è¯·æ±‚æ—¥å¿— scripts å­˜æ”¾hookè„šæœ¬, å½“æœ‰å¯¹åº”åº“åçš„è¯·æ±‚è¿›æ¥, å°†æ‰§è¡Œé…ç½®å¥½çš„è„šæœ¬ hook.pid å­˜æ”¾è¿›ç¨‹pid é…ç½®æ–‡ä»¶123456789&#123; "github_hook": &#123; // ä»¥è¯·æ±‚æ¶ˆæ¯ä¸­çš„ repository.name å­—æ®µæ¥åškey "secret": "xxxxxx", // å¦‚æžœè®¾ç½®äº†secretåˆ™ä¼šç”¨è¿™ä¸ªè¿›è¡ŒéªŒè¯, ä¸ºç©ºåˆ™ä¸éªŒè¯ "script_path": "", // è„šæœ¬æ‰€åœ¨ç»å¯¹ç›®å½•, ä¸ºç©ºå°±æ˜¯å½“å‰çš„scriptç›®å½• "event": &#123; "push": "test" // æŽ¨é€äº‹ä»¶æ‰§è¡Œçš„è„šæœ¬ &#125; &#125;&#125; ç‰¹æ€§ ä¸€é”®åˆå§‹åŒ– å¹³æ»‘é‡å¯, ä¿¡å·é€šä¿¡ æ”¯æŒsecretéªŒè¯ å¼‚æ­¥æ‰§è¡Œè„šæœ¬ è§„é¿é‡æ”¾ è„šæœ¬ä¼ é€’å‚æ•°(TODO) äº‹ä»¶é’©å­(TODO) ä¾èµ–ç»„ä»¶ httpæ¡†æž¶ gin æ—¥å¿—ç»„ä»¶ logrus å‘½ä»¤è¡Œç»„ä»¶ cobra githubåœ°å€gaopengfei123123/hook]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>tools</tag>
        <tag>github</tag>
        <tag>hook</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è½¬ Go æ¨¡ä»¿Unix ç®¡é“æ“ä½œ]]></title>
    <url>%2F2019%2F11%2F14%2Fgo-pipe-pattern%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡æ‘˜å½•äº†è®¸å¼ä¼Ÿ ã€ŠGoï¼ŒåŸºäºŽè¿žæŽ¥ä¸Žç»„åˆçš„è¯­è¨€ã€‹éƒ¨åˆ†å†…å®¹ï¼Œä¸ºäº†ä¾¿äºŽç†è§£ï¼Œæˆ‘åœ¨å…¶åŽç«¯å†™äº†ä¸ªå®Œæ•´çš„ç¤ºä¾‹ç¨‹åºå¸®åŠ©ç†è§£ï¼Œè¿™ç¯‡æ–‡ç«  ä¸€æ˜¯å±•ç¤ºgoåœ¨å¹¶è¡Œç¼–ç¨‹ä¸­çš„ä¼Ÿå¤§ï¼Œä¹Ÿæ˜¯ç†è§£å’Œå­¦ä¹ é—­åŒ…çš„æ´»çš„æ•™ç§‘ä¹¦ æ­£æ–‡è®©æˆ‘ä»¬ä»ŽUnixè°ˆèµ·ã€‚Goè¯­è¨€ä¸ŽUnixã€Cè¯­è¨€æœ‰ç€æžæ·±çš„æ¸Šæºã€‚Goè¯­è¨€çš„é¢†è¢–ä»¬å‚ä¸Žç”šè‡³ä¸»å¯¼äº†Unixå’ŒCè¯­è¨€çš„è®¾è®¡ã€‚Ken Thompson ç”šè‡³ç®—å¾—ä¸ŠUnixå’ŒCè¯­è¨€çš„é¼»ç¥–ã€‚Goè¯­è¨€äº¦æ·±å—Unixå’ŒCè¯­è¨€çš„è®¾è®¡å“²å­¦å½±å“ã€‚ åœ¨Unixä¸–ç•Œé‡Œï¼Œç»„ä»¶å°±æ˜¯åº”ç”¨ç¨‹åºï¼ˆappï¼‰ï¼Œæ¯ä¸ªappå¯å¤§ä½“æŠ½è±¡ä¸ºï¼š è¾“å…¥ï¼šstdinï¼ˆæ ‡å‡†è¾“å…¥ï¼‰, paramsï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰ è¾“å‡ºï¼šstdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ åè®®ï¼štext (data stream) ä¸åŒçš„åº”ç”¨ç¨‹åºï¼ˆappï¼‰å¦‚ä½•è¿žæŽ¥ï¼Ÿç­”æ¡ˆæ˜¯ï¼šç®¡é“ï¼ˆpipelineï¼‰ã€‚åœ¨Unixä¸–ç•Œä¸­å¤§å®¶å¯¹è¿™æ ·çš„ä¸œè¥¿å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼š1app1 params1 | app2 params2 é€šè¿‡ç®¡é“ï¼ˆpipelineï¼‰ï¼Œå¯ä»¥å°†ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¾“å‡ºï¼ˆstdoutï¼‰è½¬æ¢ä¸ºå¦ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„è¾“å…¥ï¼ˆstdinï¼‰ã€‚æ›´ä¸ºç¥žå¥‡çš„ä¸€ç‚¹ï¼Œæ˜¯è¿™äº›åº”ç”¨ç¨‹åºæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ã€‚app1æ¯äº§ç”Ÿä¸€æ®µè¾“å‡ºï¼Œç«‹å³ä¼šè¢«app2æ‰€å¤„ç†ã€‚æ‰€ä»¥ç®¡é“ï¼ˆpipelineï¼‰ç§°å¾—ä¸Šæ˜¯æœ€å¤è€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æžå…¶ä¼˜ç§€çš„å¹¶è¡Œè®¾æ–½ï¼Œç®€å•è€Œå¼ºå¤§ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUnixä¸–ç•Œä¸­ä¸åŒåº”ç”¨ç¨‹åºç›´æŽ¥æ˜¯æ¾æ•£è€¦åˆçš„ã€‚ä¸Šæ¸¸appçš„è¾“å‡ºæ˜¯xmlè¿˜æ˜¯jsonï¼Œä¸‹æ¸¸appéœ€è¦çŸ¥æ™“ï¼Œä½†å¹¶æ— ä»»ä½•å¼ºåˆ¶çš„çº¦æŸã€‚åŒä¸€è¾“å‡ºï¼Œä¸åŒçš„ä¸‹æ¸¸appï¼Œå¯¹åè®®çš„ç†è§£ç”šè‡³éƒ½å¯èƒ½å¹¶ä¸ç›¸åŒã€‚ä¾‹å¦‚ï¼Œä¸Šæ¸¸appè¾“å‡ºä¸€æ®µxmlæ–‡æœ¬ï¼Œå¯¹äºŽæŸä¸ªä¸‹æ¸¸appæ¥è¯´ï¼Œæ˜¯ä¸€é¢—domæ ‘ï¼Œä½†å¯¹linecountç¨‹åºæ¥è¯´åªæ˜¯ä¸€ä¸ªå¤šè¡Œçš„æ–‡æœ¬ï¼Œå¯¹äºŽè‹±æ–‡å•è¯è¯é¢‘ç»Ÿè®¡ç¨‹åºæ¥è¯´ï¼Œæ˜¯ä¸€ç¯‡è‹±æ–‡æ–‡ç« ã€‚ ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä»¬å…ˆå°è¯•åœ¨Goè¯­è¨€ä¸­æ¨¡æ‹Ÿæ•´ä¸ªUnixçš„ç®¡é“ï¼ˆpipelineï¼‰æœºåˆ¶ã€‚é¦–å…ˆæ˜¯åº”ç”¨ç¨‹åºï¼ˆappï¼‰ï¼Œæˆ‘ä»¬æŠ½è±¡ä¸ºï¼š1func(in io.Reader, out io.Writer, args []string) ä¹Ÿå°±æ˜¯è¯´ï¼ŒUnix ä¸­çš„ app1 params1 | app2 params2å¯¹åº”Goè¯­è¨€ä¸­æ˜¯ï¼š1pipe( bind(app1, params1), bind(app2, params2) ) å…¶ä¸­ï¼Œbind å‡½æ•°å®žçŽ°å¦‚ä¸‹ï¼š123456789func bind( app func(in io.Reader, out io.Writer, args []string), args []string) func(in io.Reader, out io.Writer) &#123; return func(in io.Reader, out io.Writer) &#123; app(in, out, args) &#125;&#125; è¦ç†è§£bindå‡½æ•°ï¼Œéœ€è¦å…ˆç†è§£â€œé—­åŒ…â€ã€‚Goè¯­è¨€ä¸­ï¼Œåº”ç”¨ç¨‹åºä»¥ä¸€ä¸ªé—­åŒ…çš„å½¢å¼ä½“çŽ°ã€‚å¦‚æžœä½ ç†Ÿæ‚‰å‡½æ•°å¼ç¼–ç¨‹ï¼Œä¸éš¾å‘çŽ°ï¼Œè¿™ä¸ªbindå‡½æ•°å…¶å®žå°±æ˜¯æ‰€è°“çš„æŸ¯é‡ŒåŒ–ï¼ˆcurryingï¼‰ã€‚ pipeå‡½æ•°å¦‚ä¸‹ï¼š123456789101112131415func pipe( app1 func(in io.Reader, out io.Writer), app2 func(in io.Reader, out io.Writer)) func(in io.Reader, out io.Writer) &#123; return func(in io.Reader, out io.Writer) &#123; pr, pw := io.Pipe() defer pw.Close() go func() &#123; defer pr.Close() app2(pr, out) &#125;() app1(in, pw) &#125;&#125; è¦ç†è§£pipeå‡½æ•°ï¼Œé™¤äº†â€œé—­åŒ…â€å¤–ï¼Œéœ€è¦çŸ¥æ™“deferå…³é”®å­—å’Œgoroutineï¼ˆgoå…³é”®å­—ï¼‰ã€‚deferè¯­å¥ä¼šåœ¨å‡½æ•°é€€å‡ºæ—¶æ‰§è¡Œï¼ˆæ— è®ºæ˜¯å¦å‘ç”Ÿäº†å¼‚å¸¸ï¼‰ï¼Œé€šå¸¸ç”¨äºŽèµ„æºçš„æ¸…ç†æ“ä½œï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶å¥æŸ„ç­‰ï¼‰ã€‚æœ‰äº†deferè¯­å¥ï¼ŒGoè¯­è¨€ä¸­çš„é”™è¯¯å¤„ç†ä»£ç æ˜¾å¾—éžå¸¸ä¼˜é›…ã€‚åœ¨ä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°è°ƒç”¨å‰åŠ ä¸Šgoå…³é”®å­—ï¼Œå°±ä¼šä½¿å¾—è¯¥å‡½æ•°åœ¨æ–°çš„goroutineä¸­å¹¶è¡Œæ‰§è¡Œã€‚ç†è§£äº†è¿™äº›èƒŒæ™¯ï¼Œè¿™ä¸ªpipeå‡½æ•°ä¸éš¾ç†è§£ï¼Œæ— éžæ˜¯ï¼šå…ˆåˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œè®©app1è¯»å…¥æ•°æ®ï¼ˆinï¼‰ï¼Œå¹¶å‘ç®¡é“çš„å†™å…¥ç«¯ï¼ˆpwï¼‰è¾“å‡ºï¼Œå¯åŠ¨ä¸€ä¸ªæ–°goroutineï¼Œè®©app2ä»Žç®¡é“çš„è¯»å…¥ç«¯è¯»å–æ•°æ®ï¼Œå¹¶å°†å¤„ç†ç»“æžœè¾“å‡ºï¼ˆoutï¼‰ã€‚è¿™æ ·å¾—åˆ°çš„appå°±æ˜¯app1å’Œapp2çš„ç»„åˆäº†ã€‚ ä½ ç”šè‡³å¯ä»¥å¯¹å¤šä¸ªappè¿›è¡Œç»„åˆï¼š123456789101112131415161718func pipe(apps ...func(in io.Reader, out io.Writer)) func(in io.Reader, out io.Writer) &#123; if len(apps) == 0 &#123; return nil &#125; app := apps[0] for i := 1; i &lt; len(apps); i++ &#123; app1, app2 := app, apps[i] app = func(in io.Reader, out io.Writer) &#123; pr, pw := io.Pipe() defer pw.Close() go func() &#123; defer pr.Close() app2(pr, out) &#125;() app1(in, pw) &#125; &#125; return app&#125; æˆ‘ä»¬ä¸¾ä¸ªæ¯”è¾ƒå®žé™…çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰2ä¸ªåº”ç”¨ç¨‹åºtarï¼ˆæ‰“åŒ…ï¼‰ã€gzipï¼ˆåŽ‹ç¼©ï¼‰ï¼š12func tar(io.Reader, out io.Writer, files []string)func gzip(in io.Reader, out io.Writer) é‚£ä¹ˆæ‰“åŒ…å¹¶åŽ‹ç¼©çš„ä»£ç æ˜¯ï¼š1pipe( bind(tar, files), gzip )(nil, out) é€šè¿‡å¯¹ç®¡é“ï¼ˆpipelineï¼‰çš„æ¨¡æ‹Ÿæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒGoè¯­è¨€å¯¹å¹¶è¡Œæ”¯æŒæ˜¯éžå¸¸å¼ºå¤§çš„ï¼Œè¿™ä¸»è¦å¾—ç›ŠäºŽGoçš„è½»é‡çº§è¿›ç¨‹ï¼ˆgoroutineï¼‰ã€‚ å®žä¾‹ç¨‹åºï¼Œå¸®åŠ©ç†è§£ç®¡é“ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package mainimport ( "io" "os" "bufio" "bytes" "fmt" "strconv")//bindå‡½æ•°ä¸»è¦æ˜¯ç”¨æ¥ä¸ºpipeå‡½æ•°æ•´åˆç”¨çš„ï¼Œé€šè¿‡å°†é—­åŒ…å°†å‡½æ•°ç­¾åå˜æˆpipeæ‰€éœ€çš„æ ·å­//è¿”å›žä¸€ä¸ªå‡½æ•°é—­åŒ…ï¼Œå°†ä¸€ä¸ªå‡½æ•°å­—é¢é‡appå’Œå­—ç¬¦ä¸²slice ä¼ å…¥å…¶ä¸­func bind(app func(in io.Reader, out io.Writer, args []string), args []string) func(in io.Reader, out io.Writer) &#123; return func(in io.Reader, out io.Writer) &#123; app(in, out, args) &#125;&#125;//å°†ä¸¤ä¸ªå‡½æ•°æ’å…¥åˆ°ç®¡é“çš„ä¸­é—´ï¼Œè°ƒç”¨è€…åªéœ€è°ƒç”¨pipeè¿”å›žçš„å‡½æ•°å­—é¢é‡ï¼Œå¹¶ä¼ å…¥ç®¡é“çš„é¦–å°¾ä¸¤ç«¯ï¼Œå³å¯å®žçŽ°ç®¡é“//è¿”å›žä¸€ä¸ªæ–°çš„å‡½æ•°é—­åŒ…func pipe(app1 func(in io.Reader, out io.Writer), app2 func(in io.Reader, out io.Writer)) func(in io.Reader, out io.Writer) &#123; return func(in io.Reader, out io.Writer) &#123; pr, pw := io.Pipe() defer pw.Close() go func() &#123; defer pr.Close() app2(pr, out) &#125;() app1(in, pw) &#125;&#125;//è¯»å–args sliceçš„æ¯ä¸ªå­—ç¬¦ä¸²ï¼Œå°†å…¶ä½œä¸ºæ–‡ä»¶åï¼Œè¯»å–æ–‡ä»¶,å¹¶åœ¨æ–‡ä»¶çš„æ¯ä¸€è¡Œé¦–éƒ¨åŠ ä¸Šè¡Œå·ï¼Œå†™å…¥åˆ°outä¸­//æ­¤å¤„inæ²¡æœ‰ä½¿ç”¨åˆ°ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯ç®¡é“å®šä¹‰çš„ä¸€è‡´æ€§func app1(in io.Reader, out io.Writer, args []string) &#123; for _, v := range args &#123; //fmt.Println(v) file, err := os.Open(v) if err != nil &#123; continue &#125; defer file.Close() buf := bufio.NewReader(file) for i:=1; ;i++&#123; line, err := buf.ReadBytes('\n') if err != nil &#123; break &#125; linenum := strconv.Itoa(i) nline := []byte(linenum + " ") nline = append(nline, line...) out.Write(nline) &#125; &#125;&#125; 1234567891011121314151617181920212223//app2 ä¸»è¦æ˜¯å°†å­—èŠ‚æµè½¬åŒ–ä¸ºå¤§å†™,ä¸­æ–‡å¯èƒ½ä¼šæœ‰ç‚¹é—®é¢˜ï¼Œä¸è¿‡ä¸»è¦æ˜¯æ¼”ç¤ºç”¨ï¼Œé‡åœ¨ç†è§£æ€æƒ³//read from in, convert byte to Upper ,write the result to outfunc app2(in io.Reader, out io.Writer) &#123; rd := bufio.NewReader(in) p := make([]byte, 10) for &#123; n, _ := rd.Read(p) if n == 0 &#123; break &#125; t := bytes.ToUpper(p[:n]) out.Write(t) &#125;&#125;func main() &#123; args := os.Args[1:] for _, v := range args &#123; fmt.Println(v) &#125; p := pipe(bind(app1, args), app2) p(os.Stdin, os.Stdout)&#125; å‚è€ƒæ–‡ç« åŽŸæ–‡-golang å¹¶å‘è®¾è®¡æ¨¡å¼(äºŒ)â€“ç®¡é“æ¨¡å¼1Goï¼ŒåŸºäºŽè¿žæŽ¥ä¸Žç»„åˆçš„è¯­è¨€ï¼ˆä¸Šï¼‰]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>pipe</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ˜¯ç”¨è„šæœ¬åˆ†å‰²Csvæ–‡ä»¶]]></title>
    <url>%2F2019%2F11%2F11%2Fpython-csv-split%2F</url>
    <content type="text"><![CDATA[é¦–å…ˆå®‰è£…panda 1pip install pandas åˆ›å»ºè„šæœ¬:1234import pandas as pd rows = pd.read_csv("csvfile.csv", chunksize=5000000) # æ¯ä¸ªæ–‡ä»¶çš„å°ºå¯¸, ä»¥åŠå¯¼å…¥æ–‡ä»¶åfor i, chuck in enumerate(rows): chuck.to_csv('out&#123;&#125;.csv'.format(i)) # è¾“å‡ºæ–‡ä»¶å è¿è¡Œ1python demo.py pyæŒ½æ•‘äº†æˆ‘åŠå°æ—¶çš„æ‘¸é±¼æ—¶å…‰ç”Ÿå‘½]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>csv</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è½¬ Golang Httpå¹³æ»‘é‡å¯å®žçŽ°]]></title>
    <url>%2F2019%2F11%2F04%2Fgo-http-grace-restart%2F</url>
    <content type="text"><![CDATA[æœåŠ¡ç«¯ä»£ç ç»å¸¸éœ€è¦å‡çº§ï¼Œå¯¹äºŽçº¿ä¸Šç³»ç»Ÿçš„å‡çº§å¸¸ç”¨çš„åšæ³•æ˜¯ï¼Œé€šè¿‡å‰ç«¯çš„è´Ÿè½½å‡è¡¡ï¼ˆå¦‚nginxï¼‰æ¥ä¿è¯å‡çº§æ—¶è‡³å°‘æœ‰ä¸€ä¸ªæœåŠ¡å¯ç”¨ï¼Œä¾æ¬¡ï¼ˆç°åº¦ï¼‰å‡çº§ã€‚ è€Œå¦ä¸€ç§æ›´æ–¹ä¾¿çš„æ–¹æ³•æ˜¯åœ¨åº”ç”¨ä¸Šåšçƒ­é‡å¯ï¼Œç›´æŽ¥å‡çº§åº”ç”¨è€Œä¸åœæœåŠ¡ã€‚ ä¸»æµç¨‹ ç›‘å¬ä¿¡å·ï¼ˆUSR2ï¼‰ æ”¶åˆ°ä¿¡å·æ—¶forkå­è¿›ç¨‹ï¼ˆä½¿ç”¨ç›¸åŒçš„å¯åŠ¨å‘½ä»¤ï¼‰ï¼Œå°†æœåŠ¡ç›‘å¬çš„socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹ å­è¿›ç¨‹ç›‘å¬çˆ¶è¿›ç¨‹çš„socketï¼Œè¿™ä¸ªæ—¶å€™çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½å¯ä»¥æŽ¥æ”¶è¯·æ±‚ å­è¿›ç¨‹å¯åŠ¨æˆåŠŸä¹‹åŽï¼Œçˆ¶è¿›ç¨‹åœæ­¢æŽ¥æ”¶æ–°çš„è¿žæŽ¥ï¼Œç­‰å¾…æ—§è¿žæŽ¥å¤„ç†å®Œæˆï¼ˆæˆ–è¶…æ—¶ï¼‰ çˆ¶è¿›ç¨‹é€€å‡ºï¼Œå‡çº§å®Œæˆ å…³é”®ç‚¹ çˆ¶è¿›ç¨‹å°†socketæ–‡ä»¶æè¿°ç¬¦ä¼ é€’ç»™å­è¿›ç¨‹å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œï¼Œæˆ–è€…çŽ¯å¢ƒå˜é‡ç­‰ å­è¿›ç¨‹å¯åŠ¨æ—¶ä½¿ç”¨å’Œçˆ¶è¿›ç¨‹ä¸€æ ·çš„å‘½ä»¤è¡Œï¼Œå¯¹äºŽgolangæ¥è¯´ç”¨æ›´æ–°çš„å¯æ‰§è¡Œç¨‹åºè¦†ç›–æ—§ç¨‹åº server.Shutdown()ä¼˜é›…å…³é—­æ–¹æ³•æ˜¯go1.8çš„æ–°ç‰¹æ€§ server.Serve(l)æ–¹æ³•åœ¨Shutdownæ—¶ç«‹å³è¿”å›žï¼ŒShutdownæ–¹æ³•åˆ™é˜»å¡žè‡³contextå®Œæˆï¼Œæ‰€ä»¥Shutdownçš„æ–¹æ³•è¦å†™åœ¨ä¸»goroutineä¸­ ä»£ç å®žçŽ°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109package mainimport ( "context" "errors" "flag" "log" "net" "net/http" "os" "os/exec" "os/signal" "syscall" "time")var ( server *http.Server listener net.Listener graceful = flag.Bool("graceful", false, "listen on fd open 3 (internal use only)"))func handler(w http.ResponseWriter, r *http.Request) &#123; time.Sleep(20 * time.Second) w.Write([]byte("hello world233333!!!!"))&#125;func main() &#123; flag.Parse() http.HandleFunc("/hello", handler) server = &amp;http.Server&#123;Addr: ":9999"&#125; var err error if *graceful &#123; log.Print("main: Listening to existing file descriptor 3.") // cmd.ExtraFiles: If non-nil, entry i becomes file descriptor 3+i. // when we put socket FD at the first entry, it will always be 3(0+3) f := os.NewFile(3, "") listener, err = net.FileListener(f) &#125; else &#123; log.Print("main: Listening on a new file descriptor.") listener, err = net.Listen("tcp", server.Addr) &#125; if err != nil &#123; log.Fatalf("listener error: %v", err) &#125; go func() &#123; // server.Shutdown() stops Serve() immediately, thus server.Serve() should not be in main goroutine err = server.Serve(listener) log.Printf("server.Serve err: %v\n", err) &#125;() signalHandler() log.Printf("signal end")&#125;func reload() error &#123; tl, ok := listener.(*net.TCPListener) if !ok &#123; return errors.New("listener is not tcp listener") &#125; f, err := tl.File() if err != nil &#123; return err &#125; args := []string&#123;"-graceful"&#125; log.Printf("exec Command: %s %v", os.Args[0], args) cmd := exec.Command(os.Args[0], args...) cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr // put socket FD at the first entry cmd.ExtraFiles = []*os.File&#123;f&#125; return cmd.Start()&#125;func signalHandler() &#123; ch := make(chan os.Signal, 1) signal.Notify(ch, syscall.SIGINT, syscall.SIGTERM, syscall.SIGUSR2) for &#123; sig := &lt;-ch log.Printf("signal: %v", sig) // timeout context for shutdown ctx, _ := context.WithTimeout(context.Background(), 20*time.Second) switch sig &#123; case syscall.SIGINT, syscall.SIGTERM: // stop log.Printf("stop") signal.Stop(ch) server.Shutdown(ctx) log.Printf("graceful shutdown") return case syscall.SIGUSR2: // reload log.Printf("reload") err := reload() if err != nil &#123; log.Fatalf("graceful restart error: %v", err) &#125; server.Shutdown(ctx) log.Printf("graceful reload") return &#125; &#125;&#125; æ–‡ç« åŽŸæ–‡]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>http</tag>
        <tag>grace</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Golang é€šè¿‡ Context æŽ§åˆ¶å¹¶å‘çš„åº”ç”¨åœºæ™¯]]></title>
    <url>%2F2019%2F10%2F25%2Fgo-context%2F</url>
    <content type="text"><![CDATA[golang é‡Œå‡ºçŽ°å¤š goroutine çš„åœºæ™¯å¾ˆå¸¸è§, æœ€å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼å°±æ˜¯ WaitGroup å’Œ Context, ä»Šå¤©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ Context çš„åº”ç”¨åœºæ™¯ ä½¿ç”¨åœºæ™¯åœºæ™¯ä¸€: å¤šgoroutineæ‰§è¡Œè¶…æ—¶é€šçŸ¥å¹¶å‘æ‰§è¡Œçš„ä¸šåŠ¡ä¸­æœ€å¸¸è§çš„å°±æ˜¯æœ‰åç¨‹æ‰§è¡Œè¶…æ—¶, å¦‚æžœä¸åšè¶…æ—¶å¤„ç†å°±ä¼šå‡ºçŽ°ä¸€ä¸ªåƒµå°¸è¿›ç¨‹, è¿™ç´¯è®¡çš„å¤šäº†å°±ä¼šæœ‰ä¸€é˜µæ‰‹å¿™è„šä¹±äº†, æ‰€ä»¥æˆ‘ä»¬è¦åœ¨æºå¤´ä¸Šå°±é¿å…å®ƒä»¬ çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹:12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package mainimport ( "context" "fmt" "time")/**åŒä¸€ä¸ªcontentå¯ä»¥æŽ§åˆ¶å¤šä¸ªgoroutine, ç¡®ä¿çº¿ç¨‹å¯æŽ§, è€Œä¸æ˜¯æ¯æ–°å»ºä¸€ä¸ªgoroutineå°±è¦æœ‰ä¸€ä¸ªchanåŽ»é€šçŸ¥ä»–å…³é—­æœ‰äº†ä»–ä»£ç æ›´åŠ ç®€æ´*/func main() &#123; fmt.Println("run demo \n\n\n") demo()&#125;func demo() &#123; ctx, cancel := context.WithTimeout(context.Background(), 9*time.Second) go watch(ctx, "[çº¿ç¨‹1]") go watch(ctx, "[çº¿ç¨‹2]") go watch(ctx, "[çº¿ç¨‹3]") index := 0 for &#123; index++ fmt.Printf("%d ç§’è¿‡åŽ»äº† \n", index) time.Sleep(1 * time.Second) if index &gt; 10 &#123; break &#125; &#125; fmt.Println("é€šçŸ¥åœæ­¢ç›‘æŽ§") // å…¶å®žæ­¤æ—¶å·²ç»è¶…æ—¶, åç¨‹å·²ç»æå‰é€€å‡º cancel() // é˜²æ­¢ä¸»è¿›ç¨‹æå‰é€€å‡º time.Sleep(3 * time.Second) fmt.Println("done")&#125;func watch(ctx context.Context, name string) &#123; for &#123; select &#123; case &lt;-ctx.Done(): fmt.Printf("%s ç›‘æŽ§é€€å‡º, åœæ­¢äº†...\n", name) return default: fmt.Printf("%s goroutineç›‘æŽ§ä¸­... \n", name) time.Sleep(2 * time.Second) &#125; &#125;&#125; ä½¿ç”¨ context.WithTimeout() ç»™æ–‡æœ¬æµè®¾ç½®ä¸€ä¸ªæ—¶é—´ä¸Šé™, ç»“åˆ for+select åŽ»æŽ¥æ”¶æ¶ˆæ¯. å½“æ‰§è¡Œè¶…æ—¶,æˆ–æ‰‹åŠ¨å…³é—­éƒ½ä¼šç»™ &lt;-ctx.Done() å‘é€æ¶ˆæ¯,è€Œä¸”æ‰€æœ‰ä½¿ç”¨åŒä¸€ä¸ª context éƒ½ä¼šæ”¶åˆ°è¿™ä¸ªé€šçŸ¥, å…åŽ»äº†ä¸€ä¸ªä¸€ä¸ªé€šçŸ¥çš„ç¹çä»£ç  åœºæ™¯äºŒ: ç±»ä¼¼webæœåŠ¡å™¨ä¸­çš„sessionæ¯”å¦‚åœ¨phpä¸­(æ²¡ç”¨swooleæ‰©å±•), ä¸€ä¸ªè¯·æ±‚è¿›æ¥, ä»Ž $_REQUEST $_SERVER èƒ½èŽ·å–åˆ°çš„æ˜¯æœ‰å…³è¿™ä¸€æ¡è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯, å“ªæ€•æ˜¯ä½¿ç”¨å…¨å±€å˜é‡ä¹Ÿæ˜¯ç»™è¿™ä¸€ä¸ªè¯·æ±‚æ¥æœåŠ¡çš„, æ˜¯çº¿ç¨‹å®‰å…¨çš„ ä½†æ˜¯ golang å°±ä¸ä¸€æ ·äº†, å› ä¸ºç¨‹åºæœ¬èº«å°±èƒ½èµ·ä¸€ä¸ª web sever, å› æ­¤å°±ä¸èƒ½éšä¾¿ä½¿ç”¨å…¨å±€å˜é‡äº†, ä¸ç„¶å°±æ˜¯å†…å­˜æ³„éœ²è­¦å‘Š. ä½†æ˜¯å®žé™…ä¸šåŠ¡å½“ä¸­éœ€è¦æœ‰ä¸€ä¸ªç±»ä¼¼session çš„ä¸œè¥¿æ¥æ‰¿è½½å•æ¬¡è¯·æ±‚çš„ä¿¡æ¯, ä¸¾ä¸€ä¸ªå…·ä½“çš„ä¾‹å­å°±æ˜¯: ç»™æ¯æ¬¡è¯·æ±‚åŠ ä¸€ä¸ª uniqueID è¯¥å¦‚ä½•å¤„ç†? æœ‰äº†è¿™ä¸ª uniqueID, è¯·æ±‚çš„æ‰€æœ‰æ—¥å¿—éƒ½èƒ½å¸¦ä¸Šå®ƒ, è¿™æ ·æŽ’æŸ¥é—®é¢˜çš„æ—¶å€™æ–¹ä¾¿è¿½è¸ªä¸€æ¬¡è¯·æ±‚å‘ç”Ÿäº†ä»€ä¹ˆ å¦‚ä¸‹:1234567891011121314151617181920212223func demo2() &#123; pCtx, pCancel := context.WithCancel(context.Background()) pCtx = context.WithValue(pCtx, "parentKey", "parentVale") go watch(pCtx, "[çˆ¶è¿›ç¨‹1]") go watch(pCtx, "[çˆ¶è¿›ç¨‹2]") cCtx, cCancel := context.WithCancel(pCtx) go watch(cCtx, "[å­è¿›ç¨‹1]") go watch(cCtx, "[å­è¿›ç¨‹2]") fmt.Println(pCtx.Value("parentKey")) fmt.Println(cCtx.Value("parentKey")) time.Sleep(10 * time.Second) fmt.Println("å­è¿›ç¨‹å…³é—­") cCancel() time.Sleep(5 * time.Second) fmt.Println("çˆ¶è¿›ç¨‹å…³é—­") pCancel() time.Sleep(3 * time.Second) fmt.Println("done")&#125; æœ€å¼€å§‹çš„ context.WithCancel(context.Background()) ä¸­ context.Background() å°±æ˜¯ä¸€ä¸ªæ–°å»ºçš„ context, åˆ©ç”¨ context èƒ½ç»§æ‰¿çš„ç‰¹æ€§,å¯ä»¥å°†è‡ªå·±çš„ç¨‹åºæž„å»ºå‡ºä¸€ä¸ª context æ ‘, context æ‰§è¡Œ cancel() å°†å½±å“åˆ°å½“å‰ context å’Œå­ context, ä¸ä¼šå½±å“åˆ°çˆ¶çº§. åŒæ—¶ context.WithValue ä¹Ÿä¼šç»™ context å¸¦ä¸Šè‡ªå®šä¹‰çš„å€¼, è¿™æ · uniqueID å°±èƒ½è½»æ¾çš„ä¼ é€’äº†ä¸‹åŽ», è€Œä¸æ˜¯ä¸€å±‚å±‚çš„ä¼ é€’å‚æ•°, æ”¹funcä»€ä¹ˆçš„ å¯¹äºŽ context å¾ˆå€¼å¾—å‚è€ƒçš„åº”ç”¨æœ‰: Gin logrus Context ç›¸å…³ func å’ŒæŽ¥å£ç»§æ‰¿ context éœ€è¦å®žçŽ°å¦‚ä¸‹å››ä¸ªæŽ¥å£12345678910type Context interface &#123; Deadline() (deadline time.Time, ok bool) Done() &lt;-chan struct&#123;&#125; Err() error Value(key interface&#123;&#125;) interface&#123;&#125;&#125; å½“ä½¿ç”¨çš„æ—¶å€™ä¸éœ€è¦å®žçŽ°æŽ¥å£, å› ä¸ºå®˜æ–¹åŒ…é‡Œå·²ç»åŸºäºŽ emptyCtx å®žçŽ°äº†ä¸€ä¸ª, è°ƒç”¨æ–¹æ³•æœ‰ 1234567891011121314var ( background = new(emptyCtx) todo = new(emptyCtx))// è¿™ä¸ªæ˜¯æœ€åˆå§‹çš„ctx, ä¹‹åŽçš„å­ctxéƒ½æ˜¯ç»§æ‰¿è‡ªå®ƒfunc Background() Context &#123; return background&#125;// ä¸æ¸…æ¥šcontextè¦å¹²å˜›, ä½†æ˜¯å°±å¾—æœ‰ä¸€ä¸ªctxçš„ç”¨è¿™ä¸ªfunc TODO() Context &#123; return todo&#125; ç»§æ‰¿ç”¨çš„å‡½æ•°1234func WithCancel(parent Context) (ctx Context, cancel CancelFunc)func WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc)func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)func WithValue(parent Context, key, val interface&#123;&#125;) Context WithCancel è¿”å›žä¸€ä¸ªå¸¦ cancel å‡½æ•°çš„ctx, WithDeadline åœ¨åˆ°è¾¾æŒ‡å®šæ—¶é—´æ—¶è‡ªåŠ¨æ‰§è¡Œ cancel() WithTimeout æ˜¯ WithDeadlineçš„å£³å­, åŒºåˆ«å°±æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯å¤šå°‘æ—¶é—´è¿‡åŽæ‰§è¡Œ cancel 123func WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc) &#123; return WithDeadline(parent, time.Now().Add(timeout))&#125; WithValue ç»§æ‰¿çˆ¶ç±»ctxæ—¶é¡ºä¾¿å¸¦ä¸Šä¸€ä¸ªå€¼]]></content>
      <categories>
        <category>go</category>
      </categories>
      <tags>
        <tag>go</tag>
        <tag>context</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Centos7 éƒ¨ç½² K8s]]></title>
    <url>%2F2019%2F06%2F17%2Fk8s-install-centos7%2F</url>
    <content type="text"><![CDATA[éƒ½æ˜¯èµ°çš„å›½å†…é•œåƒæº å…³é—­ selinux12setenforce 0 #å®žæ—¶åŠ¨æ€å…³é—­ selinuxsed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/&apos; /etc/selinux/config #ç¦æ­¢é‡å¯åŽè‡ªåŠ¨å¼€å¯ å…³é—­äº¤æ¢åˆ†åŒº12swapoff -a #å®žæ—¶åŠ¨æ€å…³é—­äº¤æ¢åˆ†åŒºsed -i &apos;/ swap / s/^/#/&apos; /etc/fstab #ç¦æ­¢é‡å¯åŽè‡ªåŠ¨å¼€å¯ ç½‘ç»œé…ç½®æ–‡ä»¶123456789cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.confnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1net.ipv4.ip_forward = 1vm.swappiness=0EOFmodprobe br_netfilter #æ‰§è¡Œè¯¥å‘½ä»¤ å¦‚æžœä¸æ‰§è¡Œå°±ä¼šåœ¨åº”ç”¨k8s.confæ—¶å‡ºçŽ°åŠ è½½é”™è¯¯sysctl -p /etc/sysctl.d/k8s.conf #åº”ç”¨é…ç½®æ–‡ä»¶ yumæ¢å›½å†…æº12345cd /etc/yum.repos.d &amp;&amp; \sudo mv CentOS-Base.repo CentOS-Base.repo.bak &amp;&amp; \sudo wget -O CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo &amp;&amp; \yum clean all &amp;&amp; \yum makecache é…ç½®k8sèµ„æºçš„ä¸‹è½½åœ°å€1234567891011cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo[kubernetes]name=Kubernetesbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64enabled=1gpgcheck=0repo_gpgcheck=0gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpgEOF å®‰è£…ä¾èµ–1yum install -y docker kubelet kubeadm kubectl dockeræ¢æº12345678mkdir -p /etc/dockersudo tee /etc/docker/daemon.json &lt;&lt;-&apos;EOF&apos;&#123;&quot;registry-mirrors&quot;: [&quot;https://registry.docker-cn.com&quot;]&#125;EOFservice docker restart å¼€æœºå¯åŠ¨123systemctl disable firewalld.service &amp;&amp; systemctl stop firewalld.service systemctl enable docker &amp;&amp; systemctl start dockersystemctl enable kubelet &amp;&amp; systemctl start kubelet ä¸‹è½½k8sä¾èµ–é•œåƒèŽ·å–ä¾èµ–çš„é•œåƒ1kubeadm config images list å›½å†…ç”¨æˆ·é€šè¿‡é˜¿é‡Œäº‘é•œåƒä¸‹è½½k8sä¾èµ–ç»„ä»¶12345kubeadm config images list |sed -e &apos;s/^/docker pull /g&apos; -e &apos;s#k8s.gcr.io#registry.cn-hangzhou.aliyuncs.com/google_containers#g&apos; |sh -xdocker images |grep registry.cn-hangzhou.aliyuncs.com/google_containers |awk &apos;&#123;print &quot;docker tag &quot;,$1&quot;:&quot;$2,$1&quot;:&quot;$2&#125;&apos; |sed -e &apos;s#registry.cn-hangzhou.aliyuncs.com/google_containers#k8s.gcr.io#2&apos; |sh -xdocker images |grep registry.cn-hangzhou.aliyuncs.com/google_containers |awk &apos;&#123;print &quot;docker rmi &quot;, $1&quot;:&quot;$2&#125;&apos; |sh -x ä¸»èŠ‚ç‚¹åˆå§‹åŒ–Kubernetes v1.14.31kubeadm init --kubernetes-version=1.14.3 æ‰§è¡ŒæˆåŠŸåŽå‡ºçŽ°1234567891011121314To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/configYou should now deploy a pod network to the cluster.Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/Then you can join any number of worker nodes by running the following on each as root:kubeadm join 192.168.31.120:6443 --token 6nelb5.lrc5qbs0k3v64eln \ --discovery-token-ca-cert-hash sha256:c55a113114d664133685430a86f2e39f40e9df6b12ad3f4d65462fd372079e97 nodeèŠ‚ç‚¹å¯åŠ¨12kubeadm join 192.168.31.120:6443 --token 6nelb5.lrc5qbs0k3v64eln \ --discovery-token-ca-cert-hash sha256:c55a113114d664133685430a86f2e39f40e9df6b12ad3f4d65462fd372079e97 å°±æ˜¯åˆå§‹åŒ–åŽçš„æœ€åŽä¸€æ¡å‘½ä»¤ ä¸»èŠ‚ç‚¹æ‰§è¡Œï¼š1234[root@localhost ~]# kubectl get nodesNAME STATUS ROLES AGE VERSIONlocalhost.localdomain NotReady master 40m v1.14.3miwifi-r3-srv NotReady &lt;none&gt; 3m48s v1.14.3 çŠ¶æ€è¿˜æ˜¯notReady æŸ¥çœ‹æ–‡æ¡£ https://kubernetes.io/docs/concepts/cluster-administration/addons/ è¿™é‡Œé€‰äº† weave æ’ä»¶æ–‡æ¡£ï¼š https://www.weave.works/docs/net/latest/kubernetes/kube-addon/æ‰§è¡Œå‘½ä»¤1kubectl apply -f &quot;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d &apos;\n&apos;)&quot; ç¨å¾®ç­‰å‡ åˆ†é’Ÿå°±å¯ä»¥çœ‹åˆ°æ­£å¸¸äº†1234[root@localhost ~]# kubectl get nodesNAME STATUS ROLES AGE VERSIONlocalhost.localdomain Ready master 49m v1.14.3miwifi-r3-srv Ready &lt;none&gt; 12m v1.14.3 kubeadm token è¿‡æœŸçš„æƒ…å†µkubeadm join ç”¨åˆ°çš„tokenæœ‰æ•ˆæœŸæ˜¯24h ç”Ÿæˆ token, æŸ¥çœ‹token 12345$ kubeadm token createrugi2c.bb97e7ney91bogbg$ kubeadm token listTOKEN TTL EXPIRES USAGES DESCRIPTION EXTRA GROUPSrugi2c.bb97e7ney91bogbg 23h 2019-06-18T22:28:11+08:00 authentication,signing &lt;none&gt; system:bootstrappers:kubeadm:default-node-token ç”Ÿæˆè¯ä¹¦1openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed &apos;s/^.* //&apos; æ–°tokenåŠ å…¥12kubeadm join 192.168.31.120:6443 --token rugi2c.bb97e7ney91bogbg \ --discovery-token-ca-cert-hash sha256:c55a113114d664133685430a86f2e39f40e9df6b12ad3f4d65462fd372079e97 æ­å»ºæ•™ç¨‹éƒ¨ç½²nodeèŠ‚ç‚¹]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[K8s å®‰è£… Minikube]]></title>
    <url>%2F2019%2F05%2F14%2Fk8s-minikube%2F</url>
    <content type="text"><![CDATA[æœ¬åœ°å¿«é€Ÿè£…ä¸€ä¸ªå¾®åž‹çš„kubernetesçŽ¯å¢ƒ, ç¿»å¢™çš„è‹¦è°èƒ½æ‡‚? mac æœ¬åœ°å®‰è£…minikubeçŽ¯å¢ƒçŽ¯å¢ƒéœ€æ±‚: kubectl æœ¬åœ°åšå‘½ä»¤è¡ŒæŽ§åˆ¶ç”¨, æ‰€æœ‰çš„å‘½ä»¤æ“ä½œéƒ½æ˜¯é€šè¿‡å®ƒ vittualBox v5.1 + æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬å°±å¯¹äº† minikube åœ¨æœ¬åœ°æ­å»ºæµ‹è¯•çŽ¯å¢ƒ ç¿»å¢™æœ‰å›°éš¾çš„å¯ä»¥å‚è€ƒä¸€ä¸‹è¿™ä¸ª https://yq.aliyun.com/articles/221687 å®‰è£… kubectl1âžœ brew install kubectl ä¸‹è½½æœ€æ–° minikube ä¸å»ºè®®ä½¿ç”¨brewå®‰è£…, é¦–å…ˆç‰ˆæœ¬ä¸ä¼šæ˜¯æœ€æ–°, å†è€…ä¼šå‡ºçŽ°èŽ«åå…¶å¦™çš„é—®é¢˜123âžœ curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 &amp;&amp; \ chmod +x minikube &amp;&amp; \ sudo mv minikube /usr/local/bin/ é»˜è®¤ start æ—¶è¿è¡Œçš„virtualBox åŽ»å®˜ç½‘ä¸‹ä¸ªæœ€æ–°çš„å°±è¡Œ å¯åŠ¨, æœ€å¥½æŠŠdockeré•œåƒæŒ‡å®šåˆ°å›½å†…12345678910111213141516171819202122232425âžœ ~ minikube start --registry-mirror=https://registry.docker-cn.comðŸ˜„ minikube v1.0.1 on darwin (amd64)ðŸ’¿ Downloading Minikube ISO ... 142.88 MB / 142.88 MB [============================================] 100.00% 0sðŸ¤¹ Downloading Kubernetes v1.14.1 images in the background ...ðŸ”¥ Creating virtualbox VM (CPUs=2, Memory=2048MB, Disk=20000MB) ...ðŸ“¶ &quot;minikube&quot; IP address is 192.168.99.103ðŸ³ Configuring Docker as the container runtime ...ðŸ³ Version of container runtime is 18.06.3-ceâŒ› Waiting for image downloads to complete ...âœ¨ Preparing Kubernetes environment ...ðŸ’¾ Downloading kubeadm v1.14.1ðŸ’¾ Downloading kubelet v1.14.1ðŸšœ Pulling images required by Kubernetes v1.14.1 ...ðŸš€ Launching Kubernetes v1.14.1 using kubeadm ...âŒ› Waiting for pods: apiserver proxy etcd scheduler controller dnsðŸ”‘ Configuring cluster permissions ...ðŸ¤” Verifying component health .....ðŸ’— kubectl is now configured to use &quot;minikube&quot;ðŸ„ Done! Thank you for using minikube!âžœ ~ kubectl cluster-infoKubernetes master is running at https://192.168.99.103:8443KubeDNS is running at https://192.168.99.103:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxyTo further debug and diagnose cluster problems, use &apos;kubectl cluster-info dump&apos;. å¦‚æžœMinikube ISOå­˜åœ¨å¢™çš„é—®é¢˜, å°±æŠŠisoä¸‹è½½åŽæ”¾åˆ° ~/.minikube/cache/iso/ä¸‹ è¿™æ—¶Macä¸Šçš„dockerä¸èƒ½ç”¨docker for Macæä¾›çš„äº†, è€Œæ˜¯å®¿ä¸»æœºé‡Œé¢çš„docker, åˆ‡æ¢å‘½ä»¤ä¸º:1âžœ eval $(minikube docker-env) æ’¤é”€æ›´æ”¹1âžœ eval $(minikube docker-env -u) åŠ è½½åŽå°æŽ§åˆ¶é¢æ¿, ç¨ç­‰ä¸€ä¼š, è‡ªåŠ¨æ‰“å¡åŽå°ç•Œé¢1âžœ minikube dashboard éƒ¨ç½²ç¬¬ä¸€ä¸ªåº”ç”¨å‘½ä»¤è¡Œéƒ¨ç½²åˆ›å»ºnode.js åº”ç”¨åˆ›å»ºæ–‡ä»¶ server.js123456789var http = require('http');var handleRequest = function(request, response) &#123; console.log('Received request for URL: ' + request.url); response.writeHead(200); response.end('Hello World! V1');&#125;;var www = http.createServer(handleRequest);www.listen(3000); è¿è¡Œ1node server.js // è®¿é—®åœ°å€ http://localhost:3000 åˆ›å»ºdockeré•œåƒ123456FROM node:8.10.0EXPOSE 3000COPY server.js .CMD ["node", "server.js"] æž„å»ºé•œåƒ1âžœ docker build -t hello-node:v1 . å¦‚æžœå‡ºçŽ°Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running? è¯´æ˜Žä½ å¿˜äº†æ‰§è¡Œ eval $(minikube docker-env)kubeç”¨çš„ docker å’Œä½ æœ¬åœ°ç”¨çš„ docker æ˜¯ä¸¤ä¸ªä½ç½®, kubeçš„åœ¨è™šæ‹Ÿæœºé‡Œè¿è¡Œ åˆ›å»º deploymentæœ‰äº†é•œåƒå°±å…·å¤‡åˆ›å»ºpodçš„æ¡ä»¶, é€šå¸¸æ¥è¯´ä¸ç”¨ç›´æŽ¥åˆ›å»º pod, è€Œæ˜¯åˆ›å»º deployment æˆ–è€… replication controller, ç”±ä»–ä»¬æ¥è´Ÿè´£ç®¡ç†æœåŠ¡çš„è¿è¡Œ, è§„æ¨¡ç¼©æ”¾, è‡ªåŠ¨é‡å¯ç­‰ç­‰è¿™äº›æ“ä½œ, å°±å•ä¸ªpodæ¥è¯´æ˜¯å¯ä»¥éšæ—¶è¢«é”€æ¯çš„, ä¸èƒ½ä½œä¸ºç¨³å®šæœåŠ¡çš„ä¿è¯ 123âžœ kubectl run hello-node --image=hello-node:v1 --port=3000æˆ–âžœ kubectl create deployment hello-node --image=hello-node:v1 æŸ¥çœ‹å½“å‰deployment123âžœ kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGEhello-node 1/1 1 1 8m8s ready 1/1 è¯´æ˜Žå·²ç»å‡†å¤‡å°±ç»ªäº† æŸ¥çœ‹ pod123âžœ hellonode git:(master) âœ— kubectl get podsNAME READY STATUS RESTARTS AGEhello-node-5c58cb6dd4-h65fx 1/1 Running 0 8m40s ä»Žè¿™ä¸¤æ¡ä¿¡æ¯å°±èƒ½çœ‹å‡ºæ¥, æ¯ä¸ªpodéƒ½æ˜¯å¸¦éšæœºå­—ç¬¦ä¸²çš„, å¹¶ä¸æ‰“ç®—ç»™äººåŽ»æ“ä½œ, æˆ‘ä»¬ä¸»è¦ä¸“æ³¨åœ¨deploymentå’Œ service çš„æ­å»º æŸ¥çœ‹ deployment æè¿°123456789101112131415161718192021222324252627282930313233âžœ kubectl describe deployments/hello-nodeName: hello-nodeNamespace: defaultCreationTimestamp: Mon, 13 May 2019 14:17:03 +0800Labels: run=hello-nodeAnnotations: deployment.kubernetes.io/revision: 1Selector: run=hello-nodeReplicas: 1 desired | 1 updated | 1 total | 1 available | 0 unavailableStrategyType: RollingUpdateMinReadySeconds: 0RollingUpdateStrategy: 25% max unavailable, 25% max surgePod Template: Labels: run=hello-node Containers: hello-node: Image: hello-node:v1 Port: 3000/TCP Host Port: 0/TCP Environment: &lt;none&gt; Mounts: &lt;none&gt; Volumes: &lt;none&gt;Conditions: Type Status Reason ---- ------ ------ Available True MinimumReplicasAvailable Progressing True NewReplicaSetAvailableOldReplicaSets: &lt;none&gt;NewReplicaSet: hello-node-5c58cb6dd4 (1/1 replicas created)Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal ScalingReplicaSet 11m deployment-controller Scaled up replica set hello-node-5c58cb6dd4 to 1 è¿™é‡Œæ˜¯å¯¹deploymentçš„æ¦‚è§ˆ, Pod Template: ä¸‹å°±æ˜¯æ¯ä¸ªpodsçš„é…ç½®, ä¹‹åŽå¯¹éƒ¨ç½²çš„æ‰©å®¹éƒ½æ˜¯åŸºäºŽè¿™ä¸ªåŽ»å¤åˆ¶ åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åˆ›å»ºäº†deployment è€Œä¸”ä¹Ÿè‡ªåŠ¨ç”Ÿæˆpodäº†, å¯æ˜¯æœåŠ¡å¹¶ä¸èƒ½è¢«è®¿é—®åˆ°, ä¸ºä»€ä¹ˆ? å› ä¸ºç«¯å£æ²¡æœ‰å¯¹å¤–æš´éœ²å‡ºæ¥, æ‰€ä»¥æœ‰äº†ä¸‹ä¸€æ­¥ åˆ›å»ºserviceservice å°±æ˜¯ç”¨æ¥å¯¹æˆ‘æš´éœ²æœåŠ¡çš„ä¸œè¥¿, æ‰€æœ‰çš„ pod éƒ½æ˜¯åœ¨å†…ç½‘é€šä¿¡, å¤–éƒ¨è®¿é—®å°±å¾—è®© service è¿™å±‚ä»£ç†åŽ»è½¬å‘è¿‡åŽ», --type=LoadBalancer å°±æ˜¯æŒ‡å®šè½¬å‘ä¸ºè´Ÿè½½å‡è¡¡æ¨¡å¼, kubectl create service -h æŸ¥çœ‹æ›´å¤š, è¿™é‡Œä¸ç»†è®² åˆ›å»ºservice123âžœ kubectl expose deployment hello-node --type=LoadBalanceræˆ–âžœ kubectl expose deployment hello-node --type=LoadBalancer --port=3000 // è¿™é‡ŒæŒ‡å®šç«¯å£ æŸ¥çœ‹1234âžœ kubectl get service NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEhello-node LoadBalancer 10.111.18.151 &lt;pending&gt; 3000:31349/TCP 3skubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 3d è¯¦ç»†ä¿¡æ¯123456789101112131415âžœ kubectl describe services hello-node Name: hello-nodeNamespace: defaultLabels: run=hello-nodeAnnotations: &lt;none&gt;Selector: run=hello-nodeType: LoadBalancerIP: 10.111.18.151Port: &lt;unset&gt; 3000/TCPTargetPort: 3000/TCPNodePort: &lt;unset&gt; 31349/TCPEndpoints: 172.17.0.7:3000Session Affinity: NoneExternal Traffic Policy: ClusterEvents: &lt;none&gt; NodePort å°±æ˜¯ç»‘å®šåœ¨èŠ‚ç‚¹çš„é‚£ä¸ªç«¯å£ä¸Š, ç›´æŽ¥è®¿é—®èŠ‚ç‚¹ipå°±è¡Œ, ä¹Ÿå¯ä»¥ç”¨minikubeå‘½ä»¤ minikube service hello-node è‡ªåŠ¨å¸®ä½ æ‰“å¼€æœ¬åœ°åœ°å€ æ‰©å±•ç¤ºä¾‹çº¿ä¸Šè‚¯å®šæ˜¯æœ‰è¿™ç§åŠ¨æ€æ‰©å®¹çš„æƒ…å†µ, è€Œä¸”å¤šå®žä¾‹ä¹‹é—´æ»šåŠ¨å‡çº§ä¹Ÿä¸ä¼šåœæ­¢æœåŠ¡12345678âžœ kubectl scale deployments/hello-node --replicas=4deployment.extensions/hello-node scaledâžœ hellonode git:(master) âœ— kubectl get podsNAME READY STATUS RESTARTS AGEhello-node-5c58cb6dd4-d2qq9 1/1 Running 0 18shello-node-5c58cb6dd4-h65fx 1/1 Running 0 51mhello-node-5c58cb6dd4-jlzjw 1/1 Running 0 18shello-node-5c58cb6dd4-vmx4f 1/1 Running 0 18s æ›´æ–°åº”ç”¨é‡æ–°æž„å»ºä¸€ä¸ªnodeçš„é•œåƒservice.js123456789var http = require('http');var handleRequest = function(request, response) &#123; console.log('Received request for URL: ' + request.url); response.writeHead(200); response.end('Hello World! V2');&#125;;var www = http.createServer(handleRequest);www.listen(3000); 1âžœ docker build -t hello-node:v2 . è®¾ç½® deployment ä½¿ç”¨æ–°é•œåƒ1âžœ kubectl set image deployment/hello-node hello-node=hello-node:v2 æŸ¥çœ‹æ¯ä¸ªpodçš„å…·ä½“æƒ…å†µ1âžœ kubectl describe pods å†è®¿é—®åˆšæ‰çš„åœ°å€å°±èƒ½çœ‹åˆ°æ”¹å˜äº† æ¸…é™¤èµ„æº12âžœ kubectl delete service hello-nodeâžœ kubectl delete deployments hello-node ç»è¿‡ä¸Šé¢ä¸€å¥—æ“ä½œä¸‹æ¥, åº”è¯¥ä¹Ÿå¯¹k8sæœ‰äº†ä¸€ä¸ªå¤§è‡´çš„å°è±¡äº†, æ¯•ç«Ÿå…‰çœ‹å®žè·µæ‰æ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†, ä½†æ˜¯å¦‚æžœéƒ¨ç½²ä¸€ä¸ªæœåŠ¡è¿™æ ·ä¸€ä¸ªå‘½ä»¤ä¸€ä¸ªå‘½ä»¤çš„æ•²æ˜¯å¾ˆè¦å‘½çš„, è€Œä¸”æœåŠ¡å™¨è¿™çŽ©æ„, è½»æ˜“ä¸ä¼šåŠ¨, æ—¶é—´ä¸€é•¿å°±å®¹æ˜“å¿˜, å› æ­¤ç”¨é…ç½®æ–‡ä»¶åŽ»å¯åŠ¨æ›´åŠ åˆç† é€šè¿‡ yaml å¯åŠ¨å¦‚ä¸‹: test-service.yaml123456789101112131415161718192021222324252627282930313233343536373839apiVersion: v1kind: Servicemetadata: name: test-service labels: version: v2 run: hello-node app: test-servicespec: type: LoadBalancer ports: - port: 3001 targetPort: 3000 protocol: TCP selector: app: test-service---apiVersion: apps/v1kind: Deploymentmetadata: name: test-service labels: app: test-servicespec: replicas: 2 selector: matchLabels: app: test-service template: metadata: labels: app: test-service spec: containers: - name: node-pod image: hello-node:v2 imagePullPolicy: IfNotPresent ports: - containerPort: 3000 æ‰§è¡Œ12âžœ kubectl create -f test-service.yamlâžœ minikube service test-service è¿™æ ·é€šè¿‡é…ç½®æ–‡ä»¶å°±èƒ½å¯åŠ¨äº†, é…ç½®æ–‡ä»¶é‡Œé‡Œçš„å­—æ®µåŽç»­æˆ‘ä»¬å†è¯¦ç»†çš„è®²ä¸€ä¸‹ åˆ é™¤kubectl delete -f test-service.yaml ä»£ç åœ°å€ ç›¸å…³èµ„æ–™å¸¦ä½ ç†è§£Kubernetesï¼Œéƒ¨ç½²ä¸€ä¸ªNodeåº”ç”¨Kubernetesçš„ä¸‰ç§å¤–éƒ¨è®¿é—®æ–¹å¼ï¼šNodePortã€LoadBalancer å’Œ IngressMinikube - Kubernetesæœ¬åœ°å®žéªŒçŽ¯å¢ƒKubernetesä¹‹kubectlå¸¸ç”¨å‘½ä»¤replication controllerä¸Ždeploymentçš„åŒºåˆ«Kubenetesé‡Œpodå’Œserviceç»‘å®šçš„å®žçŽ°æ–¹å¼Kubernetesåˆ›å»ºèµ„æºå¯¹è±¡yamlæ–‡ä»¶ä¾‹å­kubernetes/minikube github]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Docker for Mac éƒ¨ç½² Kubernetes]]></title>
    <url>%2F2019%2F05%2F06%2Fk8s-install-docker%2F</url>
    <content type="text"><![CDATA[docker for mac å®‰è£…kubernetesæœ¬æ¥æ˜¯å¾ˆæ–¹ä¾¿çš„, ä½†æ˜¯å›½å†…çŽ©å®¶è¦æŠ˜è…¾ä¸€ä¸‹, å› ä¸º gcr.io è¿™ä¸ªåŸŸè¢«å¢™äº†â€¦ ç›®å‰æ¥çœ‹å‰è¾ˆä»¬å·²ç»æŠŠå‘ç»™æ·Œçš„å·®ä¸å¤šäº†, æˆ‘è€æ—©çš„æ—¶å€™ä¹Ÿè¢«æŠ˜è…¾çš„å¤´ç§ƒ, è¿™é‡Œå°±åšä¸ªæ€»ç»“ é€šè¿‡ä»£ç†ç¿»å¢™ä¸‹è½½é•œåƒè¿™ä¸ªæ–¹æ³•ç›¸å¯¹æ¥è¯´ä¸€åŠ³æ°¸é€¸, ç¼ºç‚¹æ˜¯æ¯ä¸ªæœˆæœ‰vpnçš„èŠ±è´¹, æˆ‘ä»£ç†ç”¨çš„shadowsockets, å°±æ‹¿è¿™ä¸ªæ¥ä¸¾ä¾‹: é¦–å…ˆå®‰è£…1brew install privoxy æ·»åŠ é…ç½®: 1vi /usr/local/etc/privoxy/config é…ç½®å†…å®¹:12listen-address 0.0.0.0:8118forward-socks5 / localhost:1080 . ç›‘å¬æœ¬åœ°8118ç«¯å£, è½¬å‘åˆ° localhost:1080, è¿™ä¹Ÿæ˜¯ssçš„å®¢æˆ·ç«¯çš„è½¬å‘ç«¯å£ å¯åŠ¨:1brew services start privoxy è½¬å‘éƒ¨åˆ†å®Œæˆ, æŽ¥ä¸‹æ¥åœ¨ docker for macé…ç½® docker for mac &gt; preferences &gt; Proxies &gt; ç‚¹å‡» Manual proxy configuration Web Server(HTTP) å’Œ Secure Web Server (HTTPS) éƒ½å¡«å…¥ http://{ä½ æœºå™¨IP}:8118 æ¯”å¦‚: â€˜http://192.168.110.203:8118&#39; ä¸èƒ½ç”¨ 127.0.0.1, å› ä¸º docker for mac å¯åŠ¨åŽ, docker æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªè™šæ‹Ÿæœºä¸­,è€Œä¸æ˜¯macOSä¸‹, å› æ­¤è¿™ä¸ªåœ°å€ä»£è¡¨çš„æ„ä¹‰ä¸ä¸€æ · ç‚¹ä¿å­˜, è¿™æ ·å°±èƒ½æ­£å¸¸å®‰è£…k8säº†, å¯ä»¥é€šè¿‡æ´»åŠ¨ç›‘è§†å™¨çœ‹ä¸€ä¸‹ä»–ä»¬çš„æµé‡æ˜¯å¦æ­£å¸¸ æ•™ç¨‹æ¥æº è‡ªå·±é¢„å…ˆåŠ è½½ä¸€å¥—é•œåƒæ¥æ‰¾ä¸ªç›®å½•, æ–°å»º images.properties12345678910k8s.gcr.io/pause-amd64:3.1=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.1k8s.gcr.io/kube-controller-manager-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager-amd64:v1.10.3k8s.gcr.io/kube-scheduler-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler-amd64:v1.10.3k8s.gcr.io/kube-proxy-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy-amd64:v1.10.3k8s.gcr.io/kube-apiserver-amd64:v1.10.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver-amd64:v1.10.3k8s.gcr.io/etcd-amd64:3.1.12=registry.cn-hangzhou.aliyuncs.com/google_containers/etcd-amd64:3.1.12k8s.gcr.io/k8s-dns-sidecar-amd64:1.14.8=registry.cn-hangzhou.aliyuncs.com/google_containers/k8s-dns-sidecar-amd64:1.14.8k8s.gcr.io/k8s-dns-kube-dns-amd64:1.14.8=registry.cn-hangzhou.aliyuncs.com/google_containers/k8s-dns-kube-dns-amd64:1.14.8k8s.gcr.io/k8s-dns-dnsmasq-nanny-amd64:1.14.8=registry.cn-hangzhou.aliyuncs.com/google_containers/k8s-dns-dnsmasq-nanny-amd64:1.14.8k8s.gcr.io/kubernetes-dashboard-amd64:v1.8.3=registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.8.3 æ–°å»ºè„šæœ¬: kubernetes.sh12345678910111213141516171819#/bin/bashfile="./images.properties"if [ -f "$file" ]then echo "$file found." while IFS='=' read -r key value do #echo "$&#123;key&#125;=$&#123;value&#125;" docker pull $&#123;value&#125; docker tag $&#123;value&#125; $&#123;key&#125; docker rmi $&#123;value&#125; done &lt; "$file"else echo "$file not found."fi è¿è¡Œå°±è¡Œ æ•™ç¨‹æ¥æºk8s-docker-for-mac æ‰¾ä¸ªgcr.ioçš„å›½å†…é•œåƒè¿™ä¸ªæ˜¯åˆ©ç”¨äº†dockerHub å› ä¸ºéƒ½æ˜¯å›½å¤–çš„, å…ˆè®©dockerHubç»™buildä¸€ä¸‹, ç„¶åŽç›´æŽ¥æ‹‰dockerHubçš„é•œåƒæ¥è¿‚å›žä¸€ä¸‹ Google Container Registry(gcr.io) ä¸­å›½å¯ç”¨é•œåƒ(é•¿æœŸç»´æŠ¤)gcr.io_mirroråŸºäºŽDocker for macOSçš„Kubernetesæœ¬åœ°çŽ¯å¢ƒæ­å»ºä¸Žåº”ç”¨éƒ¨ç½²]]></content>
      <categories>
        <category>k8s</category>
      </categories>
      <tags>
        <tag>k8s</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Jmeter å¯¹Tcpè¿›è¡ŒåŽ‹æµ‹]]></title>
    <url>%2F2019%2F04%2F30%2Ftools-jmeter%2F</url>
    <content type="text"><![CDATA[jmeteræ˜¯ä¸ªå¥½å·¥å…·, è·¨å¹³å°, æœ‰GUI, ç®€å•æ˜“ç”¨, æ‰©å±•å¤š å®‰è£…æœ¬åœ°çŽ¯å¢ƒä¸ºmacOS Mojave 10.14.4 æœ¬åœ°éœ€è¦å®‰è£…java8jmeterå®˜æ–¹ä¸‹è½½åœ°å€jmeteræ’ä»¶ä¸‹è½½ å½“å‰ä¸‹è½½çš„jmeterç‰ˆæœ¬ä¸º 5.1.1è§£åŽ‹ä¸‹è½½ä¹‹åŽ, è¿è¡Œå‘½ä»¤:1sh ~/Downloads/apache-jmeter-5.1.1/bin/jmeter å°±è¿è¡Œèµ·æ¥äº† è¿›è¡ŒtcpåŽ‹æµ‹é¦–å…ˆåˆ›å»ºThread Group æ³¨æ„å‡ ä¸ªå…³é”®ç‚¹: Number of Threads (users) åˆ›å»ºè¿›ç¨‹ç»„, ç›¸å½“äºŽå¤šå°‘å¹¶å‘ Ramp-Up Period (in seconds) è®¾å®šçš„å¹¶å‘å€¼åœ¨å¤šå°‘ç§’å†…åˆ°è¾¾é¢„æœŸ, æ¨¡æ‹Ÿè‡ªç„¶æµé‡ Loop Count æ¯ä¸ªè¿›ç¨‹ç»„å¾ªçŽ¯å¤šå°‘æ¬¡ Loop Count * Number of Threads å°±æ˜¯æ•´ä½“è¯·æ±‚æ•°é‡äº† åˆ›å»ºtcp Sampler è¿™ç¯‡æ–‡ç« æ˜¯ä½¿ç”¨æœ€åŸºæœ¬çš„æ–‡å­—tcpä¼ è¾“ çœ‹å›¾è¯´è¯, TCP classnameé»˜è®¤ä¸º: org.apache.jmeter.protocol.tcp.sampler.TCPClientImpl, å¯ä»¥ç›´æŽ¥ä»Ž Text to send ä¸­ä¼ å…¥æ–‡æœ¬ä¼ æ–‡æœ¬çš„æ—¶å€™ä¸€å®šè¦è¾“å…¥ä¹‹åŽåŠ ä¸€ä¸ªå›žè½¦,å†™\néƒ½ä¸ç®¡ç”¨, å¿…é¡» æ˜¯å›žè½¦, å®ƒæ˜¯è‡ªåŠ¨è½¬æ¢çš„, ä¸ç„¶ä¼šé€ æˆæ•°æ®æ‰¾ä¸åˆ°ç»ˆæ­¢æ–­ç‚¹ å¦‚æžœä½¿ç”¨ org.apache.jmeter.protocol.tcp.sampler.BinaryTCPClientImpl åˆ™éœ€è¦åœ¨ End of line byte value é‡Œé¢ä¼ å€¼, é€šå¸¸æ˜¯10ä¸” Text to send ä¼ çš„æ˜¯16è¿›åˆ¶æ•°æ® åˆ›å»º summary report ç”¨äºŽåšç»Ÿè®¡è¡¨æ ¼ åˆ›å»º view results tree ç”¨äºŽæŸ¥çœ‹è¯·æ±‚æ•°æ®è¿”å›žæ•°æ® å®‰è£…cpu/å†…å­˜ç›‘æŽ§æ’ä»¶5.1.1 ç‰ˆæœ¬çš„å’Œä¹‹å‰æœçš„æœ‰äº›ä¸ä¸€æ ·, çŽ°åœ¨æœ‰äº†ä¸€ä¸ªå†…ç½®çš„æ‰©å±•å•†åº— æ‰©å±•ä¸‹è½½åœ°å€ Download plugins-manager.jar and put it into lib/ext directory, then restart JMeter. çœ‹åˆ°è¿™å¥è¯æ²¡? ç‚¹å°±è¡Œäº†, ç„¶åŽæŠŠå®ƒæ”¾åˆ°jmeterç›®å½• lib/extä¸‹,é‡å¯jmeterå°±èƒ½çœ‹åˆ°äº† ç‚¹è¿›åŽ»æœç´¢ PerfMon ,å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„äº†, ç‚¹å‡»å®‰è£… , ä»Žæ’ä»¶ç®€ä»‹é‡Œä¹Ÿèƒ½çœ‹åˆ°æ–‡æ¡£åœ°å€ åœ¨æ–‡æ¡£ä¸­æ‰¾åˆ° Server Agentçš„ä¸‹è½½åœ°å€ åœ¨è¢«æµ‹æœåŠ¡å™¨ä¸­å®‰è£… Server Agent , linux ç›´æŽ¥è¿è¡Œ serverAgent.sh é»˜è®¤ç«¯å£ä¸º 4444 æ·»åŠ ç›‘æŽ§:ç‚¹ Add Row æ·»åŠ ç›®æ ‡æœåŠ¡å™¨çš„ipå’Œç«¯å£å°±è¡Œ, ç«¯å£é»˜è®¤4444 ä»¥ä¸Šå°±æ˜¯ä¸€å¥—ç®€å•çš„tcpåŽ‹æµ‹æµ‹è¯•äº† åŽŸæ–‡åœ°å€]]></content>
      <categories>
        <category>tools</category>
      </categories>
      <tags>
        <tag>jmeter</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Phpå¼€å‘è¿‡ç¨‹ä¸­ä¸å¸¸ç¢°åˆ°çš„error (2.28æ›´æ–°)]]></title>
    <url>%2F2019%2F02%2F28%2Fphp-unsual-mistakes%2F</url>
    <content type="text"><![CDATA[è¿™é‡Œåšä¸€äº›å¤‡æ³¨,ä»¥é˜²å†æ¬¡ç¢°åˆ° url å½“ä¸­çš„å‚æ•°æœ‰ &amp;timestamp=1234567890è¿™æ ·çš„å­—æ®µä¼šè¢«è½¬ä¹‰æˆxtamp=1234567890è¿™ä¸ªä¸ä»…å­˜åœ¨äºŽé¡µé¢è§£æžå½“ä¸­,å½“ä½¿ç”¨ curl è¯·æ±‚æ—¶æ‹¼æŽ¥çš„å‚æ•°æœ‰è¿™ç§æ ¼å¼çš„ä¹Ÿä¼šå‘ç”Ÿè½¬ä¹‰è§£å†³æ–¹æ³•æœ‰ä¸¤ä¸ª: æŠŠ timestamp è¿™ä¸ªå‚æ•°æ”¾åœ¨ urlQuery çš„æœ€å‰é¢, ?timestamp=1234567890 è¿™æ ·é¿å…å‡ºçŽ° &amp;timeå‘ç”Ÿè½¬ä¹‰çš„æƒ…å†µ å°†&amp;ç”¨&amp;amp;æ¥ä»£æ›¿ Automatically populating $HTTP_RAW_POST_DATA is deprecated and will be removed in a future version.å‡ºçŽ°è¿™å¥è¯é€šå¸¸è¯´æ˜Žä½ åœ¨ç”¨çš„ php ç‰ˆæœ¬æ˜¯5.6.è€Œä¸”åœ¨php&lt;=5.6çš„æ—¶å€™,è¿›è¡Œ application/jsonæ ¼å¼çš„ post æäº¤ä¼šæŠŠæ•°æ®æ”¾åœ¨$HTTP_RAW_POST_DATAè¿™ä¸ªç³»ç»Ÿå˜é‡é‡Œé¢,åœ¨php&gt;=7çš„æ—¶å€™è¿™ä¸ªå˜é‡è¢«ç§»é™¤äº†,ç»Ÿç»Ÿå½’æ€»åˆ°php://inputè¿™é‡Œè§£å†³æ–¹æ³•: æ ¹æ®ç³»ç»Ÿæç¤ºçš„èµ°: Although that indeed would be technically impossible (as $HTTP_RAW_POST_DATA is populated in the bootstrapping phase of the PHP process) allow one to override the setting by means of calling ini_set. è¦ç¡®ä¿è‡ªå·±çš„ç³»ç»Ÿä¸­æ²¡æœ‰ä½¿ç”¨ HTTP_RAW_POST_DATAè¿™ä¸ªå˜é‡,ç›´æŽ¥åœ¨php.inié‡Œé¢ç¦æŽ‰å®ƒçš„è®¾ç½®,ä½†æ˜¯å®¹æ˜“å‡ºçŽ°ç³»ç»Ÿä¸­åˆæ‰“å¼€çš„æƒ…å†µ(åœ¨æ¡†æž¶ä¸­å¾ˆå¸¸è§) æ”¹ä¸€ä¸‹è‡ªå·±çš„æäº¤æ–¹å¼, ä½¿ç”¨ application/form-dataæˆ–è€…application/x-www-form-urlencodedè¿™ç§æ ¼å¼çš„æäº¤, ç„¶åŽåœ¨åŽç«¯æŽ¥æ”¶æ•°æ®çš„æ—¶å€™å†è½¬æˆè‡ªå·±éœ€è¦çš„æ ¼å¼(é€šå¸¸æ˜¯æ•°ç»„) å‚è€ƒèµ„æ–™ Exception â€˜yii\db\Exceptionâ€™ with message â€˜SQLSTATE[HY000] [2002] No such file or directoryâ€™è¿™ç§æƒ…å†µå‡ºçŽ°åœ¨å¹³æ—¶è¿è¡Œçš„å¥½å¥½çš„, ä½†æ˜¯çªç„¶æ¢ cli æ¨¡å¼åŽè¿™ä¸ªé…ç½®å°±å‡ºé—®é¢˜äº†,åŽŸå› åœ¨å½“ host=localhostæ—¶èµ°çš„æ˜¯ unix:socket é“¾æŽ¥, å½“host=127.0.0.1èµ°çš„æ˜¯ tcp é“¾æŽ¥,è¿™åœ¨php-fpmå’Œphp-cliä¸­æœ‰ç‚¹åŒºåˆ«,å°¤å…¶æ˜¯æœ¬åœ°æ²¡æœ‰å®‰è£… mysql çš„æ—¶å€™è§£å†³æ–¹æ³•æœ‰ä¸‰ç§: å°†æœ¬åœ°é“¾æŽ¥é…ç½®ç»Ÿä¸€æˆ 127.0.0.1 æŸ¥çœ‹ MySQL ä¸­çš„userè¡¨, host=localhostå’Œhost=127.0.0.1æ˜¯ä¸æ˜¯ç”¨çš„åŒä¸€ä¸ªè´¦å·å¯†ç  é…ç½®php.iniæ–‡ä»¶ä¸­çš„pdo_mysql.default_socket= å†™ä¸Šå®Œæ•´çš„ socket è·¯å¾„ä»¥ä¸Šä¸‰ç§æ–¹æ³•éƒ½å¯ä»¥è¯•ä¸€ä¸‹å‚è€ƒèµ„æ–™ å¸¸é©»å†…å­˜æ—¶å‘ç”Ÿçš„äº‹æƒ…è¿™ä¸ªæ˜¯ phper å¾ˆå°‘ç¢°åˆ°ä½†æ˜¯å¾ˆå¸¸è§çš„æƒ…å†µ, æ¯”å¦‚ç”¨ swoole å¯åŠ¨äº†ä¸€ä¸ªå¸¸é©»è¿›ç¨‹çš„æœåŠ¡, é‚£ä¹ˆå°±ä¸€å®šè¦å°å¿ƒä½¿ç”¨é™æ€å˜é‡,åœ¨åŒæ­¥æ¨¡å¼ä¸‹ä¼šå‘ç”Ÿå˜é‡æ±¡æŸ“, è¿˜æœ‰å°±æ˜¯ redis,mysql è¿™ç±»çš„é“¾æŽ¥,ä½ ä¼šå‘çŽ°é•¿æ—¶é—´é™ç½®ä»¥åŽå°±ä¼šå‡ºçŽ°ä¸€äº›æ‘¸ä¸ç€å¤´è„‘çš„é—®é¢˜, è¿™ç§æƒ…å†µä¸å¦¨æƒ³ä¸€ä¸‹æ˜¯ä¸æ˜¯ server ç«¯å›žæ”¶äº†è¿™ä¸ª socket,å› æ­¤åœ¨ client ç«¯æ€Žä¹ˆéƒ½å†™å…¥ä¸è¿›åŽ». è¿˜æœ‰å°±æ˜¯ php åœ¨è¯»å–æ¶ˆæ¯çš„æ—¶å€™,å‡ºçŽ°æ¶ˆæ¯è¿‡é•¿çš„æƒ…å†µ,é‚£ä¹ˆå°±è¦è€ƒè™‘EOFç»ˆæ­¢ç¬¦çš„é—®é¢˜äº†â€¦ å•æ¬¡ http æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯å…¨æ–°çš„ä»£ç , ä¸ç”¨è‡ªå·±è€ƒè™‘ gc çš„é—®é¢˜, ä½†æ˜¯åœ¨å¸¸é©»å†…å­˜çš„æ—¶å€™,è¿™äº›å°±æ˜¯ä¸€ä¸ªä¸ªçš„å¤§å‘äº† mysql has gone awayäº§ç”Ÿè¿™ä¸ªé”™è¯¯çš„ä¸»è¦åŽŸå› æ˜¯ mysql server ç«¯æ–­å¼€äº†é“¾æŽ¥, client ç«¯è¿˜æ‹¿ç€è¿™ä¸ªå¥æŸ„åŽ»è¯·æ±‚,è§£å†³æ–¹å¼æœ‰ä¸¤ç§: show global variables like &#39;%timeout&#39;; æŸ¥çœ‹ wait_timeout çš„æ—¶é•¿,é€‚å½“çš„è°ƒé•¿ä¸€ç‚¹, è¿™ç§æ–¹æ³•æ²»æ ‡ä¸æ²»æœ¬,è€Œä¸”æœ‰éšæ‚£ 12mysql&gt; set global wait_timeout=10;mysql&gt; show global variables like 'wait_timeout'; ä½¿ç”¨ mysql ä¹‹å‰éœ€è¦ mysql_ping() ä¸€ä¸‹, å¦‚æžœå‡ºçŽ°æ–­å¼€çš„é”™è¯¯å°±å¯åŠ¨é‡è¿žæœºåˆ¶ js å’Œ php äº¤äº’ä¼ ä¸­æ–‡å‚æ•°çš„ç¼–è§£ç é—®é¢˜ä¹‹å‰ç¢°åˆ°äº†é—®é¢˜æ˜¯:åœ¨ php ç«¯ urlencode çš„å€¼ä¸º:1orderid%3D21111111110001954%26pid%3D257742%26reason%3D%E4%B8%AA%E4%BA%BA%E6%96%B9%E9%9D%A2%E5%8E%9F%E5%9B%A0_%E4%BD%BF%E7%94%A8%E7%BA%A2%E5%8C%85%E9%87%8D%E6%96%B0%E4%B8%8B%E5%8D%95%26token%3D041d9e5575f480b7bfd58b09bd14ab1c7ee9e9594f2fcdb9f0e3e39fc634b48f éœ€è¦ urldecode ä¸€æ¬¡ è€Œåœ¨ js ç«¯çš„ç»“æžœæ˜¯:1orderid%3D21111111110002170%26pid%3D257742%26reason%3D%25E4%25B8%25AA%25E4%25BA%25BA%25E6%2596%25B9%25E9%259D%25A2%25E5%258E%259F%25E5%259B%25A0_%25E4%25B8%25AA%25E4%25BA%25BA%25E8%25BA%25AB%25E4%25BD%2593%25E5%258E%259F%25E5%259B%25A0%26token%3D041d9e5575f480b7bfd58b09bd14ab1c7ee9e9594f2fcdb9f0e3e39fc634b48f éœ€è¦ urldecode ä¸¤æ¬¡ æŸ¥é˜…èµ„æ–™åŽ:12345678910111213åœ¨åŽç«¯æ˜¯PHPç¨‹åºçš„æƒ…å†µä¸‹ï¼Œä¿æŒå‰ç«¯Javascriptå’ŒPHPä¹‹é—´ä¼ å€¼çš„ç»Ÿä¸€ç¼–ç å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡½æ•°è¿›è¡Œå¤„ç†ï¼š WEBå‰ç«¯JavaScript ç¼–ç ï¼šescape(encodeURI(string)) è§£ç ï¼šunescape(decodeURI(string)) WEBåŽç«¯Php ç¼–ç ï¼šurlencode(string) è§£ç ï¼šurldecode(urldecode(string)) ä¸ºä»€ä¹ˆè¦encodeURI(url)ä¸¤æ¬¡æ‰ä¸ä¼šå‡ºçŽ°ä¹±ç ï¼Ÿ PHPä¸­rawurlencodeå’Œurlencodeã€JSä¸­encodeURIä¸ŽencodeURIComponent çš„åŒºåˆ«rawurlencodeéµå®ˆæ˜¯94å¹´å›½é™…æ ‡å‡†å¤‡å¿˜å½•RFC 1738 urlencodeå®žçŽ°çš„æ˜¯ä¼ ç»Ÿåšæ³•ï¼Œå’Œä¸Šè€…çš„ä¸»è¦åŒºåˆ«æ˜¯å¯¹ç©ºæ ¼çš„è½¬ä¹‰æ˜¯â€™+â€™è€Œä¸æ˜¯â€™%20â€™javascriptçš„encodeURLä¹Ÿæ˜¯94å¹´æ ‡å‡†ï¼Œè€Œjavascriptçš„escapeæ˜¯å¦ä¸€ç§ç”¨â€%xxxâ€æ ‡è®°unicodeç¼–ç çš„æ–¹æ³•ã€‚æŽ¨èåœ¨PHPä¸­ä½¿ç”¨ç”¨rawurlencodeã€‚å¼ƒç”¨urlencode æ ·ä¾‹source:è¶…çº§æ— æ•Œçš„äººsadha sajdhæ•°æ®æ ·æœ¬sdls fhejrthcxzb.file.jpeg PHP urlencode:%E8%B6%85%E7%BA%A7%E6%97%A0%E6%95%8C%E7%9A%84%E4%BA%BAsadha+sajdh%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%ACsdls+fhejrthcxzb.file.jpeg PHP rawurlencode:%E8%B6%85%E7%BA%A7%E6%97%A0%E6%95%8C%E7%9A%84%E4%BA%BAsadha%20sajdh%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%ACsdls%20fhejrthcxzb.file.jpeg Javascript encodeURI|encodeURIComponent:%E8%B6%85%E7%BA%A7%E6%97%A0%E6%95%8C%E7%9A%84%E4%BA%BAsadha%20sajdh%E6%95%B0%E6%8D%AE%E6%A0%B7%E6%9C%ACsdls%20fhejrthcxzb.file.jpeg Javascript escape:%u8D85%u7EA7%u65E0%u654C%u7684%u4EBAsadha%20sajdh%u6570%u636E%u6837%u672Csdls%20fhejrthcxzb.file.jpeg å¸–å­åŽŸæ–‡ åœ¨å‰ç«¯è¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯, js çš„ encodeURIComponent å’Œ encodeURI éƒ½ä¸ä¼šè½¬æ¢ _-.!~*&#39;()# è¿™äº›ä¿ç•™å­—ç¬¦, è€Œåœ¨åŽç«¯çš„rawurlencode åˆ™æ˜¯ä¼šè½¬æ¢çš„, å› æ­¤éœ€è¦å‰ç«¯å•ç‹¬æŠŠè¿™å‡ ä¸ªç»™æ‹Žå‡ºæ¥, å¦‚ä¸‹:12"*".charCodeAt(0) // 42String.fromCharCode(42) // * è¿™é‡Œæœ‰å¼ å›¾è¯´çš„å¾ˆæ˜Žç™½å›¾ç‰‡æ¥æº å…³äºŽå‡ºçŽ° &lt;U+200B&gt; è¿™ç§ zero-width space å­—ç¬¦å¦‚æžœå‡ºçŽ° mb_substr è¿™ç±»æ“ä½œçš„æ—¶å€™, ä¼šå‡ºçŽ°å­—æ•°åˆ¤æ–­é”™è¯¯çš„é—®é¢˜, è¿™ä¸ªæœ‰æ—¶å€™å¾ˆéš¾æŽ’æŸ¥, å› ä¸ºåœ¨ win ä¸Š,ä½¿ç”¨å‘½ä»¤è¡Œæˆ–è€… linux ä¸Šç”¨catå‘½ä»¤æ˜¯çœ‹ä¸åˆ°å­—ç¬¦é—´æ˜¯æœ‰ &lt;U+200B&gt; çš„, å¦‚ä¸‹: è¿™çŽ©æ„å„¿å‡ºçŽ°çš„åœºæ™¯å°±æ˜¯: åœ¨å‰ç«¯è¾“å…¥æ¡†ä¸­è¾“å…¥å‡ ä¸ªå­—, ç„¶åŽå¤åˆ¶ç²˜è´´. è¿™æ ·å°½ç®¡çœ‹èµ·æ¥ä¹‹é—´æ²¡æœ‰ç©ºæ ¼, ä½†æ˜¯å…¶ä¸­è¿˜æ˜¯æ’å…¥äº†è¿™ä¸ªå­—ç¬¦è¿™ä¸ªå°±æ˜¯ zero-width space é›¶å®½ç©ºæ ¼, å¤„ç†çš„åŠžæ³•ä¹Ÿå¾ˆç®€å•, å‰ç«¯ä¼ å€¼ä¹‹å‰ç»™è¿‡æ»¤ä¸€ä¸‹, æ¯”å¦‚ https://stackoverflow.com/questions/7055600/u200b-zero-width-space-characters-in-my-js-code-where-did-they-come-from æˆ– https://codeday.me/bug/20171122/97765.html åŽç«¯ php å¤„ç†çš„è¯å’Œè¿™ä¸ªä¸ä¸€æ ·, ä½¿ç”¨ utf-8 çš„å¤„ç†æ–¹å¼, å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  ç‰¹æ®Šå­—ç¬¦çš„åˆ é™¤åŠžæ³•ä¸ŽåŽŸç† æ›¿æ¢è¿™ç§ç¼–ç 123$value = str_replace("\xe2\x80\x8b", '', $value);$value = str_replace("\xe2\x80\x8c", '', $value);$value = str_replace("\xe2\x80\x8d", '', $value); ç¼–ç å¯¹ç…§å¦‚ä¸‹: mac è®¾ç½®crontab -e ï¼š â€œ/usr/bin/viâ€ exited with status 1è¾“å…¥ä»¥ä¸‹å‘½ä»¤1234export EDITOR=vimsudo touch /etc/crontabcrontab -ecrontab -l æŠŠé»˜è®¤ç¼–è¾‘å™¨ä»Ž vi æ”¹æˆ vim åŽŸæ–‡ å‡ºçŽ°: The â€œhttps://bower.herokuapp.com/packages/jquery&quot; file could not be downloaded (HTTP/1.1 502 Bad Gateway)yii2 æ›´æ–°çš„æ—¶å€™é™æ€èµ„æºå‡ºçŽ°é—®é¢˜, æ‰§è¡Œ composer global require &quot;fxp/composer-asset-plugin:~1.4.4&quot; é—®é¢˜æ¥æº å‡ºçŽ°: Jquery UI 1.11.4 and jquery 3.0 çš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜è¿™ä¸ªæ˜¯åœ¨éƒ¨ç½² adminLTE + rbac æ—¶å€™é‡ä¸Šçš„, æ‰“å¼€ /admin/menu/create ä¼šæŠ¥ Jquery UI error - f.getClientRects is not a function é”™è¯¯ è§£å†³æ–¹æ³•:é…ç½®æ–‡ä»¶: config/web.php1234567891011121314151617... 'components' =&gt; [ ... //é™æ€èµ„æº 'assetManager' =&gt; [ ... 'assetMap' =&gt; [ 'jquery.js' =&gt; 'https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js', // 'jquery.min.js' =&gt; 'https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js',// 'jquery.js' =&gt; '@web/js/jquery/jquery.js',// 'jquery.min.js' =&gt; '@web/js/jquery/jquery.js', ], ... ], ... ]... æŠŠç›¸åº”çš„ jquery æ›¿æ¢æˆ v2.2.4 è§£å†³é—®é¢˜æ¥æº macOS brewå®‰è£…php7.1 ä»¥åŠswooleæ‰©å±•brewæ”¹ç‰ˆåŽå†…æ ¸é›†æˆäº†php, æ‰€ä»¥å¯ä»¥ç›´æŽ¥å®‰è£…å®‰è£…php1brew install php@7.1 æŒ‰æç¤ºæŠŠ12echo 'export PATH="/usr/local/opt/php@7.1/bin:$PATH"' &gt;&gt; ~/.zshrcecho 'export PATH="/usr/local/opt/php@7.1/sbin:$PATH"' &gt;&gt; ~/.zshrc è¿™äº›æ”¾åˆ°ä½ æœ¬åœ°å‘½ä»¤è¡Œé…ç½®é‡Œé¢, ç„¶åŽç”Ÿæˆä¸€ä¸ªè½¯é“¾1brew link php@7.1 --force å®‰è£…æ‰©å±•å°±å¾—ä½¿ç”¨peclå·¥å…·äº†12cd /usr/local/opt/php@7.1 # æ‰§è¡Œå®Œ brew link ä¹‹åŽå°±æŒ‰è½¯é“¾çš„æ¥, è¿™æ ·çš„å¥½å¤„å°±æ˜¯ä¸ç”¨è®°å°ç‰ˆæœ¬å·, è·¯å¾„çŸ­pecl install swoole # æç¤º 'openssl/ssl.h' file not found å°±æ˜¯ä½ å®‰è£…çš„æ—¶å€™åˆ«é€‰ sslæ”¯æŒå°±è¡Œ å¦‚æžœæç¤º No releases available for package â€œpecl.php.net/swooleâ€å‚è€ƒ æ‰§è¡Œ â€˜pecl install swooleâ€™ä¹‹åŽï¼Œé‡åˆ°çš„ä¸€äº›å‘ , æŒ‰æç¤ºä¸€æ­¥æ­¥èµ°åº”è¯¥æ²¡é—®é¢˜ å®‰è£…å®Œæ¯•ä¹‹åŽéœ€è¦å˜ä¸€ä¸‹é…ç½®12345php -i | grep .ini...Loaded Configuration File =&gt; /usr/local/etc/php/7.1/php.ini //å½“å‰åŠ è½½çš„é…ç½®æ–‡ä»¶è·¯å¾„...cd /usr/local/etc/php/7.1 å…ˆåˆ é™¤ php.ini é‡Œé¢ç¬¬ä¸€è¡Œçš„ extension=swoole.so æ”¹æˆè¿™ä¸ªsoæ–‡ä»¶çš„çœŸå®žè·¯å¾„, æŽ¨èæ”¾åˆ°éš”å£çš„ conf.d ç›®å½•åº•ä¸‹ç„¶åŽphp -m | grep sw å¯ä»¥çœ‹ä¸€ä¸‹äº†å®‰è£…å…¶ä»–æ‰©å±•ä¹Ÿæ˜¯æŒ‰è¿™ä¸ªè·¯æ•°æ¥ å‡ºçŽ° Connection reset by peer æŠ¥é”™è¿™æ˜¯ä¸ªtcpé“¾æŽ¥ä¸Šçš„é”™è¯¯, æ„å‘³ç€ é“¾æŽ¥è¿‡ç¨‹ä¸­è¯»æˆ–è€…å†™å‡ºçŽ°å¼‚å¸¸, å‡ºçŽ°çš„åŽŸå› : ABä¸¤ç«¯, Aç«¯å…³é—­äº†é“¾æŽ¥, Bç«¯ä»åœ¨å‘é€, åˆ™æŠ›å¼‚å¸¸ ABä¸¤ç«¯, Aé€€å‡ºä½†æ²¡å…³é—­é“¾æŽ¥, åˆ™Båœ¨è¯»çš„æ—¶å€™æŠ›å¼‚å¸¸ æŽ’æŸ¥: å…ˆçœ‹çœ‹serverç«¯æ˜¯ä¸æ˜¯å¯¹åŒ…å¤§å°è¿›è¡Œäº†é™åˆ¶, bufferåˆ†é…æ˜¯å¦è¶³å¤Ÿ æ˜¯ä¸æ˜¯ç¨‹åºé“¾æŽ¥åˆ°ä¸Šé™äº†, è¢«æœåŠ¡å™¨è¯¯æ€ é˜²ç«å¢™é—®é¢˜ Warning: preg_match() [function.preg-match]: Compilation failed: PCRE does not support \L, \l, \N, \U, or \u atphpæ­£åˆ™åŒ¹é…ä¸­æ–‡å­—ç¬¦çš„æ—¶å€™, ä½¿ç”¨ /^[\u4e00-\u9fa5]+$/ è¿™ä¸€æ¡å°±ä¼šæŠ¥ä¸Šé¢çš„é”™è¯¯, æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯:123456$str = "phpç¼–ç¨‹";if (preg_match("/^[\x&#123;4e00&#125;-\x&#123;9fa5&#125;]+$/u",$str)) &#123;print("è¯¥å­—ç¬¦ä¸²å…¨éƒ¨æ˜¯ä¸­æ–‡");&#125; else &#123;print("è¯¥å­—ç¬¦ä¸²ä¸å…¨éƒ¨æ˜¯ä¸­æ–‡");&#125; php preg_match æ­£åˆ™åŒ¹é…ä¸­æ–‡ phpåŒ¹é… UTF-8 with DOM çš„å­—ç¬¦è¿™ä¸ªå’Œä¸Šé¢çš„åŒ¹é…ä¸­æ–‡æ˜¯ä¸€èµ·å‡ºçŽ°çš„, winä¸Šä½¿ç”¨ UTF-8 æ ¼å¼çš„txtæ–‡ä»¶åœ¨linuxä¸Šæ‰“å¼€å°±ä¼šå˜æˆ UTF-8 with DOM è¿™ä¸ªç±»åž‹, æ–‡ä»¶å†…å®¹ä¸­ä¼šå­˜åœ¨domå¤´, ä»Žè€Œå¹²æ‰°åˆ°ä¸€äº›åˆ¤æ–­, æ¯”å¦‚æ­£åˆ™åŒ¹é…è§£å†³åŠžæ³•ä¹Ÿç®€å•, åŽ»æŽ‰å°±è¡Œ1234567// ç®€å•çš„å°†winä¸Šçš„txtæ–‡ä»¶è½¬æˆutf-8æ ¼å¼function toUTF8($str)&#123; $type = mb_detect_encoding($str, array("ASCII","UTF-8","GB2312","GBK","BIG5")); $result = iconv($type, 'UTF-8//IGNORE', $str); // é˜²æ­¢UTF-8 with BOM çš„æƒ…å†µ return trim($result, "\xEF\xBB\xBF");&#125; ä¸è¿‡ utf-8 with dom å¯¹phpæ¥è¯´æ˜¯ä¸ªéšæ‚£, å› ä¸ºphpæ²¡æœ‰å¯¹è¿™å—çš„å¤„ç†, ä¼šå‡ºçŽ°ZERO WIDTH NO-BREAK SPACEè¿™æ ·çš„é—®é¢˜, æœ‰æ•°æ®ä½†æ˜¯ä¸ä¼šåœ¨é¡µé¢è¾“å‡º å‚è€ƒ:PHP UTF-8çš„ BOM é—®é¢˜è§£å†³]]></content>
      <categories>
        <category>php</category>
      </categories>
      <tags>
        <tag>php</tag>
        <tag>debug</tag>
      </tags>
  </entry>
</search>
